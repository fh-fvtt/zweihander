{"version":3,"file":"zweihander.js","sources":["module/utils.js","module/actor/entity/base-actor.js","module/apps/actor-config.js","module/actor/entity/pc.js","module/actor/entity/creature.js","module/actor/entity/npc.js","module/actor/actor.js","module/dice/zweihander-dice.js","module/actor/sheet/actor-sheet.js","module/actor/sheet/npc-sheet.js","module/actor/sheet/creature-sheet.js","module/item/entity/base-item.js","module/item/entity/weapon.js","module/item/entity/profession.js","module/item/entity/skill.js","module/item/entity/ancestry.js","module/item/item.js","module/item/sheet/item-sheet.js","module/apps/fortune-tracker.js","module/settings.js","module/template.js","module/helpers.js","module/migration.js","node_modules/intro.js/intro.js","module/constants.js","module/main.js"],"sourcesContent":["/**\n * Helper function used to check ItemData duplicates between two given datasets.\n */\nexport function findDifference(datasetA, datasetB) {\n  let diffArray = [];\n\n  for (let elementA of datasetA)\n    if (!datasetB.some(elementB => elementB.name === elementA.name))\n      diffArray.push(elementA);\n\n  return diffArray;\n};\n\n/**\n * Helper function that returns the symmetric difference between two datasets (xor operation).\n * \n * @param {*} datasetA \n * @param {*} datasetB \n * @returns The unique elements of datasetA and datasetB.\n */\n export function getSymmetricDifference(datasetA, datasetB) {\n  return findDifference(datasetA, datasetB).concat(findDifference(datasetB, datasetA));\n}\n\n/**\n * Helper function that returns the difference between two arrays (minus operation).\n * \n * @param {Array} arrayA \n * @param {Array} arrayB \n * @returns The elements of arrayA that are not present in arrayB.\n */\nexport function getArrayDifference(arrayA, arrayB) {\n  return arrayA.filter(element => !arrayB.includes(element));\n}\n\n/**\n * Helper function that checks whether an object is empty or not.\n * \n * @param {object} object The object to be checked\n * @returns \n */\n\nexport function isObjectEmpty(object) {\n  return !object || !Object.keys(object).length;\n}\n\nexport const primaryAttributeMapping = {\n  C: \"combat\",\n  B: \"brawn\",\n  A: \"agility\",\n  P: \"perception\",\n  I: \"intelligence\",\n  W: \"willpower\",\n  F: \"fellowship\"\n};\n\nexport function abbreviations2DataPath(str, includeFlavor = true) {\n  const b = x => `@stats.primaryAttributes.${x}.bonus`;\n  const c = x => x.slice(0, 1).toUpperCase() + x.slice(1);\n  \n  for (let key in primaryAttributeMapping) {\n    str = str?.replace(`[${key}B]`, `${b(primaryAttributeMapping[key])}` + (includeFlavor ? `[${c(primaryAttributeMapping[key])} Bonus]` : ''));\n  }\n  return str;\n}\n\nconst diacriticsMap = (function(){\n// https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript\nlet defaultDiacriticsRemovalMap = [\n  { 'base': 'A', 'letters': '\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F' },\n  { 'base': 'AA', 'letters': '\\uA732' },\n  { 'base': 'AE', 'letters': '\\u00C6\\u01FC\\u01E2' },\n  { 'base': 'AO', 'letters': '\\uA734' },\n  { 'base': 'AU', 'letters': '\\uA736' },\n  { 'base': 'AV', 'letters': '\\uA738\\uA73A' },\n  { 'base': 'AY', 'letters': '\\uA73C' },\n  { 'base': 'B', 'letters': '\\u0042\\u24B7\\uFF22\\u1E02\\u1E04\\u1E06\\u0243\\u0182\\u0181' },\n  { 'base': 'C', 'letters': '\\u0043\\u24B8\\uFF23\\u0106\\u0108\\u010A\\u010C\\u00C7\\u1E08\\u0187\\u023B\\uA73E' },\n  { 'base': 'D', 'letters': '\\u0044\\u24B9\\uFF24\\u1E0A\\u010E\\u1E0C\\u1E10\\u1E12\\u1E0E\\u0110\\u018B\\u018A\\u0189\\uA779\\u00D0' },\n  { 'base': 'DZ', 'letters': '\\u01F1\\u01C4' },\n  { 'base': 'Dz', 'letters': '\\u01F2\\u01C5' },\n  { 'base': 'E', 'letters': '\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E' },\n  { 'base': 'F', 'letters': '\\u0046\\u24BB\\uFF26\\u1E1E\\u0191\\uA77B' },\n  { 'base': 'G', 'letters': '\\u0047\\u24BC\\uFF27\\u01F4\\u011C\\u1E20\\u011E\\u0120\\u01E6\\u0122\\u01E4\\u0193\\uA7A0\\uA77D\\uA77E' },\n  { 'base': 'H', 'letters': '\\u0048\\u24BD\\uFF28\\u0124\\u1E22\\u1E26\\u021E\\u1E24\\u1E28\\u1E2A\\u0126\\u2C67\\u2C75\\uA78D' },\n  { 'base': 'I', 'letters': '\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197' },\n  { 'base': 'J', 'letters': '\\u004A\\u24BF\\uFF2A\\u0134\\u0248' },\n  { 'base': 'K', 'letters': '\\u004B\\u24C0\\uFF2B\\u1E30\\u01E8\\u1E32\\u0136\\u1E34\\u0198\\u2C69\\uA740\\uA742\\uA744\\uA7A2' },\n  { 'base': 'L', 'letters': '\\u004C\\u24C1\\uFF2C\\u013F\\u0139\\u013D\\u1E36\\u1E38\\u013B\\u1E3C\\u1E3A\\u0141\\u023D\\u2C62\\u2C60\\uA748\\uA746\\uA780' },\n  { 'base': 'LJ', 'letters': '\\u01C7' },\n  { 'base': 'Lj', 'letters': '\\u01C8' },\n  { 'base': 'M', 'letters': '\\u004D\\u24C2\\uFF2D\\u1E3E\\u1E40\\u1E42\\u2C6E\\u019C' },\n  { 'base': 'N', 'letters': '\\u004E\\u24C3\\uFF2E\\u01F8\\u0143\\u00D1\\u1E44\\u0147\\u1E46\\u0145\\u1E4A\\u1E48\\u0220\\u019D\\uA790\\uA7A4' },\n  { 'base': 'NJ', 'letters': '\\u01CA' },\n  { 'base': 'Nj', 'letters': '\\u01CB' },\n  { 'base': 'O', 'letters': '\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C' },\n  { 'base': 'OI', 'letters': '\\u01A2' },\n  { 'base': 'OO', 'letters': '\\uA74E' },\n  { 'base': 'OU', 'letters': '\\u0222' },\n  { 'base': 'OE', 'letters': '\\u008C\\u0152' },\n  { 'base': 'oe', 'letters': '\\u009C\\u0153' },\n  { 'base': 'P', 'letters': '\\u0050\\u24C5\\uFF30\\u1E54\\u1E56\\u01A4\\u2C63\\uA750\\uA752\\uA754' },\n  { 'base': 'Q', 'letters': '\\u0051\\u24C6\\uFF31\\uA756\\uA758\\u024A' },\n  { 'base': 'R', 'letters': '\\u0052\\u24C7\\uFF32\\u0154\\u1E58\\u0158\\u0210\\u0212\\u1E5A\\u1E5C\\u0156\\u1E5E\\u024C\\u2C64\\uA75A\\uA7A6\\uA782' },\n  { 'base': 'S', 'letters': '\\u0053\\u24C8\\uFF33\\u1E9E\\u015A\\u1E64\\u015C\\u1E60\\u0160\\u1E66\\u1E62\\u1E68\\u0218\\u015E\\u2C7E\\uA7A8\\uA784' },\n  { 'base': 'T', 'letters': '\\u0054\\u24C9\\uFF34\\u1E6A\\u0164\\u1E6C\\u021A\\u0162\\u1E70\\u1E6E\\u0166\\u01AC\\u01AE\\u023E\\uA786' },\n  { 'base': 'TZ', 'letters': '\\uA728' },\n  { 'base': 'U', 'letters': '\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244' },\n  { 'base': 'V', 'letters': '\\u0056\\u24CB\\uFF36\\u1E7C\\u1E7E\\u01B2\\uA75E\\u0245' },\n  { 'base': 'VY', 'letters': '\\uA760' },\n  { 'base': 'W', 'letters': '\\u0057\\u24CC\\uFF37\\u1E80\\u1E82\\u0174\\u1E86\\u1E84\\u1E88\\u2C72' },\n  { 'base': 'X', 'letters': '\\u0058\\u24CD\\uFF38\\u1E8A\\u1E8C' },\n  { 'base': 'Y', 'letters': '\\u0059\\u24CE\\uFF39\\u1EF2\\u00DD\\u0176\\u1EF8\\u0232\\u1E8E\\u0178\\u1EF6\\u1EF4\\u01B3\\u024E\\u1EFE' },\n  { 'base': 'Z', 'letters': '\\u005A\\u24CF\\uFF3A\\u0179\\u1E90\\u017B\\u017D\\u1E92\\u1E94\\u01B5\\u0224\\u2C7F\\u2C6B\\uA762' },\n  { 'base': 'a', 'letters': '\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250' },\n  { 'base': 'aa', 'letters': '\\uA733' },\n  { 'base': 'ae', 'letters': '\\u00E6\\u01FD\\u01E3' },\n  { 'base': 'ao', 'letters': '\\uA735' },\n  { 'base': 'au', 'letters': '\\uA737' },\n  { 'base': 'av', 'letters': '\\uA739\\uA73B' },\n  { 'base': 'ay', 'letters': '\\uA73D' },\n  { 'base': 'b', 'letters': '\\u0062\\u24D1\\uFF42\\u1E03\\u1E05\\u1E07\\u0180\\u0183\\u0253' },\n  { 'base': 'c', 'letters': '\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184' },\n  { 'base': 'd', 'letters': '\\u0064\\u24D3\\uFF44\\u1E0B\\u010F\\u1E0D\\u1E11\\u1E13\\u1E0F\\u0111\\u018C\\u0256\\u0257\\uA77A' },\n  { 'base': 'dz', 'letters': '\\u01F3\\u01C6' },\n  { 'base': 'e', 'letters': '\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD' },\n  { 'base': 'f', 'letters': '\\u0066\\u24D5\\uFF46\\u1E1F\\u0192\\uA77C' },\n  { 'base': 'g', 'letters': '\\u0067\\u24D6\\uFF47\\u01F5\\u011D\\u1E21\\u011F\\u0121\\u01E7\\u0123\\u01E5\\u0260\\uA7A1\\u1D79\\uA77F' },\n  { 'base': 'h', 'letters': '\\u0068\\u24D7\\uFF48\\u0125\\u1E23\\u1E27\\u021F\\u1E25\\u1E29\\u1E2B\\u1E96\\u0127\\u2C68\\u2C76\\u0265' },\n  { 'base': 'hv', 'letters': '\\u0195' },\n  { 'base': 'i', 'letters': '\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131' },\n  { 'base': 'j', 'letters': '\\u006A\\u24D9\\uFF4A\\u0135\\u01F0\\u0249' },\n  { 'base': 'k', 'letters': '\\u006B\\u24DA\\uFF4B\\u1E31\\u01E9\\u1E33\\u0137\\u1E35\\u0199\\u2C6A\\uA741\\uA743\\uA745\\uA7A3' },\n  { 'base': 'l', 'letters': '\\u006C\\u24DB\\uFF4C\\u0140\\u013A\\u013E\\u1E37\\u1E39\\u013C\\u1E3D\\u1E3B\\u017F\\u0142\\u019A\\u026B\\u2C61\\uA749\\uA781\\uA747' },\n  { 'base': 'lj', 'letters': '\\u01C9' },\n  { 'base': 'm', 'letters': '\\u006D\\u24DC\\uFF4D\\u1E3F\\u1E41\\u1E43\\u0271\\u026F' },\n  { 'base': 'n', 'letters': '\\u006E\\u24DD\\uFF4E\\u01F9\\u0144\\u00F1\\u1E45\\u0148\\u1E47\\u0146\\u1E4B\\u1E49\\u019E\\u0272\\u0149\\uA791\\uA7A5' },\n  { 'base': 'nj', 'letters': '\\u01CC' },\n  { 'base': 'o', 'letters': '\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275' },\n  { 'base': 'oi', 'letters': '\\u01A3' },\n  { 'base': 'ou', 'letters': '\\u0223' },\n  { 'base': 'oo', 'letters': '\\uA74F' },\n  { 'base': 'p', 'letters': '\\u0070\\u24DF\\uFF50\\u1E55\\u1E57\\u01A5\\u1D7D\\uA751\\uA753\\uA755' },\n  { 'base': 'q', 'letters': '\\u0071\\u24E0\\uFF51\\u024B\\uA757\\uA759' },\n  { 'base': 'r', 'letters': '\\u0072\\u24E1\\uFF52\\u0155\\u1E59\\u0159\\u0211\\u0213\\u1E5B\\u1E5D\\u0157\\u1E5F\\u024D\\u027D\\uA75B\\uA7A7\\uA783' },\n  { 'base': 's', 'letters': '\\u0073\\u24E2\\uFF53\\u00DF\\u015B\\u1E65\\u015D\\u1E61\\u0161\\u1E67\\u1E63\\u1E69\\u0219\\u015F\\u023F\\uA7A9\\uA785\\u1E9B' },\n  { 'base': 't', 'letters': '\\u0074\\u24E3\\uFF54\\u1E6B\\u1E97\\u0165\\u1E6D\\u021B\\u0163\\u1E71\\u1E6F\\u0167\\u01AD\\u0288\\u2C66\\uA787' },\n  { 'base': 'tz', 'letters': '\\uA729' },\n  { 'base': 'u', 'letters': '\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289' },\n  { 'base': 'v', 'letters': '\\u0076\\u24E5\\uFF56\\u1E7D\\u1E7F\\u028B\\uA75F\\u028C' },\n  { 'base': 'vy', 'letters': '\\uA761' },\n  { 'base': 'w', 'letters': '\\u0077\\u24E6\\uFF57\\u1E81\\u1E83\\u0175\\u1E87\\u1E85\\u1E98\\u1E89\\u2C73' },\n  { 'base': 'x', 'letters': '\\u0078\\u24E7\\uFF58\\u1E8B\\u1E8D' },\n  { 'base': 'y', 'letters': '\\u0079\\u24E8\\uFF59\\u1EF3\\u00FD\\u0177\\u1EF9\\u0233\\u1E8F\\u00FF\\u1EF7\\u1E99\\u1EF5\\u01B4\\u024F\\u1EFF' },\n  { 'base': 'z', 'letters': '\\u007A\\u24E9\\uFF5A\\u017A\\u1E91\\u017C\\u017E\\u1E93\\u1E95\\u01B6\\u0225\\u0240\\u2C6C\\uA763' }\n];\nlet diacriticsMap = [];\n  for (let i = 0; i < defaultDiacriticsRemovalMap.length; i++) {\n    let letters = defaultDiacriticsRemovalMap[i].letters;\n    for (let j = 0; j < letters.length; j++) {\n      diacriticsMap[letters[j]] = defaultDiacriticsRemovalMap[i].base;\n    }\n  }\nreturn diacriticsMap;\n})();\n\n\n// \"what?\" version ... http://jsperf.com/diacritics/12\nexport function removeDiacritics(str) {\n  return str.replace(/[^\\u0000-\\u007E]/g, function (a) {\n    return diacriticsMap[a] || a;\n  });\n}\n\nexport function normalizeName(name) {\n  return removeDiacritics(name).toLowerCase().replaceAll(/[^a-zA-Z0-9]/g, '');\n}\n\nexport function normalizedEquals(a,b) {\n  return normalizeName(a) === normalizeName(b);\n}\n\nexport function sortByItemSpecificity({referenceNames = [], packPriority = true} = {}) {\n  const specificityScore = (x) => {\n    let score = 0;\n    const packValue = packPriority ? 4 : 0;\n    const itemValue = 4 - packValue;\n    score += x?.pack ? packValue : itemValue;\n    score += referenceNames.includes(x?.name) ? 2 : 0; // exact match\n    score += x?.isOwner ? 1 : 0;\n    return score;\n  }\n  return (a, b) => specificityScore(b) - specificityScore(a);\n}\n\nfunction partitionByNames(names) {\n  return function (items) {\n    let normalizedNames;\n    if (!names) {\n      normalizedNames = [...new Set(items.map(i => normalizeName(i.name)))];\n    } else {\n      normalizedNames = names.map(normalizeName);\n    }\n    const partitions = Array(normalizedNames.length);\n    for (let j = 0; j < partitions.length; j++) partitions[j] = [];\n    items.forEach(i => {\n      const index = normalizedNames.indexOf(normalizeName(i.name));\n      partitions[index].push(i);\n    });\n    return partitions;\n  }\n}\n\nexport async function findItemsByType(type, {takeOne=false, filterFn, sortFn=sortByItemSpecificity(), partitionFn=partitionByNames()} = {}) {\n  const filterExpression = { type: type }\n  const packItems = (await Promise.all(\n    game.packs\n      .filter(pack => (pack.documentClass.documentName === \"Item\"))\n      .map(pack => pack.getDocuments(filterExpression))\n  )).flatMap(x => x);\n  const worldItems = game.collections.get(\"Item\")\n    .filter(item => item.type === type);\n  let allItems = packItems.concat(worldItems);\n  if (filterFn) {\n    allItems = allItems.filter(filterFn);\n  }\n  if (partitionFn) {\n    const partitions = partitionFn(allItems);\n    if (sortFn) {\n      partitions.forEach(p => p.sort(sortFn));\n    }\n    if (takeOne) {\n      return partitions.map(bin => bin[0] ?? null);\n    }\n    return partitions;\n  } else if (sortFn) {\n    allItems.sort(sortFn);\n  }\n  return takeOne ? (allItems[0] ?? null) : allItems;\n}\n\nexport async function findItemsWorldWide(type, names, opt = {}) {\n  const normalizedNames = names.map(normalizeName);\n  return findItemsByType(type, {\n    ...opt,\n    filterFn: (i) => normalizedNames.includes(normalizeName(i.name)),\n    sortFn: sortByItemSpecificity({referenceNames: names}),\n    partitionFn: partitionByNames(names)\n  });\n}\n\nexport async function findItemWorldWide(type, name) {\n  return findItemsWorldWide(type, [name], {takeOne: true}).then(a => a[0]);\n}","import * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderBaseActor {\n\n  prepareEmbeddedEntities(actorData) {\n\n  }\n\n  getRollData(rollData) {\n    //TODO: make attributes more accessible here\n    return rollData;\n  }\n\n\n  buildPerilDamageLadder(data, initialPeril, initialDamage) {\n    const ladder = [\n      \"value\",\n      \"valuePlusSix\",\n      \"valuePlusTwelve\",\n      \"valuePlusEighteen\"\n    ];\n    let ladderIncrement = 0;\n    data.stats.secondaryAttributes.perilThreshold = {};\n    data.stats.secondaryAttributes.damageThreshold = {};\n    ladder.forEach((v) => {\n      data.stats.secondaryAttributes.perilThreshold[v] = initialPeril + ladderIncrement;\n      data.stats.secondaryAttributes.damageThreshold[v] = initialDamage + ladderIncrement;\n      ladderIncrement += 6;\n    })\n  }\n\n  getPerilMalus(data) {\n    return {\n      0: 30,\n      1: 30,\n      2: 20,\n      3: 10\n    }[data.stats.secondaryAttributes.perilCurrent.value] ?? 0;\n  }\n\n  async createEmbeddedDocuments(embeddedName, data, context, actor) {\n    if (embeddedName === \"Item\") {\n      const filteredData = [];\n      let ancestryAttached = actor.data.ancestry.length === 1;\n      let numberOfProfessionsAttached = actor.data.professions.length;\n      for (let item of data) {\n        if (item.type === \"profession\") {\n          const previousTiersCompleted = actor.data.professions\n            .map(profession => profession.data.tier.completed)\n            .every(value => value === true);\n          const allTiersAssigned = numberOfProfessionsAttached == 3;\n          const dragDroppedOwnProfession = actor.data.professions.some(p => p._id === item._id);\n          if (allTiersAssigned && !dragDroppedOwnProfession) {\n            ui.notifications.error(\"A character may not enter more than 3 Professions.\");\n          } else if (!previousTiersCompleted && !dragDroppedOwnProfession) {\n            ui.notifications.error(\"A character must complete the previous Tier before entering a new Profession.\");\n          }\n          if (!allTiersAssigned && previousTiersCompleted) {\n            filteredData.push(item);\n            numberOfProfessionsAttached++;\n          }\n        } else if (item.type === \"ancestry\") {\n          if (ancestryAttached) {\n            ui.notifications.error(\"A character may not possess more than 1 Ancestry.\");\n          } else {\n            filteredData.push(item);\n            ancestryAttached = true;\n          }\n        } else {\n          filteredData.push(item);\n        }\n      }\n      return filteredData;\n    }\n    return data;\n  }\n  \n}","export default class ZweihanderActorConfig extends FormApplication {\n\n  static defaultConfiguration = {\n      \"dthAttribute\": \"brawn\",\n      \"pthAttribute\": \"willpower\",\n      \"intAttribute\": \"perception\",\n      \"movAttribute\": \"agility\",\n      \"perilOffset\": 0,\n      \"encumbranceModifier\": 0,\n      \"initiativeModifier\": 0,\n      \"movementModifier\": 0,\n      \"parrySkills\": [\"Simple Melee\", \"Martial Melee\", \"Guile\", \"Charm\", \"Incantation\"],\n      \"dodgeSkills\": [\"Coordination\", \"Guile\", \"Drive\", \"Ride\"],\n      \"magickSkills\": [\"Incantation\", \"Folklore\"]\n  };\n\n  static getValue(actorData, key) {\n    const value = getProperty(actorData.flags, `zweihander.actorConfig.${key}`);\n    return value ?? this.defaultConfiguration[key];\n  }\n\n  static getConfig(actorData) {\n    const cfg = {};\n    for (let key in this.defaultConfiguration) {\n      cfg[key] = this.getValue(actorData, key);\n    }\n    return cfg;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"zweihander sheet actor-config\"],\n      id: \"zweihander_actor_config\",\n      template: \"systems/zweihander/templates/actor/actor-config.hbs\",\n      width: 500\n    });\n  }\n\n  /** @override */\n  get title() {\n    return `${this.object.name}: Actor Configuration`;\n  }\n\n  /** @override */\n  getData() {\n    const data = super.getData();\n\n    data.flags = ZweihanderActorConfig.getConfig(this.object.data);\n\n    data.parrySkills = data.flags.parrySkills.join(\", \");\n    data.dodgeSkills = data.flags.dodgeSkills.join(\", \");\n\n    return data;\n  }\n\n  /** @override */\n  async _updateObject(event, formData) {\n    const actor = this.object;\n    \n    let updateData = foundry.utils.expandObject(formData).flags;\n\n    let parrySkills = updateData.parrySkills.split(\",\").map(skill => skill.trim());\n    let dodgeSkills = updateData.dodgeSkills.split(\",\").map(skill => skill.trim());\n\n    updateData.parrySkills = parrySkills;\n    updateData.dodgeSkills = dodgeSkills;\n\n    await actor.setFlag(\"zweihander\", \"actorConfig\", updateData);\n  }\n}","import ZweihanderBaseActor from \"./base-actor\";\nimport * as ZweihanderUtils from \"../../utils\";\nimport ZweihanderActorConfig from \"../../apps/actor-config\";\n\nexport default class ZweihanderPC extends ZweihanderBaseActor {\n\n  prepareBaseData(actorData, that) {\n\n  }\n\n  prepareEmbeddedEntities(actorData) {\n    // set up collections for all item types\n    const indexedTypes = [\n      \"trapping\", \"condition\", \"injury\", \"disease\", \"disorder\", \"profession\",\n      \"ancestry\", \"armor\", \"weapon\", \"spell\", \"ritual\", \"talent\", \"trait\",\n      \"drawback\", \"quality\", \"skill\", \"uniqueAdvance\"\n    ];\n    const pluralize = t => ({\n      'injury': 'injuries',\n      'ancestry': 'ancestry',\n      'armor': 'armor',\n      'quality': 'qualities'\n    }[t] ?? t + \"s\");\n    indexedTypes.forEach(t => actorData[pluralize(t)] = []);\n    actorData.items\n      .filter(i => indexedTypes.includes(i.type))\n      .forEach(i => actorData[pluralize(i.type)].push(i.toObject(false)));\n    // sort skills\n    actorData.skills = actorData.skills.sort((a, b) => a.name.localeCompare(b.name));\n    // enrich drawback data to distinguish between drawbacks gained through professions and drawbacks bought\n    // this is unfortunately not robust but I don't see a way to make it robust without bloating the data model\n    //TODO: move to derivedData (or better even to item classes)\n  }\n  prepareDerivedData(actorData) {\n    const noWarn = actorData._id === null;\n    const configOptions = ZweihanderActorConfig.getConfig(actorData);\n    // set up utility variables\n    const data = actorData.data;\n    const derived = {};\n    data.derived = derived;\n    // calculate reward points automatically\n    if (game.settings.get(\"zweihander\", \"trackRewardPoints\")) {\n      const tierMultiplier = {\n        \"Basic\": 100,\n        \"Intermediate\": 200,\n        \"Advanced\": 300\n      }\n      data.rewardPoints.spent = actorData.professions\n        .map(profession => tierMultiplier[profession.data.tier.value] * profession.data.tier.advancesPurchased)\n        .concat(actorData.uniqueAdvances.map(advance => advance.data.rewardPointCost.value))\n        .reduce((a, b) => a + b, 0);\n      data.rewardPoints.current = data.rewardPoints.total - data.rewardPoints.spent;\n    }\n    data.tier = actorData.professions[actorData.professions.length-1]?.data.tier.value ?? '';\n    // calculate primary attribute bonuses (first digit)\n    Object.values(data.stats.primaryAttributes).forEach(a => a.bonus = Math.floor(a.value / 10));\n    // add ancestral modifiers to the primary attribute bonuses\n    const ancestry = actorData.ancestry[0];\n    const applyBonusModifiers = (list, mod, source) => list.forEach(a => {\n      const attr = ZweihanderUtils.primaryAttributeMapping[a.slice(1,2)];\n      //TODO should be safe to remove this after migration of existing data\n      if (!attr) {\n        ui?.notifications?.warn(`\"${a.trim()}\" is not a valid primary attribute bonus abbreviation in ${source}!`);\n        return;\n      }\n      data.stats.primaryAttributes[attr].bonus += mod;\n    })\n    // ancestral bonus advances\n    if (ancestry) {\n      applyBonusModifiers(ancestry.data.ancestralModifiers.positive, +1, `ancestry ${ancestry.name} of actor ${actorData.name}`);\n      applyBonusModifiers(ancestry.data.ancestralModifiers.negative, -1, `ancestry ${ancestry.name} of actor ${actorData.name}`);\n    }\n    // professional bonus advances\n    actorData.professions.forEach(p => {\n      const advancesList = p.data.bonusAdvances.filter(a => a.purchased).map(a => a.value);\n      applyBonusModifiers(advancesList, +1, `profession ${p.name} of actor ${actorData.name}`);\n    })\n    // get equipped armor\n    const equippedArmor = actorData.armor\n      .filter(a => a.data.equipped)\n    // calculate total damage threshold modifier from armor\n    // according to the rule book, this doesn't stack, so we choose the maximium!\n    // to account for shields with \"maker's mark\" quality, we need to implement active effects\n    data.derived.dtm = Math.max(0, ...(equippedArmor.map(a => a.data.damageThresholdModifier.value)))\n    // assign inital peril & damage\n    let perilModifier = 3;\n    let initialPeril = data.stats.primaryAttributes[configOptions.pthAttribute].bonus + perilModifier;\n    let damageModifier = data.derived.dtm;\n    let initialDamage = data.stats.primaryAttributes[configOptions.dthAttribute].bonus + damageModifier;\n    // build ladder\n    this.buildPerilDamageLadder(data, initialPeril, initialDamage);\n    // get peril malus\n    const perilMalus = this.getPerilMalus(data);\n    // calculate special actions underlying values\n    const calcSecondayAttributeSpecialActionValue = (secAttr, name) => {\n      const item = actorData.skills.find(skill => skill.name === secAttr.associatedSkill);\n      if (item) {\n        const primAttr = item.data.associatedPrimaryAttribute.value.toLowerCase();\n        secAttr.value = data.stats.primaryAttributes[primAttr].value + Math.max(0, item.data.bonus - perilMalus);\n      } else {\n        noWarn || ui?.notifications?.warn(`Can't find associated skill ${secAttr.associatedSkill} for secondary attribute ${name}!`);\n      }\n    }\n    //calculate parry\n    calcSecondayAttributeSpecialActionValue(data.stats.secondaryAttributes.parry, \"Parry\");\n    //calculate parry\n    calcSecondayAttributeSpecialActionValue(data.stats.secondaryAttributes.dodge, \"Dodge\");\n    //calculate parry\n    calcSecondayAttributeSpecialActionValue(data.stats.secondaryAttributes.magick, \"Magick\");\n    // encumbrance calculations...\n    // assign encumbrance from equipped trappings\n    const carriedTrappings = actorData.trappings.filter(t => t.data.carried);\n    const nine4one = game.settings.get(\"zweihander\", \"encumbranceNineForOne\");\n    const smallTrappingsEnc = !nine4one ? 0 : Math.floor(\n      carriedTrappings\n        .filter(t => t.data.encumbrance.value === 0)\n        .map(t => t.data.quantity.value)\n        .reduce((a, b) => a + b, 0) / 9\n    );\n    const normalTrappingsEnc = carriedTrappings\n      .filter(t => t.data.encumbrance.value !== 0)\n      .map(t => t.data.encumbrance.value * t.data.quantity.value)\n      .reduce((a, b) => a + b, 0);\n    // assign encumbrance from coinage\n    const coinageEnc = Math.floor(\n      Object.entries(data.coinage).map(e => e[1]).reduce((a, b) => a + b, 0) / 1000\n    );\n    // assign encumbrance from equipped armor piece\n    const armorEnc = equippedArmor\n      .map(a => a.data.encumbrance.value)\n      .reduce((a, b) => a + b, 0);\n    // assign encumbrance from equipped weapons\n    const weaponEnc = actorData.weapons\n      .filter(w => w.data.equipped)\n      .map(w => w.data.encumbrance.value)\n      .reduce((a, b) => a + b, 0);\n    const enc = data.stats.secondaryAttributes.encumbrance = {};\n    // assign initial encumbrance threshold\n    enc.value = data.stats.primaryAttributes.brawn.bonus + 3 + configOptions.encumbranceModifier;\n    // assign current encumbrance\n    enc.current = smallTrappingsEnc + normalTrappingsEnc + coinageEnc\n      + armorEnc + weaponEnc;\n    // assign overage\n    enc.overage = Math.max(0, enc.current - enc.value)\n    // calculate initiative\n    const ini = data.stats.secondaryAttributes.initiative = {};\n    ini.value = data.stats.primaryAttributes[configOptions.intAttribute].bonus + 3 + configOptions.initiativeModifier;\n    ini.overage = enc.overage;\n    ini.current = Math.max(0, ini.value - ini.overage);\n    // calculate movement\n    const mov = data.stats.secondaryAttributes.movement = {};\n    mov.value = data.stats.primaryAttributes[configOptions.movAttribute].bonus + 3 + configOptions.movementModifier;\n    mov.overage = enc.overage;\n    mov.current = Math.max(0, mov.value - mov.overage);\n    //TODO: this should be done in items!\n    for (let armor of actorData.armor) armor.data.qualities.arrayOfValues = armor.data.qualities.value.split(\", \");\n    for (let weapon of actorData.weapons) weapon.data.qualities.arrayOfValues = weapon.data.qualities.value.split(\", \");\n  }\n\n  getRollData(rollData) {\n    //TODO: make attributes more accessible here\n    return rollData;\n  }\n\n  async _preCreate(actorData, options, user, that) {\n    // add default set of skills\n    let skillPack = game.packs.get(\"zweihander.skills\");\n    let toAdd = await skillPack.getDocuments();\n\n    // Prevent duplicating skills (e.g. when duplicating an Actor)\n    let toAddDifference = ZweihanderUtils.getSymmetricDifference(toAdd.map(item => item.toObject()), actorData.skills);\n    if (toAddDifference.length) actorData.update({ \"items\": toAddDifference });\n  }\n\n}","import ZweihanderBaseActor from \"./base-actor\";\nimport * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderCreature extends ZweihanderBaseActor {\n\n  prepareEmbeddedEntities(actorData) {\n    const weapons = [];\n    const ancestry = [];\n    const spells = [];\n    const rituals = [];\n    const skills = [];\n    const talents = [];\n    const traits = [];\n    const trappings = [];\n    const injuries = [];\n    const conditions = [];\n\n    for (let item of actorData.items.values()) {\n      if (item.type === \"weapon\")\n        weapons.push(item.data);\n      else if (item.type === \"ancestry\")\n        ancestry.push(item.data);\n      else if (item.type === \"spell\")\n        spells.push(item.data);\n      else if (item.type === \"ritual\")\n        rituals.push(item.data);\n      else if (item.type === \"skill\")  // TODO: Don't allow duplicate Skills -- !skills.some(skill => skill.name === item.name)\n        skills.push(item.data);\n      else if (item.type === \"talent\")\n        talents.push(item.data);\n      else if (item.type === \"trait\")\n        traits.push(item.data);\n      else if (item.type === \"trapping\")\n        trappings.push(item.data);\n      else if (item.type === \"injury\")\n        injuries.push(item.data);\n      else if (item.type === \"condition\")\n        conditions.push(item.data);\n    }\n\n    actorData.weapons = weapons;\n    actorData.ancestry = ancestry;\n    actorData.spells = spells;\n    actorData.rituals = rituals;\n\n    actorData.skills = skills.sort((skillA, skillB) => {\n      const nameA = skillA.name;\n      const nameB = skillB.name;\n\n      if (nameA < nameB) {\n        return -1;\n      }\n\n      if (nameA > nameB) {\n        return 1;\n      }\n\n      return 0;\n    });\n\n    actorData.talents = talents;\n    actorData.traits = traits;\n    actorData.trappings = trappings;\n    actorData.injuries = injuries;\n    actorData.conditions = conditions;\n\n  }\n\n  getRollData(rollData) {\n    //TODO: make attributes more accessible here\n    return rollData;\n  }\n\n  prepareDerivedData(actorData) {\n    const data = actorData.data;\n\n    // Assign Peril Threshold values\n    let initialPeril = data.stats.primaryAttributes.willpower.bonus, perilModifier = 3;\n\n    const perilArray = Object.keys(data.stats.secondaryAttributes.perilThreshold);\n\n    perilArray.forEach((v) => {\n      data.stats.secondaryAttributes.perilThreshold[v] = initialPeril + perilModifier;\n      perilModifier += 6;\n    })\n\n\n    // Assign Damage Threshold values\n    let initialDamage = data.stats.primaryAttributes.brawn.bonus, damageModifier = 6;\n\n    const damageArray = Object.keys(data.stats.secondaryAttributes.damageThreshold);\n\n    data.stats.secondaryAttributes.damageThreshold[damageArray[0]] = initialDamage;\n\n    for (let i = 1; i < damageArray.length; i++)\n      data.stats.secondaryAttributes.damageThreshold[damageArray[i]] = initialDamage += damageModifier;\n  }\n\n}","import ZweihanderCreature from \"./creature\";\nimport * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderNPC extends ZweihanderCreature {\n\n\n}","import ZweihanderPC from \"./entity/pc\";\nimport ZweihanderNPC from \"./entity/npc\";\nimport ZweihanderCreature from \"./entity/creature\";\n\nexport default class ZweihanderActor extends Actor {\n\n  static types = {\n    character: new ZweihanderPC(),\n    npc: new ZweihanderNPC(),\n    creature: new ZweihanderCreature()\n  };\n\n  constructor(...args) {\n    super(...args);\n  }\n\n  // convention: dispatch is async when the function it calls is\n  dispatch(fnName, cfg = {orElse: {value: {}, async: false}, args: []}) {\n    // console.log(`${this.name}: dispatch: ${fnName}`);\n    if (ZweihanderActor.types[this.type]) {\n      const type = ZweihanderActor.types[this.type];\n      if (type[fnName] && typeof type[fnName] === \"function\") {\n        if (cfg?.args?.length) {\n          return (type[fnName])(...cfg.args, this);\n        } else {\n          return (type[fnName])(this.data, this);\n        }\n      }\n    }\n    if (cfg?.orElse?.async) {\n      return Promise.resolve(cfg?.orElse?.value);\n    } else {\n      return cfg?.orElse?.value;\n    }\n  }\n\n  prepareData() {\n    super.prepareData();\n  }\n\n  prepareBaseData() {\n    super.prepareBaseData();\n    this.dispatch(\"prepareBaseData\");\n  }\n\n  prepareEmbeddedDocuments(...args) {\n    if (super.prepareEmbeddedDocuments) super.prepareEmbeddedDocuments();\n    this.dispatch(\"prepareEmbeddedEntities\");\n  }\n\n  prepareEmbeddedEntities() {\n    if (super.prepareEmbeddedEntities) super.prepareEmbeddedEntities();\n    this.dispatch(\"prepareEmbeddedEntities\");\n  }\n\n  applyActiveEffects() {\n    super.applyActiveEffects();\n    this.dispatch(\"applyActiveEffects\");\n  }\n\n  prepareDerivedData() {\n    super.prepareDerivedData();\n    this.dispatch(\"prepareDerivedData\");\n  }\n\n  getRollData() {\n    return this.dispatch(\"getRollData\", {args: [this.data.data], orElse: {value: this.data.data}});\n  }\n\n  /** @override*/\n  async _preCreate(data, options, user) {\n    await super._preCreate(data, options, user);\n    await this.dispatch(\"_preCreate\", {args: [this.data, options, user]});\n  }\n\n  /** @override*/\n  async _onCreate(data, options, user) {\n    await super._onCreate(data, options, user);\n    // TODO: user is an incorrect parameter and will be fixed in future versions\n    if (user !== game.user.id)\n      return;\n    await this.dispatch(\"_onCreate\", {args: [data, options, user]});\n  }\n\n  async createEmbeddedDocuments(embeddedName, data, context = {}) {\n    const enrichedData = await this.dispatch(\"createEmbeddedDocuments\", {args: [embeddedName, data, context]});\n    if (enrichedData) {\n      return super.createEmbeddedDocuments(embeddedName, enrichedData, context)\n    }\n  }\n\n  async updateEmbeddedDocuments(embeddedName, updates, context = {}) {\n    const enrichedUpdates = await this.dispatch(\"updateEmbeddedDocuments\", {args: [embeddedName, updates, context], orElse: {value: updates, async: true}});\n    if (enrichedUpdates) {\n      return super.updateEmbeddedDocuments(embeddedName, enrichedUpdates, context);\n    }\n  }\n\n  async deleteEmbeddedDocuments(embeddedName, ids, context = {}) {\n    await this.dispatch(\"deleteEmbeddedDocuments\", {args: [embeddedName, ids, context]});\n    return super.deleteEmbeddedDocuments(embeddedName, ids, context);\n  }\n\n   /* -------------------------------------------- */\n\n   _preCreateEmbeddedDocuments(embeddedName, result, options, userId) {\n    super._preCreateEmbeddedDocuments(embeddedName, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_preCreateEmbeddedDocuments\", {args: [embeddedName, result, options, userId]});\n   }\n\n   _onCreateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\n    super._onCreateEmbeddedDocuments(embeddedName, documents, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_onCreateEmbeddedDocuments\", {args: [embeddedName, documents, result, options, userId]});\n   }\n\n   _preUpdateEmbeddedDocuments(embeddedName, result, options, userId) {\n    super._preUpdateEmbeddedDocuments(embeddedName, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_preUpdateEmbeddedDocuments\", {args: [embeddedName, result, options, userId]});\n   }\n\n   _onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\n    super._onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_onUpdateEmbeddedDocuments\", {args: [embeddedName, documents, result, options, userId]});\n   }\n\n   _preDeleteEmbeddedDocuments(embeddedName, result, options, userId) {\n    super._preDeleteEmbeddedDocuments(embeddedName, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_preDeleteEmbeddedDocuments\", {args: [embeddedName, result, options, userId]});\n   }\n \n   _onDeleteEmbeddedDocuments(embeddedName, documents, result, options, userId) {\n    super._onDeleteEmbeddedDocuments(embeddedName, documents, result, options, userId);\n    if (userId === game.user.id)\n      this.dispatch(\"_onDeleteEmbeddedDocuments\", {args: [embeddedName, documents, result, options, userId]});\n   }\n \n\n}\n","import * as ZweihanderUtils from \"../utils\";\n\nexport default class ZweihanderDice {\n\n  /**\n   * The primary function responsible for generating a ChatMessage for a given Skill Test.\n   * \n   * @param {*} skillItem The skill Item associated with the roll.\n   * @param {object} actorData The ActorData object of the Actor rolling.\n   * @param {object} optionalData An optional data object that could be relevant to the roll. Can contain e.g. weapon qualities or spell effects.\n   * @param {(\"skill\" | \"weapon\" | \"spell\" | \"dodge\" | \"parry\")} rollType The type of roll to be generated.\n   */\n  static async rollSkillTest(skillItem, actorData, rollType, optionalData = {}) {\n    const primaryAttribute = skillItem.data.associatedPrimaryAttribute.value;\n    const rollTarget = actorData.data.stats.primaryAttributes[primaryAttribute.toLowerCase()].value;\n\n    const rankBonus = skillItem.data.bonus;\n\n    const currentPeril = Number(actorData.data.stats.secondaryAttributes.perilCurrent.value);\n    const perilPenalty = this._calculatePerilPenalty(currentPeril, rankBonus);\n\n    const baseChanceModifier = this._calculateBaseChanceModifier(rankBonus, perilPenalty);\n\n    const rollConfig = await this._renderConfigurationDialog(rollType, skillItem.name, optionalData);\n\n    const additionalChaosDice = rollConfig.additionalChaosDice ? rollConfig.additionalChaosDice : 0;\n    const additionalFuryDice = rollConfig.additionalFuryDice ? rollConfig.additionalFuryDice : 0;\n\n    let difficultyRating = Number(rollConfig.difficultyRating);\n\n    if (rollConfig.channelPowerBonus)\n      difficultyRating += Number(rollConfig.channelPowerBonus);\n\n    if (difficultyRating > 30)\n      difficultyRating = 30;\n\n    const difficultyRatingLabel = this._getDifficultyRatingLabel(difficultyRating);\n\n    const flip = rollConfig.flip;\n\n    const totalChance = this._calculateTotalChance(rollTarget, baseChanceModifier, difficultyRating);\n\n    let roll = new Roll(CONFIG.ZWEI.testRollFormula, actorData.data);\n    let rollResult = await roll.evaluate({ \"async\": true });\n    let rollResultTotal = rollResult._total;\n\n    const deconstructedRollData = this._getDeconstructedRollData(rollResultTotal);\n\n    let testResult = this._getTestResult(rollResultTotal, totalChance, deconstructedRollData.match);  // c_fail = 0, fail = 1, success = 2, c_success = 3\n\n    let [finalRoll, showFlip, finalTestResult] = this._handleFlippedResult(rollResultTotal, totalChance, testResult, deconstructedRollData, flip);\n\n    let damageData;\n    let chaosData;\n\n    if (rollType === \"weapon\") {\n      optionalData.formula = optionalData.formula.replace(\"[#]\", additionalFuryDice);\n      optionalData.formula = ZweihanderUtils.abbreviations2DataPath(optionalData.formula);\n\n      let damageRoll = await this._rollFuryDice(optionalData, actorData);\n      // step 1: add all fury die to an exploding-aware string\n      // step 2: add static modifiers\n      //   solution:\n      //      1. count dice in formula\n      //      we could assume its always 1 but lets be cautious.\n      //      maybe some extension will require us to roll d10 +d6 for damage, who knows..\n      //      2. remove dice terms from total result string\n      //      3. prepend our custom exploding-aware string\n      let indexedDiceTerms = damageRoll.terms\n        .filter(x => x?.number >= 0)\n        .map((x, i) => ({ value: x, index: i }))\n        .filter(x => x.value?.faces);\n      let terms = damageRoll.result.split(\" + \");\n      let explodedTerms = [];\n      for (let i = 0; i < terms.length; i++) {\n        for (let indexedDiceTerm of indexedDiceTerms) {\n          if (indexedDiceTerm.index == i) {\n            indexedDiceTerm.value.results\n            .map(v => v.result + (v?.exploded ? \"*\" : \"\"))\n            .forEach(t => explodedTerms.push(t));\n          } else {\n            explodedTerms.push(terms[i]);\n          }\n        }\n      }\n      let furyDiceString;\n      if (explodedTerms.length === 0) {\n        furyDiceString = \"0\";\n      } else {\n        furyDiceString = explodedTerms.reduce((a, b) => a + \" + \" + b);\n      }\n      damageData = {\n        \"damage\": damageRoll.total,\n        \"damageFormula\": damageRoll.formula,\n        \"furyDiceString\": furyDiceString,\n        \"additionalRoll\": damageRoll\n      }\n    } else if (rollType === \"spell\" && Number(rollConfig.channelPowerBonus)) {\n      const numberOfDice = rollConfig.channelPowerBonus / 10;\n\n      let chaosRoll = await this._rollChaosDice(actorData, numberOfDice + Number(additionalChaosDice));\n\n      chaosData = {\n        \"chaosFormula\": chaosRoll._formula,\n        \"chaosDice\": chaosRoll.dice,\n        \"channelPowerBonus\": rollConfig.channelPowerBonus,\n        \"additionalRoll\": chaosRoll\n      }\n    }\n\n    rollResult.render().then(() => {\n      let templateData = {\n        \"skill\": skillItem.name,\n        \"primaryAttribute\": primaryAttribute,\n        \"attributeChance\": rollTarget,\n        \"rankBonus\": rankBonus,\n        \"baseChance\": rollTarget + baseChanceModifier,\n        \"totalChance\": totalChance,\n        \"difficultyRating\": {\n          \"value\": difficultyRating,\n          \"label\": difficultyRatingLabel\n        },\n        \"perilPenalty\": perilPenalty,\n        \"roll\": (finalRoll).toLocaleString(undefined, { \"minimumIntegerDigits\": 2 }),\n        \"image\": actorData.img,\n        \"showFlip\": showFlip,\n        \"flip\": flip,\n        \"testResult\": finalTestResult\n      };\n\n      if (!ZweihanderUtils.isObjectEmpty(damageData))\n        foundry.utils.mergeObject(templateData, damageData);\n      else if (!ZweihanderUtils.isObjectEmpty(chaosData))\n        foundry.utils.mergeObject(templateData, chaosData);\n\n      if (!ZweihanderUtils.isObjectEmpty(optionalData))\n        foundry.utils.mergeObject(templateData, optionalData);\n      const template = this._getTemplate(rollType);\n\n      // prepare roll data for dice so nice\n      rollResult.dice[0].options.rollOrder = 1;\n      const rolls = [rollResult];\n      if (templateData.additionalRoll && finalTestResult >= 2) {\n        templateData.additionalRoll.dice[0].options.rollOrder = 2;\n        rolls.push(templateData.additionalRoll);\n      }\n      const pool = PoolTerm.fromRolls(rolls);\n      roll = Roll.fromTerms([pool]);\n\n      this._renderChatCard(template, templateData, roll);\n    });\n  }\n\n  /**\n   * Function responsible for rendering a ChatMessage.\n   * \n   * @param {*} template The Handlebars template to be used for this ChatMessage.\n   * @param {*} templateData The data object to be used by the template.\n   */\n  static async _renderChatCard(template, templateData, roll) {\n    renderTemplate(template, templateData).then(html => {\n      let chatData = {\n        \"roll\": roll,\n        \"type\": CONST.CHAT_MESSAGE_TYPES.ROLL,\n        \"user\": game.user.id,\n        \"speaker\": ChatMessage.getSpeaker({ actor: this.actor }),\n        \"content\": html\n      };\n\n      ChatMessage.create(chatData);\n    });\n  }\n\n  /**\n   * Calculate the penalty to be applied to a roll's base chance due to peril. If a character has no ranks in a skill, the penalty returned is 0.\n   * \n   * @param {number} currentPeril The current peril value of the Actor.\n   * @param {number} rankBonus The bonus provided by purchased skill ranks.\n   * @returns \n   */\n  static _calculatePerilPenalty(currentPeril, rankBonus) {\n    if (currentPeril === 3 && rankBonus >= 10) {\n      return 10;\n    } else if (currentPeril === 2 && rankBonus >= 10 && rankBonus < 20) {\n      return 10;\n    } else if (currentPeril === 2 && rankBonus >= 20) {\n      return 20;\n    } else if (currentPeril === 1 && rankBonus >= 10 && rankBonus < 20) {\n      return 10;\n    } else if (currentPeril === 1 && rankBonus >= 20 && rankBonus < 30) {\n      return 20;\n    } else if (currentPeril === 1 && rankBonus >= 30) {\n      return 30;\n    } else {\n      return 0;\n    }\n  }\n\n  /**\n   * Calculate the final modifier to be applied to a roll's base chance. Returned value cannot be higher than 30, or lower than -30.\n   * \n   * @param {number} rankBonus The bonus provided by purchased skill ranks.\n   * @param {number} perilPenalty The penalty to be applied due to peril.\n   * @returns \n   */\n  static _calculateBaseChanceModifier(rankBonus, perilPenalty) {  // TODO: add Talents, Traits and Active Effects\n    let baseChanceModifier = rankBonus - perilPenalty;\n\n    if (baseChanceModifier > 30)\n      baseChanceModifier = 30;\n    else if (baseChanceModifier < -30)\n      baseChanceModifier = -30;\n\n    return baseChanceModifier;\n  }\n\n  /**\n   * Calculate the total chance for the roll to succeed based off of the initial roll target, base chance modifiers and the difficulty rating.\n   * \n   * @param {number} rollTarget The initial target for the roll, without any modifiers.\n   * @param {number} baseChanceModifier The final modifier to be applied to the target.\n   * @param {number} difficultyRating The difficulty rating to be applied to the roll.\n   * @returns \n   */\n  static _calculateTotalChance(rollTarget, baseChanceModifier, difficultyRating) {\n    let totalChance = rollTarget + baseChanceModifier + difficultyRating;\n\n    return (totalChance >= 100 ? 99 : (totalChance < 1 ? 1 : totalChance)).toLocaleString(undefined, { \"minimumIntegerDigits\": 2 });\n  }\n\n  /**\n   * Function responsible for rolling Fury Dice, according to a given damage formula.\n   * \n   * @param {object} actorData The ActorData object of the Actor rolling.\n   * @param {object} damageData An object with relevant weapon data, such as the damage formula.\n   * @returns \n   */\n  static async _rollFuryDice(damageData, actorData) {\n    let roll = new Roll(damageData.formula, actorData.data);\n    let rollResult = await roll.evaluate({ \"async\": true });\n    return rollResult;\n  }\n\n  /**\n   * Function responsible for rolling a variable number of Chaos Dice.\n   * \n   * @param {number} actorData The ActorData object of the Actor rolling.\n   * @param {number} numberOfDice The initial number of Chaos Dice to be rolled.\n   * @returns \n   */\n  static async _rollChaosDice(actorData, numberOfDice) {\n    let finalFormula = numberOfDice + \"d6\";\n\n    let roll = new Roll(finalFormula, actorData.data);\n    let rollResult = await roll.evaluate({ \"async\": true });\n\n    return rollResult;\n  }\n\n  /**\n   * Function responsible for rendering a Dialog object, through which a user can configure a skill test.\n   * \n   * @param {string} rollType The type of roll. Different types result in different Dialogs being rendered.\n   * @param {string} label The name of the skill that is displayed on the rendered window header.\n   * @param {object} optionalData An optional data object to be used by the Dialog template.\n   * @returns An object containing a roll's configuration options, based on the type of roll.\n   */\n  static async _renderConfigurationDialog(rollType, label, optionalData = {}) {\n    switch (rollType) {\n      case \"dodge\":\n      case \"parry\":\n      case \"skill\":\n        return await new Promise((resolve) => {\n          renderTemplate(CONFIG.ZWEI.templates.skillConfigurationDialog, optionalData).then(c => {\n            this._createDialog(label, c, (html) => {\n              // let input = html.find('[name=\"exampleInput\"]').val();\n              let difficultyRating = html.find('[name=\"difficultyRatingSelect\"]').val();\n              let flip = html.find('[name=\"flipSelect\"]').val();\n\n              // resolve({ input, difficultyRating, flip });\n              resolve({ difficultyRating, flip });\n            }).render(true);\n          });\n        });\n      case \"spell\":\n        return await new Promise((resolve) => {\n          renderTemplate(CONFIG.ZWEI.templates.spellConfigurationDialog, optionalData).then(c => {\n            this._createDialog(label, c, (html) => {\n              let additionalChaosDice = html.find('[name=\"extraChaos\"]').val();\n              let difficultyRating = html.find('[name=\"difficultyRatingSelect\"]').val();\n              let channelPowerBonus = html.find('[name=\"channelSelect\"]').val();\n              let flip = html.find('[name=\"flipSelect\"]').val();\n\n              resolve({ additionalChaosDice, difficultyRating, channelPowerBonus, flip });\n            }).render(true);\n          });\n        });\n      case \"weapon\":\n        return await new Promise((resolve) => {\n          renderTemplate(CONFIG.ZWEI.templates.weaponConfigurationDialog, optionalData).then(c => {\n            this._createDialog(label, c, (html) => {\n              let additionalFuryDice = html.find('[name=\"extraFury\"]').val();\n              let difficultyRating = html.find('[name=\"difficultyRatingSelect\"]').val();\n              let channelPowerBonus = html.find('[name=\"channelSelect\"]').val();\n              let flip = html.find('[name=\"flipSelect\"]').val();\n\n              resolve({ additionalFuryDice, difficultyRating, channelPowerBonus, flip });\n            }).render(true);\n          });\n        });\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Build a Dialog object in accordance to the label and content provided. \n   * \n   * @param {string} label A string to be displayed on the window header.\n   * @param {string} content The HTML content to be rendered inside the Dialog window.\n   * @param {function} callbackOnYes The callback function to be executed if the 'Yes' option is selected.\n   * @returns A Dialog object.\n   */\n  static _createDialog(label, content, callbackOnYes) {\n    return new Dialog({\n      \"title\": `${label}: Test Configuration`,\n      \"content\": content,\n      \"buttons\": {\n        \"no\": {\n          \"icon\": '<i class=\"fas fa-times\"></i>',\n          \"label\": 'Cancel'\n        },\n        \"yes\": {\n          \"icon\": '<i class=\"fas fa-check\"></i>',\n          \"label\": 'Roll',\n          \"callback\": callbackOnYes\n        },\n      },\n      \"default\": 'yes'\n    });\n  }\n\n  /**\n   * Get a label that describes the difficulty rating.\n   * \n   * @param {number} difficultyRating The numeric difficulty rating.\n   * @returns A verbose string representation of the difficulty rating.\n   */\n  static _getDifficultyRatingLabel(difficultyRating) {\n    switch (difficultyRating) {\n      case -30:\n        return \"Arduous -30%\"\n      case -20:\n        return \"Hard -20%\"\n      case -10:\n        return \"Challenging -10%\"\n      case 0:\n        return \"Standard +/-0%\"\n      case 10:\n        return \"Routine +10%\"\n      case 20:\n        return \"Easy +20%\"\n      case 30:\n        return \"Trivial +30%\"\n      default:\n        return \"ERROR\"\n    }\n  }\n\n  /**\n   * Get the result of a skill test based on the roll result and the chance of success.\n   * \n   * @param {number} rollResultTotal The final roll result.\n   * @param {number} totalChance The total chance of success.\n   * @param {boolean} match A flag used to tell whether the roll result's units and tens digits match. Used to determine critical success or failure.\n   * @returns A number representing the result of the roll. 0 is a critical failure, 1 is a failure, 2 is a success and 3 is a critical success.\n   */\n  static _getTestResult(rollResultTotal, totalChance, match) {\n    if (rollResultTotal === 100)\n      return 0;\n    else if (rollResultTotal === 1)\n      return 3;\n    else if (rollResultTotal <= totalChance && match)\n      return 3;\n    else if (rollResultTotal <= totalChance && !match)\n      return 2;\n    else if (rollResultTotal > totalChance && match)\n      return 0;\n    else if (rollResultTotal > totalChance && !match)\n      return 1;\n  }\n\n  /**\n   * Get a data object that contains the final roll result's units and tens digits, as well as a flag that tells whether these match.\n   * \n   * @param {number} rollResultTotal The final roll result. \n   * @returns A data object.\n   */\n  static _getDeconstructedRollData(rollResultTotal) {\n    const stringifiedRollValue = rollResultTotal.toLocaleString(undefined, { \"minimumIntegerDigits\": 2 });\n    const units = Number(stringifiedRollValue.charAt(stringifiedRollValue.length - 1));\n    const tens = Number(stringifiedRollValue.charAt(0));\n\n    const match = units === tens;\n\n    return {\n      \"stringifiedRollValue\": stringifiedRollValue,\n      \"units\": units,\n      \"tens\": tens,\n      \"match\": match\n    };\n  }\n\n  /**\n   * Get the appropriate template for the provided type of roll.\n   * \n   * @param {string} rollType The type of roll.\n   * @returns The path to the appropriate Handlebars template.\n   */\n  static _getTemplate(rollType) {\n    switch (rollType) {\n      case \"skill\":\n        return CONFIG.ZWEI.templates.skill;\n      case \"spell\":\n        return CONFIG.ZWEI.templates.spell;\n      case \"dodge\":\n        return CONFIG.ZWEI.templates.dodge;\n      case \"parry\":\n        return CONFIG.ZWEI.templates.parry;\n      case \"weapon\":\n        return CONFIG.ZWEI.templates.weapon;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * The function responsible for processing a roll result flip. \n   * \n   * @param {number} rollResultTotal The final roll result.\n   * @param {number} totalChance The total chance of success.\n   * @param {number} testResult A number, from 0 to 3, which respresents the result of a given skill test.\n   * @param {object} deconstructedRollData A data object which contains the units and tens digits of the final roll result, as well as a flag telling whether these match.\n   * @param {(\"no-flip\" | \"succeed\" | \"fail\")} flip A flag which tells the function how the final roll result needs to be flipped.\n   * @returns An array containing the final roll result after flip processing, a boolean indicating whether the result was flipped, and the final test result after flip processing, in that order.\n   */\n  static _handleFlippedResult(rollResultTotal, totalChance, testResult, deconstructedRollData, flip) {\n    let finalRoll = deconstructedRollData.stringifiedRollValue;\n    let showFlip = false;\n    let finalTestResult = testResult;\n\n    if (!deconstructedRollData.match && rollResultTotal !== 100 && rollResultTotal !== 1) {\n      const flippedRoll = (deconstructedRollData.units * 10) + deconstructedRollData.tens;\n\n      switch (flip) {\n        case \"fail\":\n\n          // If the roll is a success, check to see if the flipped roll is also a success:\n          //    If yes, get the lowest of the two rolls (lower is worse for degrees of success)\n          //    Otherwise, keep the flipped roll\n          //\n          // If the roll is a failure, keep the original roll (failures don't matter for degrees of success)\n\n          finalRoll = (testResult >= 2) ?\n            ((flippedRoll <= totalChance) ?\n              Math.min(flippedRoll, rollResultTotal) :\n              flippedRoll) :\n            rollResultTotal;\n\n          if (finalRoll !== rollResultTotal)\n            showFlip = true;\n\n          if (finalRoll > totalChance && rollResultTotal <= totalChance)  // If roll was Success, but flipped to a Failure\n            finalTestResult = 1;\n          break;\n        case \"succeed\":\n\n          // If the roll is a failure, check to see if the flipped roll is also a failure:\n          //    If yes, keep the original roll (failures don't matter for degrees of success)\n          //    If no, keep the flipped roll\n          //  \n          // Otherwise, if the roll is a success, check to see if the flipped roll is also a success:\n          //    If yes, get the highest of the two rolls (higher is better for degrees of success)\n          //    If no, keep the original roll\n\n          if (rollResultTotal === 10) { // A roll of 10 always flips to a 01, a critical success. This is an exception to flip to succeed rules, where higher is usually better.\n            finalRoll = 1;\n          } else {\n            finalRoll = (testResult < 2) ?\n              ((flippedRoll > totalChance) ?\n                rollResultTotal :\n                flippedRoll) :\n              ((flippedRoll <= totalChance) ?\n                Math.max(flippedRoll, rollResultTotal) :\n                rollResultTotal);\n          }\n\n          if (finalRoll !== rollResultTotal)\n            showFlip = true;\n\n          if (finalRoll <= totalChance && rollResultTotal > totalChance)  // If roll was a Failure, but flipped to a Success\n            finalTestResult = 2;\n          break;\n        default:\n          break;\n      }\n    }\n\n    return [finalRoll, showFlip, finalTestResult];\n  }\n}","import ZweihanderActorConfig from \"../../apps/actor-config.js\";\nimport ZweihanderDice from \"../../dice/zweihander-dice.js\";\nimport * as ZweihanderUtils from \"../../utils\";\n/**\n * The Zweihnder actor sheet class for characters.\n * @extends {ActorSheet}\n */\nexport default class ZweihanderActorSheet extends ActorSheet {\n\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"zweihander\", \"sheet\", \"character\"],\n      template: \"systems/zweihander/templates/pc/main.hbs\",\n      width: 750,\n      height: 825,\n      resizable: true,\n      tabs: [\n        { navSelector: \".sheet-navigation\", contentSelector: \".sheet-body\", initial: \"main\" }\n      ],\n      scrollY: ['.save-scroll']\n    });\n  }\n  \n  /** @override */\n  getData() {\n    const data = super.getData();\n\n    data.data.owner = this.actor.isOwner;\n    data.data.editable = this.isEditable;\n    data.data.rollData = this.actor.getRollData.bind(this.actor);\n\n    if (this.actor.data.type === \"character\") {\n      data.data.rankOptions = { 1: \"1\", 2: \"2\", 3: \"3\", 4: \"4\", 5: \"5\", 6: \"6\", 7: \"7\", 8: \"8\", 9: \"9\" };\n      data.data.perilOptions = { 5: \"Unhindered\", 4: \"Imperiled\", 3: \"Ignore 1 Skill Rank\", 2: \"Ignore 2 Skill Ranks\", 1: \"Ignore 3 Skill Ranks\", 0: \"INCAPACITATED!\" };\n      data.data.damageOptions = { 5: \"Unharmed\", 4: \"Lightly Wounded\", 3: \"Moderately Wounded\", 2: \"Seriously Wounded\", 1: \"Grievously Wounded\", 0: \"SLAIN!\" };\n    }\n    const addSource = (items) => items.map(i => ({\n      ...i,\n      source: i.flags.zweihander?.source?.label ?? 'Manual',\n      isManualSource: i.flags.zweihander?.source?.label ? false : true \n    }));\n\n    const sortSort = (a, b) => (a.sort || 0) - (b.sort || 0);\n    data.data.skills = this.actor.data.skills;\n    data.data.professions = this.actor.data.professions;\n    data.data.spells = this.actor.data.spells.sort(sortSort);\n    data.data.weapons = this.actor.data.weapons.sort(sortSort);\n    data.data.armor = this.actor.data.armor.sort(sortSort);\n    data.data.trappings = this.actor.data.trappings.sort(sortSort);\n    data.data.rituals = this.actor.data.rituals.sort(sortSort);\n    data.data.ancestry = this.actor.data.ancestry;\n    data.data.drawbacks = addSource(this.actor.data.drawbacks);\n    data.data.injuries = this.actor.data.injuries.sort(sortSort);\n    data.data.diseases = this.actor.data.diseases.sort(sortSort);\n    data.data.disorders = this.actor.data.disorders.sort(sortSort);\n    data.data.conditions = this.actor.data.conditions.sort(sortSort);\n    data.data.uniqueAdvances = this.actor.data.uniqueAdvances.sort(sortSort);\n    data.data.bio = this.actor.data.data.flavor.description;\n    data.data.traits = addSource(this.actor.data.traits.sort(sortSort));\n    const purchasedTalents = this.actor.data.professions.flatMap(p =>\n      p.data.talents\n        .filter(t => t.purchased && t.linkedId)\n        .map(t => this.actor.items.get(t.linkedId)?.toObject(false))\n    );\n    data.data.talents = addSource(purchasedTalents.sort(sortSort));\n\n    let flags = ZweihanderActorConfig.getConfig(this.actor.data);\n    data.data.damageThresholdAttribute = flags.dthAttribute;\n    data.data.perilThresholdAttribute = flags.pthAttribute;\n\n    data.data.initiativeAttribute = flags.intAttribute;\n    data.data.movementAttribute = flags.movAttribute;\n\n    data.data.parrySkills = flags.parrySkills;\n    data.data.dodgeSkills = flags.dodgeSkills;\n    data.data.magickSkills = flags.magickSkills;\n\n    return data.data;\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    const trackRewardPointsOn = game.settings.get(\"zweihander\", \"trackRewardPoints\");\n\n    let actorData = this.actor.data;\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    // Edit Inventory Item\n    html.find('.item-edit').click(ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      item.sheet.render(true);\n    });\n\n    // Delete Inventory Item\n    html.find('.item-delete').click(async ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      await Dialog.confirm({\n        title: `Delete Embedded Item: ${item.name}`,\n        content: \"<p>Are you sure?</p><p>This item will be permanently deleted and cannot be recovered.</p>\",\n        yes: async () => {\n          await this.actor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n          li.slideUp(200, () => this.render(false));\n        },\n        no: () => { },\n        defaultYes: true\n      });\n    });\n\n    html.find('.skill').hover(async ev => {\n      let target = \"li.pa.pa-\" + ev.currentTarget.attributes['data-associated-pa'].value.toLowerCase();\n      $(target).addClass('pa-hover-helper');\n    }, async ev => {\n      let target = \"li.pa.pa-\" + ev.currentTarget.attributes['data-associated-pa'].value.toLowerCase();\n      $(target).removeClass('pa-hover-helper');\n    })\n\n    // Add new Item (from within the sheet)\n    html.find('.add-new').click(async ev => {\n      let type = ev.currentTarget.dataset.itemType;\n\n      const createdItemArray = await this.actor.createEmbeddedDocuments(\"Item\", [\n        { \"type\": type, \"name\": type }\n      ]);\n\n      if (createdItemArray.length)\n        createdItemArray[0].sheet.render(true);\n    });\n\n    // Edit Ancestry Item\n    html.find('.ancestry-edit-button').click(() => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n      const ancestryItem = this.actor.items.get(ancestryId);\n      ancestryItem.sheet.render(true);\n      try {\n        ancestryItem.sheet.bringToTop();\n      } catch (e) {\n        // TODO check if this is a problem. Doesn't seem to be the case. Maybe can be safeguarded.\n      }\n    });\n\n    // Delete Ancestry Item\n    html.find('.ancestry-delete-button').click(async ev => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n\n      await this.actor.deleteEmbeddedDocuments(\"Item\", [ancestryId]);\n    });\n\n    // toFormat.replace(/(@([a-zA-Z0-9]\\.)*[a-zA-Z0-9]+)/g, (key) => resolveProperty(actorData, key))\n\n    // Handle formulas for display\n    html.find('.fetch-property').each(async function () {\n      let initialValue = $(this).text().trim();\n      let evaluatedValue = ZweihanderUtils.abbreviations2DataPath(initialValue, false);\n      //console.log(evaluatedValue);\n      evaluatedValue = evaluatedValue.replaceAll(/(@[a-zA-Z0-9\\.]*[a-zA-Z0-9]+)/g, x => {\n        let key = `data.${x.slice(1)}`;\n        return getProperty(actorData, key);\n      });\n      if (initialValue !== evaluatedValue) {\n        evaluatedValue = evaluatedValue.replaceAll(/[0-9]+(\\s*[\\+\\-\\*/]\\s*[0-9]+)*/g, x => {\n          //TODO: how can we solve this with async: true?\n          let rollResult = new Roll(x).evaluate({ async: false });\n          return rollResult.total;\n        })\n        //console.log(evaluatedValue);\n        $(this).text(evaluatedValue);\n      }\n    });\n\n    // \"Link\" checkboxes on character sheet and item sheet so both have the same state\n    html.find(\".link-checkbox\").click(async event => {\n      event.preventDefault();\n\n      const li = $(event.currentTarget).closest(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n\n      if (item.type === \"armor\") {\n        await item.update({ \"data.equipped\": event.target.checked });\n      } else if (item.type === \"profession\") {\n        await item.update({ \"data.tier.completed\": event.target.checked });\n      } else if (item.type === \"trapping\") {\n        await item.update({ \"data.carried\": event.target.checked });\n      } else if (item.type === \"weapon\") {\n        await item.update({ \"data.equipped\": event.target.checked });\n      } else if (item.type === \"condition\" || item.type === \"injury\" || item.type === \"disease\" || item.type === \"disorder\") {\n        await item.update({ \"data.active\": event.target.checked });\n      }\n    });\n\n    // Update the value of the Damage Threshold label depending on armor worn\n    this._updateDamageThresholdLabel(html);\n\n    // Show item sheet on right click\n    html.find(\".fetch-item\").contextmenu(event => {\n      const target = $(event.currentTarget);\n      const skillName = target.text().trim();\n      const itemId = actorData.items.find(item => item.name === skillName).id;\n\n      if (itemId) {\n        const skillItem = this.actor.items.get(itemId);\n        skillItem.sheet.render(true);\n      }\n    });\n\n    html.find(\".item-post\").click(async event => {\n      const li = $(event.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      //console.log(item);\n      let html\n      try {\n        html = await renderTemplate(`systems/zweihander/templates/chat/chat-item-${item.type}.hbs`, item);\n      } catch (e) {\n        html = await renderTemplate(`systems/zweihander/templates/chat/chat-item-fallback.hbs`, item);\n      }\n      await ChatMessage.create({ content: html })\n    })\n\n    const updatePurchased = (event) => {\n      const target = $(event.currentTarget);\n      const field = target.data('purchaseType');\n      const index = target.data('purchaseIndex');\n      const professionElement = target.closest(\".individual-description\").parents(\".item\");\n      const professionItem = this.actor.items.get($(professionElement).data(\"itemId\"));\n      const locked = professionItem.data.data.tier.completed && this.actor.data.data.tier !== professionItem.data.data.tier.value;\n      if (locked) {\n        ui.notifications.error(`Cannot perform operation: ${professionItem.data.data.tier.value} Tier locked.`);\n        return;\n      }\n      const updated = professionItem.data.data[field].map((x, i) => i === index ? { ...x, purchased: !x.purchased } : x);\n      professionItem.update({ [`data.${field}`]: updated });\n    }\n    html.find(\".purchase-link\").click(updatePurchased);\n\n    // Reset Order and Chaos Ranks\n    html.find(\".reset-ranks\").click(() => {\n      this.actor.update({\n        \"data.chaosRanks.value\": \"0\",\n        \"data.orderRanks.value\": \"0\"\n      });\n    });\n\n    // this._damageSheet(html);\n\n    // Update the encumbrance meter\n    this._updateEncumbranceMeter(html);\n\n    this._damageSheet(html);\n\n    this._perilSheet(html);\n\n    // Show extra item information on click\n    html.find(\".js-show-item-description\").click(event => this._showItemDescription(event));\n\n    // Roll Skill\n    html.find(\".skill-roll\").click((event) => {\n      this._onRollSkill(event, CONFIG.ZWEI.rollTypes.skill);\n    });\n\n    // Roll Weapon\n    html.find(\".weapon-roll\").click((event) => {\n      this._onRollSkill(event, CONFIG.ZWEI.rollTypes.weapon)\n    });\n\n    // Roll Spell\n    html.find(\".spell-roll\").click((event) => {\n      this._onRollSkill(event, CONFIG.ZWEI.rollTypes.spell)\n    });\n\n    // Roll Dodge\n    html.find(\".dodge-roll\").click((event) => {\n      this._onRollSkill(event, CONFIG.ZWEI.rollTypes.dodge);\n    });\n\n    // Roll Parry\n    html.find(\".parry-roll\").click((event) => {\n      this._onRollSkill(event, CONFIG.ZWEI.rollTypes.parry);\n    });\n\n    html.find(\".js-display-quality\").contextmenu(async (event) => {\n      event.preventDefault();\n      const target = $(event.currentTarget);\n      const qualityName = target.text();\n      const quality = await ZweihanderUtils.findItemWorldWide(\"quality\", qualityName);\n      quality.sheet.render(true);\n    });\n  }\n\n  _damageSheet(html) {\n    if (Number(this.actor.data.data.stats.secondaryAttributes.damageCurrent.value) < 5) {\n      html.find('.bloodstain-1').toggleClass('bloodstain-inactive')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.damageCurrent.value) < 4) {\n      html.find('.bloodstain-2').toggleClass('bloodstain-inactive')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.damageCurrent.value) < 3) {\n      html.find('.bloodstain-3').toggleClass('bloodstain-inactive')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.damageCurrent.value) < 2) {\n      html.find('.bloodstain-4').toggleClass('bloodstain-inactive')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.damageCurrent.value) < 1) {\n      html.find('.bloodstain-5').toggleClass('bloodstain-inactive')\n    }\n  }\n\n  _perilSheet(html) {\n    if (Number(this.actor.data.data.stats.secondaryAttributes.perilCurrent.value) < 5) {\n      html.find('.profile-image').addClass('peril1')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.perilCurrent.value) < 4) {\n      html.find('.profile-image').addClass('peril2')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.perilCurrent.value) < 3) {\n      html.find('.profile-image').addClass('peril3')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.perilCurrent.value) < 2) {\n      html.find('.profile-image').addClass('peril4')\n    }\n    if (Number(this.actor.data.data.stats.secondaryAttributes.perilCurrent.value) < 1) {\n      html.find('.profile-image').addClass('peril5')\n    }\n  }\n\n  async _onRollSkill(event, rollType) {\n    event.preventDefault();\n\n    const element = event.currentTarget;\n    const dataset = element.dataset;\n\n    const actorData = this.actor.data;\n\n    const skill = dataset.label.toLowerCase();\n    const skillItem = actorData.skills[actorData.skills.findIndex(item => item.name.toLowerCase() === skill)];\n\n    if (skillItem) {\n      switch (rollType) {\n        case CONFIG.ZWEI.rollTypes.dodge:\n        case CONFIG.ZWEI.rollTypes.parry:\n        case CONFIG.ZWEI.rollTypes.skill:\n          await ZweihanderDice.rollSkillTest(skillItem, actorData, rollType);\n          break;\n        case CONFIG.ZWEI.rollTypes.weapon:\n          const weaponId = $(element).parents(\".item\")[0].dataset.itemId;\n          const weaponItem = actorData.items.get(weaponId);\n\n          if (weaponItem) {\n            const weaponItemData = weaponItem.data;\n\n            const weaponData = {\n              \"weaponQualities\": weaponItemData.data.qualities.arrayOfValues,\n              \"weaponName\": weaponItemData.name,\n              \"formula\": weaponItemData.data.damage.formula,\n              \"bonus\": {\n                \"value\": weaponItemData.data.damage.primaryAttributeBonus,\n                \"label\": weaponItemData.data.damage.associatedPrimaryAttribute\n              }\n            };\n\n            await ZweihanderDice.rollSkillTest(skillItem, actorData, rollType, weaponData);\n          }\n\n          break;\n        case CONFIG.ZWEI.rollTypes.spell:\n          const spellId = $(element).parents(\".item\")[0].dataset.itemId;\n          const spellItem = actorData.items.get(spellId);\n\n          if (spellItem) {\n            const spellItemData = spellItem.data;\n\n            const spellData = {\n              \"spellName\": spellItemData.name,\n              \"principle\": spellItemData.data.principle.value,\n              \"duration\": this._formatDuration(spellItemData.data.duration.value, actorData),\n              \"distance\": spellItemData.data.distance.value,\n              \"flavor\": spellItemData.data.flavor.description,\n              \"effect\": spellItemData.data.effect,\n              \"reagents\": spellItemData.data.reagents.value,\n              \"tradition\": spellItemData.data.tradition.value\n            };\n\n            await ZweihanderDice.rollSkillTest(skillItem, actorData, rollType, spellData);\n          }\n\n          break;\n        default:\n          break;\n      }\n    } else {\n      ui.notifications.error(`Associated Skill \"${dataset.label}\" does not exist for this actor!`);\n    }\n  }\n\n  _formatDuration(formula, actorData) {\n    if (formula[0] === \"@\") {\n      const contents = formula.split(\"+\");\n      const key = contents[0].replace(\"@\", \"data.\");\n      const bonus = getProperty(actorData, key);\n      const setDuration = contents[1].split(' ');\n\n      return bonus + Number(setDuration[0]) + \" \" + setDuration[1];\n    }\n  }\n\n  _showItemDescription(event) {\n    event.preventDefault();\n    const toggler = $(event.currentTarget);\n    const item = toggler.parents(\".item\");\n    const description = item.find(\".item-summary\");\n\n    $(description).slideToggle(function () {\n      $(this).toggleClass(\"open\");\n    });\n  }\n\n  _updateDamageThresholdLabel(html) {\n    const dtmLabel = html.find('.label.dtm').text();\n    const contents = dtmLabel.split(\"+\");\n    const armor = this.actor.items.find(item => item.type === \"armor\" && item.data.data.equipped == true);\n\n    if (armor !== null && armor !== undefined) {\n      const dtm = armor.data.data.damageThresholdModifier.value;\n      html.find('.label.dtm').text(contents[0] + \"+\" + dtm);\n    }\n  }\n\n  _updateEncumbranceMeter(html) {\n    const encumbranceData = this.actor.data.data.stats.secondaryAttributes.encumbrance;\n    const currentEncumbrance = encumbranceData.current;\n    const totalEncumbrance = encumbranceData.value;\n\n    let ratio = (currentEncumbrance / totalEncumbrance) * 100;\n\n    if (ratio > 100) {\n      ratio = 100;\n      html.find(\".encumbrance-bar-container\").addClass(\"encumbrance-overage\");\n    }\n    html.find(\".encumbrance-bar\").css(\"width\", ratio + \"%\");\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  async _render(force = false, options = {}) {\n    const toIterate = [\n      \"professions\",\n      \"drawbacks\",\n      \"weapons\",\n      \"armor\",\n      \"trappings\",\n      \"talents-and-traits\",\n      \"unique-advances\",\n      \"spells\",\n      \"rituals\",\n      \"conditions\",\n      \"injuries\",\n      \"diseases\",\n      \"disorders\"\n    ];\n\n    this._saveToggleStates(toIterate);\n    await super._render(force, options);\n    this._setToggleStates(toIterate);\n  }\n\n  _saveToggleStates(toIterate) {\n    if (this.form === null)\n      return;\n\n    const html = $(this.form).parent();\n\n    this.toggleStates = {};\n\n    for (let item of toIterate) {\n      let elements = $(html.find(`.save-toggle-${item}`));\n\n      this.toggleStates[item] = [];\n\n      for (let element of elements) {\n        const isOpen = $(element).hasClass(\"open\");\n\n        this.toggleStates[item].push(isOpen);\n      }\n    }\n  }\n\n  _setToggleStates(toIterate) {\n    if (this.toggleStates) {\n      const html = $(this.form).parent();\n\n      for (let item of toIterate) {\n        if (!this.toggleStates[item].length)\n          continue;\n\n        let elements = $(html.find(`.save-toggle-${item}`));\n\n        for (let i = 0; i < elements.length; i++) {\n          if (this.toggleStates[item][i]) {\n            $(elements[i]).show().addClass(\"open\");\n          }\n        }\n      }\n    }\n  }\n}\n","/**\n * Extend the basic ActorSheet with some very simple modifications\n * @extends {ActorSheet}\n */\n export default class ZweihanderNpcSheet extends ActorSheet {\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"zweihander\", \"sheet\", \"npc\"],\n      template: \"systems/zweihander/templates/actor/npc-sheet.hbs\",\n      width: 689, //720,\n      height: 890, //945,\n      resizable: false,\n      tabs: [],\n      scrollY: []\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  getData() {\n    const data = super.getData();\n    data.dtypes = [\"String\", \"Number\", \"Boolean\"];\n\n    data.data.skills = this.actor.data.skills;\n    data.data.spells = this.actor.data.spells;\n    data.data.weapons = this.actor.data.weapons;\n    data.data.trappings = this.actor.data.trappings;\n    data.data.talents = this.actor.data.talents;\n    data.data.traits = this.actor.data.traits;\n    data.data.rituals = this.actor.data.rituals;\n    data.data.ancestry = this.actor.data.ancestry;\n    data.data.injuries = this.actor.data.injuries;\n    data.data.conditions = this.actor.data.conditions;\n\n    //console.log(this.actor)\n\n    return data.data;\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    let actorData = this.actor.data;\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    // Add new Item (from within the sheet)\n    html.find('.add-new').click(async ev => {\n      let type = ev.currentTarget.dataset.itemType;\n\n      if (type === \"talentTrait\") {\n        // TODO: add Dialog to choose\n        //console.log(\"TODO: allow user to choose between Talent and Trait\");\n        return;\n      }\n\n      const createdItemArray = await this.actor.createEmbeddedDocuments(\"Item\", [ \n        { \"type\": type, \"name\": type } \n      ]);\n\n      createdItemArray[0].sheet.render(true);\n    });\n\n    // Edit Ancestry Item\n    html.find('.ancestry-edit-button').click(ev => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n      const ancestryItem = this.actor.items.get(ancestryId);\n\n      ancestryItem.sheet.render(true);\n    });\n\n    // Delete Ancestry Item\n    html.find('.ancestry-delete-button').click(async ev => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n\n      await this.actor.deleteEmbeddedDocuments(\"Item\", [ ancestryId ]);\n    });\n\n    // Show Item sheet on right-click\n    html.find('.fetch-skill').contextmenu(ev => {\n      const target = $(ev.currentTarget);\n      const skillName = target.text().trim().split(\"+\")[0];\n      const itemId = this.actor.data.skills.find(skill => skill.name === skillName)._id;\n\n      if (itemId) {\n        const skillItem = this.actor.items.get(itemId);\n        skillItem.sheet.render(true);\n      }\n    });\n\n    // Edit Inventory Item\n    html.find('.item-edit').click(ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      item.sheet.render(true);\n    });\n\n    // Delete Inventory Item\n    html.find('.item-delete').click(async ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const itemName = li.children(\".image-and-name\").children(\"span\").text();\n\n      await Dialog.confirm({\n        title: `Delete Embedded Item: ${itemName}`,\n        content: \"<p>Are you sure?</p><p>This item will be permanently deleted and cannot be recovered.</p>\",\n        yes: async () => {\n          await this.actor.deleteEmbeddedDocuments(\"Item\", [ li.data(\"itemId\") ]);\n          li.slideUp(200, () => this.render(false));\n        },\n        no: () => {},\n        defaultYes: false\n      });\n    });\n\n    // Fill Damage and Peril Thresholds\n    this._setThresholds(html);\n\n    // Alternate color for lists\n    this._alternateRowColor(html);\n  }\n\n  _setThresholds(html) {\n    const perilArray = Object.keys(this.actor.data.data.stats.secondaryAttributes.perilThreshold);\n    const damageArray = Object.keys(this.actor.data.data.stats.secondaryAttributes.damageThreshold);\n\n    let derivedPeril = \"\";\n\n    for (let i = 1; i < perilArray.length; i++) {\n      derivedPeril += \"\" + this.actor.data.data.stats.secondaryAttributes.perilThreshold[perilArray[i]];\n\n      if (i !== perilArray.length - 1) {\n        derivedPeril += \"/\";\n      }\n    }\n\n    let derivedDamage = \"\";\n\n    for (let i = 1; i < damageArray.length; i++) {\n      derivedDamage += \"\" + this.actor.data.data.stats.secondaryAttributes.damageThreshold[damageArray[i]];\n\n      if (i !== damageArray.length - 1) {\n        derivedDamage += \"/\";\n      }\n    }\n\n    html.find('.derived.peril').text(derivedPeril);\n    html.find('.derived.damage').text(derivedDamage);\n  }\n\n  _alternateRowColor(html) {\n    html.find(\".even\").css(\"background\", \"var(--zh-clr-bright1)\");\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  async _updateObject(event, formData) {\n\n    // Handle the free-form attributes list\n    //console.log(\"NPC TEST formData :::: \", formData);\n    //console.log(\"NPC TEST expandObject(formData) :::: \", expandObject(formData));\n    //console.log(\"NPC TEST expandObject(formData).data :::: \", expandObject(formData).data);\n    /*const formAttrs = expandObject(formData).data.attributes || {};\n    const attributes = Object.values(formAttrs).reduce((obj, v) => {\n      let k = v[\"key\"].trim();\n      if ( /[\\s\\.]/.test(k) )  return ui.notifications.error(\"Attribute keys may not contain spaces or periods\");\n      delete v[\"key\"];\n      obj[k] = v;\n      return obj;\n    }, {});\n    \n    // Remove attributes which are no longer used\n    for ( let k of Object.keys(this.object.data.data.attributes) ) {\n      if ( !attributes.hasOwnProperty(k) ) attributes[`-=${k}`] = null;\n    }\n\n    // Re-combine formData\n    formData = Object.entries(formData).filter(e => !e[0].startsWith(\"data.attributes\")).reduce((obj, e) => {\n      obj[e[0]] = e[1];\n      return obj;\n    }, {_id: this.object._id, \"data.attributes\": attributes});\n    */\n    // Update the Actor\n    return await this.object.update(formData);\n  }\n}\n  ","/**\n * Extend the basic ActorSheet with some very simple modifications\n * @extends {ActorSheet}\n */\n export default class ZweihanderCreatureSheet extends ActorSheet {\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"zweihander\", \"sheet\", \"npc\"],\n      template: \"systems/zweihander/templates/actor/npc-sheet.hbs\",\n      width: 689, //720,\n      height: 890, //945,\n      resizable: false,\n      tabs: [],\n      scrollY: []\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  getData() {\n    const data = super.getData();\n    data.dtypes = [\"String\", \"Number\", \"Boolean\"];\n\n    data.data.skills = this.actor.data.skills;\n    data.data.spells = this.actor.data.spells;\n    data.data.weapons = this.actor.data.weapons;\n    data.data.trappings = this.actor.data.trappings;\n    data.data.talents = this.actor.data.talents;\n    data.data.traits = this.actor.data.traits;\n    data.data.rituals = this.actor.data.rituals;\n    data.data.ancestry = this.actor.data.ancestry;\n    data.data.injuries = this.actor.data.injuries;\n    data.data.conditions = this.actor.data.conditions;\n\n    //console.log(this.actor)\n\n    return data.data;\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    let actorData = this.actor.data;\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    // Add new Item (from within the sheet)\n    html.find('.add-new').click(async ev => {\n      let type = ev.currentTarget.dataset.itemType;\n\n      if (type === \"talentTrait\") {\n        // TODO: add Dialog to choose\n        //console.log(\"TODO: allow user to choose between Talent and Trait\");\n        return;\n      }\n\n      const createdItemArray = await this.actor.createEmbeddedDocuments(\"Item\", [ \n        { \"type\": type, \"name\": type } \n      ]);\n\n      createdItemArray[0].sheet.render(true);\n    });\n\n    // Edit Ancestry Item\n    html.find('.ancestry-edit-button').click(ev => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n      const ancestryItem = this.actor.items.get(ancestryId);\n\n      ancestryItem.sheet.render(true);\n    });\n\n    // Delete Ancestry Item\n    html.find('.ancestry-delete-button').click(async ev => {\n      const ancestryId = this.actor.data.ancestry[0]._id;\n\n      await this.actor.deleteEmbeddedDocuments(\"Item\", [ ancestryId ]);\n    });\n\n    // Show Item sheet on right-click\n    html.find('.fetch-skill').contextmenu(ev => {\n      const target = $(ev.currentTarget);\n      const skillName = target.text().trim().split(\"+\")[0];\n      const itemId = this.actor.data.skills.find(skill => skill.name === skillName)._id;\n\n      if (itemId) {\n        const skillItem = this.actor.items.get(itemId);\n        skillItem.sheet.render(true);\n      }\n    });\n\n    // Edit Inventory Item\n    html.find('.item-edit').click(ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      item.sheet.render(true);\n    });\n\n    // Delete Inventory Item\n    html.find('.item-delete').click(async ev => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const itemName = li.children(\".image-and-name\").children(\"span\").text();\n\n      await Dialog.confirm({\n        title: `Delete Embedded Item: ${itemName}`,\n        content: \"<p>Are you sure?</p><p>This item will be permanently deleted and cannot be recovered.</p>\",\n        yes: async () => {\n          await this.actor.deleteEmbeddedDocuments(\"Item\", [ li.data(\"itemId\") ]);\n          li.slideUp(200, () => this.render(false));\n        },\n        no: () => {},\n        defaultYes: false\n      });\n    });\n\n    // Fill Damage and Peril Thresholds\n    this._setThresholds(html);\n\n    // Alternate color for lists\n    this._alternateRowColor(html);\n  }\n\n  _setThresholds(html) {\n    const perilArray = Object.keys(this.actor.data.data.stats.secondaryAttributes.perilThreshold);\n    const damageArray = Object.keys(this.actor.data.data.stats.secondaryAttributes.damageThreshold);\n\n    let derivedPeril = \"\";\n\n    for (let i = 1; i < perilArray.length; i++) {\n      derivedPeril += \"\" + this.actor.data.data.stats.secondaryAttributes.perilThreshold[perilArray[i]];\n\n      if (i !== perilArray.length - 1) {\n        derivedPeril += \"/\";\n      }\n    }\n\n    let derivedDamage = \"\";\n\n    for (let i = 1; i < damageArray.length; i++) {\n      derivedDamage += \"\" + this.actor.data.data.stats.secondaryAttributes.damageThreshold[damageArray[i]];\n\n      if (i !== damageArray.length - 1) {\n        derivedDamage += \"/\";\n      }\n    }\n\n    html.find('.derived.peril').text(derivedPeril);\n    html.find('.derived.damage').text(derivedDamage);\n  }\n\n  _alternateRowColor(html) {\n    html.find(\".even\").css(\"background\", \"var(--zh-clr-bright1)\");\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  async _updateObject(event, formData) {\n\n    // Handle the free-form attributes list\n    //console.log(\"NPC TEST formData :::: \", formData);\n    //console.log(\"NPC TEST expandObject(formData) :::: \", expandObject(formData));\n    //console.log(\"NPC TEST expandObject(formData).data :::: \", expandObject(formData).data);\n    /*const formAttrs = expandObject(formData).data.attributes || {};\n    const attributes = Object.values(formAttrs).reduce((obj, v) => {\n      let k = v[\"key\"].trim();\n      if ( /[\\s\\.]/.test(k) )  return ui.notifications.error(\"Attribute keys may not contain spaces or periods\");\n      delete v[\"key\"];\n      obj[k] = v;\n      return obj;\n    }, {});\n    \n    // Remove attributes which are no longer used\n    for ( let k of Object.keys(this.object.data.data.attributes) ) {\n      if ( !attributes.hasOwnProperty(k) ) attributes[`-=${k}`] = null;\n    }\n\n    // Re-combine formData\n    formData = Object.entries(formData).filter(e => !e[0].startsWith(\"data.attributes\")).reduce((obj, e) => {\n      obj[e[0]] = e[1];\n      return obj;\n    }, {_id: this.object._id, \"data.attributes\": attributes});\n    */\n    // Update the Actor\n    return await this.object.update(formData);\n  }\n}\n  ","import * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderBaseItem {\n\n  static async _getOrCreateLinkedItem(actor, itemName, itemType, sourceName, sourceType) {\n    let itemToAdd = await ZweihanderUtils.findItemWorldWide(itemType, itemName);\n    const existingItemWithSameName = actor.data.items.find(t => t.type === itemType && t.name === itemToAdd?.name);\n    if (!itemToAdd && !existingItemWithSameName) return;\n    const flag = { value: sourceType, label: `${sourceName} (${sourceType.capitalize()})` };\n    if (existingItemWithSameName) {\n      const existingFlag = existingItemWithSameName.getFlag('zweihander', 'source');\n      if (existingFlag) {\n        ui?.notifications.warn(`The ${existingItemWithSameName.type.capitalize()} \"${existingItemWithSameName.name}\" has been previously added by ${existingFlag.label}! Please contact your GM to replace this ${existingItemWithSameName.type} on ${flag.label}`);\n        return;\n      }\n      await existingItemWithSameName.setFlag('zweihander', 'source', flag);\n      return {kind: 'existing', id: existingItemWithSameName.id, name: existingItemWithSameName.name};\n    } else {\n      itemToAdd = itemToAdd.toObject();\n      setProperty(itemToAdd, 'flags.zweihander.source', flag);\n      return {kind: 'create', object: itemToAdd, name: itemToAdd.name};\n    }\n  }\n\n  static async getOrCreateLinkedItem(actor, itemName, itemType, sourceName, sourceType) {\n    const {kind, object, id, name} = ((await this._getOrCreateLinkedItem(actor, itemName, itemType, sourceName, sourceType)) ?? {});\n    let linkedId = null;\n    if (kind === 'existing') {\n      linkedId = id;\n    } else if (kind === 'create') {\n      linkedId = await actor.createEmbeddedDocuments(\"Item\", [object]).then(x => x[0].id);\n    }\n    return ({linkedId, value: name ?? itemName});\n  }\n\n  static async getOrCreateLinkedItems(actor, itemNames, itemType, sourceName, sourceType) {\n    const itemsToCreate = [];\n    const resultMap = {};\n    for (let itemName of itemNames) {\n      const normalizedItemName = ZweihanderUtils.normalizeName(itemName);\n      const {kind, object, id, name} = ((await this._getOrCreateLinkedItem(actor, itemName, itemType, sourceName, sourceType)) ?? {});\n      if (kind === 'existing') resultMap[normalizedItemName] = {linkedId: id, value: name};\n      else if (kind === 'create') itemsToCreate.push(object);\n      else resultMap[normalizedItemName] = {linkedId: null, value: itemName};\n    }\n    if (itemsToCreate.length) {\n      await actor.createEmbeddedDocuments(\"Item\", itemsToCreate)\n        .then(x => x.forEach(y => resultMap[ZweihanderUtils.normalizeName(y.name)] = {linkedId: y.id, value: y.name}));\n    }\n    return itemNames.map(name => resultMap[ZweihanderUtils.normalizeName(name)]);\n  }\n\n  static async removeLinkedItem(actor, linkedId) {\n    if (linkedId) {\n      await actor.deleteEmbeddedDocuments(\"Item\", [linkedId]);\n    }\n  }\n\n  static async removeLinkedItems(actor, array) {\n    const linkedIds = array?.filter(v => v);\n    if (linkedIds.length) {\n      await actor.deleteEmbeddedDocuments(\"Item\", linkedIds);\n    }\n  }\n\n  //TODO remove\n  static async updateLinkedItemIds(array, linkedItems) {\n    let i = 0;\n    const result = [];\n    for (item of array) {\n      if (ZweihanderUtils.normalizedEquals(linkedItems[i].name, item.value)) {\n        item.value = linkedItems[i].name;\n        item.linkedId = linkedItems[i].id;\n        i++;\n      } else {\n        item.linkedId = null;\n      }\n      result.push(item);\n    }\n    return result;\n  }\n\n  static getLinkedItemsDifference(newArray, oldArray) {\n    const arrayMinusByName = (a, b) => a.filter(x => !b.some(y => x.value === y.value));\n    return {\n      namesToAdd: arrayMinusByName(newArray, oldArray).map(e => e.value),\n      idsToDelete: arrayMinusByName(oldArray, newArray).map(e => e.linkedId)\n    }\n  }\n\n  getRollData(rollData) {\n    //TODO: make attributes more accessible here\n    return rollData;\n  }\n\n}","import ZweihanderBaseItem from \"./base-item\";\nimport * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderWeapon extends ZweihanderBaseItem {\n\n\n}","import ZweihanderBaseItem from \"./base-item\";\n\nexport default class ZweihanderProfession extends ZweihanderBaseItem {\n\n  prepareDerivedData(itemData, item) {\n    if (!item.isOwned) return;\n    const advancesPurchased = 1\n      + itemData.data.bonusAdvances.reduce((a, b) => a + Number(b.purchased), 0)\n      + itemData.data.skillRanks.reduce((a, b) => a + Number(b.purchased), 0)\n      + itemData.data.talents.reduce((a, b) => a + Number(b.purchased), 0);\n    itemData.data.tier.advancesPurchased = advancesPurchased;\n    itemData.data.tier.completed = advancesPurchased === 21;\n  }\n\n  async _preCreate(data, options, user, item) {\n    const itemData = item.data;\n    const tier = item.parent.data.professions.length;\n    if (tier > 3) return;\n    itemData.update({ 'data.tier.value': ['Basic', 'Intermediate', 'Advanced'][tier]});\n    itemData.update({ 'data.skillRanks': itemData.data.skillRanks.map(sr => ({...sr, purchased: false}))});\n    itemData.update({ 'data.bonusAdvances': itemData.data.bonusAdvances.map(ba => ({...ba, purchased: false}))});\n    const talentsToFetch = itemData.data.talents.map(v => v.value);\n    if (talentsToFetch.length) {\n      const talents = await ZweihanderBaseItem.getOrCreateLinkedItems(item.parent, talentsToFetch, 'talent', item.name, 'profession');\n      itemData.update({ 'data.talents': talents.map(t => ({...t, purchased: false}))});\n    }\n    const professionalTraitToFetch = itemData.data.professionalTrait.value.trim();\n    const specialTraitToFetch = itemData.data.specialTrait.value.trim();\n    const traits = await ZweihanderBaseItem.getOrCreateLinkedItems(item.parent, [professionalTraitToFetch, specialTraitToFetch], 'trait', item.name, 'profession');\n    itemData.update({ 'data.professionalTrait': traits[0], 'data.specialTrait': traits[1] });\n    const drawbackToFetch = itemData.data.drawback.value;\n    const drawback = await ZweihanderBaseItem.getOrCreateLinkedItem(item.parent, drawbackToFetch, 'drawback', item.name, 'profession');\n    itemData.update({ 'data.drawback': drawback });\n  }\n\n  async _preUpdate(changed, options, user, item) {\n    const actor = item.parent;\n    const itemData = item.data;\n    const diffData = changed.data;\n    const diffPaths = flattenObject(changed.data);\n    const idsToDelete = [];\n    if (diffPaths['skillRanks'] !== undefined) {\n      diffData.skillRanks = diffData.skillRanks.map(sr => ({...sr, purchased: sr.purchased ?? false}));\n    }\n    if (diffPaths['bonusAdvances'] !== undefined) {\n      diffData.bonusAdvances = diffData.bonusAdvances.map(ba => ({...ba, purchased: ba.purchased ?? false}));\n    }\n    if (diffPaths['talents'] !== undefined) {\n      const talentsDiff = ZweihanderBaseItem.getLinkedItemsDifference(diffData.talents, itemData.data.talents);\n      idsToDelete.push(...talentsDiff.idsToDelete);\n      const addedTalents = await ZweihanderBaseItem.getOrCreateLinkedItems(item.parent, talentsDiff.namesToAdd, 'talent', item.name, 'profession');\n      const lookUp = addedTalents.reduce((a,b) => ({...a, [b.value]: {...b, purchased: false}}),{});\n      // update names \n      diffData.talents = diffData.talents.map(t => lookUp[t.value] ? lookUp[t.value] : t);\n    }\n    if (diffPaths['professionalTrait.value'] !== undefined) {\n      const newTrait = diffData.professionalTrait.value.trim();\n      const oldTrait = itemData.data.professionalTrait.value;\n      if (newTrait !== oldTrait) {\n        idsToDelete.push(itemData.data.professionalTrait.linkedId);\n        const trait = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, newTrait, 'trait', itemData.name, 'ancestry');\n        if (trait) {\n          diffData.professionalTrait = trait;\n        }\n      }\n    }\n    if (diffPaths['specialTrait.value'] !== undefined) {\n      const newTrait = diffData.specialTrait.value.trim();\n      const oldTrait = itemData.data.specialTrait.value;\n      if (newTrait !== oldTrait) {\n        idsToDelete.push(itemData.data.specialTrait.linkedId);\n        const trait = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, newTrait, 'trait', itemData.name, 'ancestry');\n        if (trait) {\n          diffData.specialTrait = trait;\n        }\n      }\n    }\n    if (diffPaths['drawback.value'] !== undefined) {\n      const newDrawback = diffData.drawback.value.trim();\n      const oldDrawback = itemData.data.drawback.value;\n      if (newDrawback !== oldDrawback) {\n        idsToDelete.push(itemData.data.drawback.linkedId);\n        const drawback = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, newDrawback, 'drawback', itemData.name, 'ancestry');\n        if (drawback) {\n          diffData.drawback = drawback;\n        }\n      }\n    }\n    options.idsToDelete = idsToDelete;\n  }\n\n  async _onUpdate(changed, options, user, item) {\n    if (options.idsToDelete.length) {\n      await ZweihanderBaseItem.removeLinkedItems(item.parent, options.idsToDelete);\n    }\n  }\n\n  async _preDelete(options, user, item) {\n    options.idsToDelete = [\n      item.data.data.specialTrait,\n      item.data.data.professionalTrait,\n      item.data.data.drawback,\n      ...item.data.data.talents\n    ].map(v => v.linkedId);\n  }\n\n  async _onDelete(options, user, item) {\n    await ZweihanderBaseItem.removeLinkedItems(item.parent, options.idsToDelete);\n  }\n\n}","import ZweihanderBaseItem from \"./base-item\";\nimport * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderSkill extends ZweihanderBaseItem {\n\n  prepareBaseData(itemData, item) {\n    if (!item.isOwned || !item?.actor?.data) return;\n    const data = itemData.data;\n    const actor = item.actor;\n    const timesPurchased = actor.items\n      .filter(i => i.type === 'profession')\n      .flatMap(p => p.data.data.skillRanks.filter(sr => sr.value === item.name && sr.purchased))\n      .length;\n    data.rank = timesPurchased;\n    data.bonus = timesPurchased * 10;\n  }\n\n}","import ZweihanderBaseItem from \"./base-item\";\nimport * as ZweihanderUtils from \"../../utils\";\n\nexport default class ZweihanderAncestry extends ZweihanderBaseItem {\n\n  async _preCreate(data, options, user, item) {\n    const trait = await ZweihanderBaseItem.getOrCreateLinkedItem(item.parent, item.data.data.ancestralTrait.value, 'trait', item.name, 'ancestry'); \n    if (trait) {\n      item.data.update({ 'data.ancestralTrait': trait });\n    }\n  }\n\n  async _preUpdate(changed, options, user, item) {\n    const itemData = item.data;\n    const diffData = changed.data;\n    const actor = item.parent;\n    for (let updatedField of Object.keys(diffData)) {\n      if (updatedField === \"ancestralTrait\") {\n        const newTrait = diffData.ancestralTrait.value.trim();\n        const oldTrait = itemData.data.ancestralTrait.value;\n        if (newTrait !== oldTrait) {\n          await ZweihanderBaseItem.removeLinkedItem(item.parent, itemData.data.ancestralTrait.linkedId);\n          const trait = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, newTrait, 'trait', itemData.name, 'ancestry');\n          if (trait) {\n            diffData.ancestralTrait = trait;\n          }\n        }\n      }\n    }\n  }\n\n  async _preDelete(options, user, item) {\n    options.idToDelete=item.data.data.ancestralTrait.linkedId;\n  }\n\n  async _onDelete(options, user, item) {\n    await ZweihanderBaseItem.removeLinkedItem(item.parent, options.idToDelete);\n  }\n\n}","import ZweihanderWeapon from \"./entity/weapon\";\nimport ZweihanderProfession from \"./entity/profession\";\nimport ZweihanderSkill from \"./entity/skill\";\nimport ZweihanderAncestry from \"./entity/ancestry\";\n\nexport default class ZweihanderItem extends Item {\n\n  static types = {\n    weapon: new ZweihanderWeapon(),\n    profession: new ZweihanderProfession(),\n    skill: new ZweihanderSkill(),\n    ancestry: new ZweihanderAncestry()\n  };\n\n  constructor(...args) {\n    super(...args);\n  }\n\n  // convention: dispatch is async when the function it calls is\n  dispatch(fnName, cfg = {orElse: {value: {}, async: false}, args: []}) {\n    // console.log(`${this.name}: dispatch: ${fnName}`);\n    if (ZweihanderItem.types[this.type]) {\n      const type = ZweihanderItem.types[this.type];\n      if (type[fnName] && typeof type[fnName] === \"function\") {\n        if (cfg.args?.length) {\n          return (type[fnName])(...cfg.args, this);\n        } else {\n          return (type[fnName])(this.data, this);\n        }\n      }\n    }\n    if (cfg?.orElse?.async) {\n      return Promise.resolve(cfg?.orElse?.value);\n    } else {\n      return cfg?.orElse?.value;\n    }\n  }\n\n  prepareData() {\n    super.prepareData();\n  }\n\n  prepareBaseData() {\n    super.prepareBaseData();\n    this.dispatch(\"prepareBaseData\");\n  }\n\n  prepareEmbeddedDocuments() {\n    if (super.prepareEmbeddedDocuments) super.prepareEmbeddedDocuments();\n    this.dispatch(\"prepareEmbeddedEntities\");\n  }\n\n  prepareEmbeddedEntities() {\n    if (super.prepareEmbeddedEntities) super.prepareEmbeddedEntities();\n    this.dispatch(\"prepareEmbeddedEntities\");\n  }\n\n  applyActiveEffects() {\n    super.applyActiveEffects();\n    this.dispatch(\"applyActiveEffects\");\n  }\n\n  prepareDerivedData() {\n    super.prepareDerivedData();\n    this.dispatch(\"prepareDerivedData\");\n  }\n\n  async _preCreate(data, options, user) {\n    await super._preCreate(data, options, user);\n    if (this.parent === null) return;\n    await this.dispatch(\"_preCreate\", {args: [data, options, user]});\n  }\n\n  async _preDelete(options, user) {\n    await super._preDelete(options, user);\n    if (this.parent === null) return;\n    await this.dispatch(\"_preDelete\", {args: [options, user]});\n  }\n\n  async _onDelete(options, user) {\n    await super._preDelete(options, user);\n    if (user !== game.user.id) return\n    if (this.parent === null) return;\n    await this.dispatch(\"_onDelete\", {args: [options, user]});\n  }\n\n  async _preUpdate(changed, options, user) {\n    if (this.parent && changed.data) {\n      await this.dispatch(\"_preUpdate\", {args: [changed, options, user]});\n    }\n    await super._preUpdate(changed, options, user);\n  }\n\n  async _onUpdate(changed, options, user) {\n    await super._onUpdate(changed, options, user);\n    if (user !== game.user.id) return\n    if (this.parent === null || !changed.data) return;\n    await this.dispatch(\"_onUpdate\", {args: [changed, options, user]});\n  }\n}","import * as ZweihanderUtils from \"../../utils\";\n/**\n * Extend the basic ItemSheet with some very simple modifications\n * @extends {ItemSheet}\n */\nexport default class ZweihanderItemSheet extends ItemSheet {\n\n  /** @override */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: [\"zweihander\", \"sheet\", \"item\"],\n      template: 'systems/zweihander/templates/item/main.hbs',\n      width: 400,\n      height: 550,\n      resizable: true,\n      tabs: [{ navSelector: \".sheet-navigation\", contentSelector: \".sheet-body\", initial: \"details\" }],\n      dragDrop: [{ dragSelector: \".item-sheet-draggable\", dropSelector: null }]\n    });\n  }\n\n  _canDragStart(selector) {\n    return true;\n  }\n\n  _canDragDrop(selector) {\n    return this.isEditable;\n  }\n\n  _onDragDrop(event) {\n    \n  }\n\n  _onDragStart(event) {\n    const actor = this.item.actor;\n    const dragData = {\n      type: \"Item\",\n      data: this.item.data,\n      actorId: actor?.id ?? null,\n      ceneId: actor?.isToken ? canvas.scene?.id : null,\n      tokenId: actor?.isToken ? actor.token.id : null\n    }\n    // Set data transfer\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\n  }\n\n  /** @override */\n  async getData() {\n    const data = super.getData();\n    data.data.owner = this.item.isOwner;\n    data.data.editable = this.isEditable;\n    data.data.rollData = this.item.getRollData.bind(this.item);\n    if (this.item.type === \"weapon\") {\n      data.data.skills = (await ZweihanderUtils.findItemsByType(\"skill\", {takeOne: true})).map(x => x.name).sort((a, b) => a.localeCompare(b));\n    }\n    return data.data;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n    let data = this.object.data;\n    let fp = new FilePicker({\n      type: \"image\",\n      current: data.img,\n      displayMode: \"thumbs\",\n      callback: path => {\n        data.document.update({ img: path });\n        this.render(true)\n      }\n    });\n\n    html.find('.open-editor').click(async event => {\n      event.preventDefault();\n      const toggler = $(event.currentTarget);\n      const group = toggler.parents(\".form-group\");\n      const editor = group.find(\".editor\");\n      const preview = group.find(\".zh-editor-preview\");\n      $(preview).toggleClass(\"open\");\n      $(editor).toggleClass(\"open\");\n    })\n\n    html.find('.profile').click(async event => {\n      fp.render(true);\n    });\n\n    html.find('.array-input input').keypress(async (event) => event.which === 13 ? this.acceptArrayInput(event) : 0);\n    html.find('.array-input input').focusout(async (event) => this.acceptArrayInput(event));\n    html.find('.array-input-plus').click(async (event) => this.acceptArrayInput(event));\n    html.find('.array-input-pill').click(async (event) => this.removeArrayInput(event));\n  }\n\n  async _updateObject(event, formData) {\n    //@todo move to ZweihanderAncestry#update\n    if (this.item.type === 'ancestry') {\n      const trait = formData['data.ancestralTrait.value'];\n      const item = await ZweihanderUtils.findItemWorldWide('trait', trait);\n      if (item) {\n        formData['data.ancestralTrait.value'] = item.name;\n      }\n      if (!item && trait.trim() !== '') {\n        ui?.notifications.warn(`Couldn't find an ancestral trait with a name like ${trait} anywhere in the world or in compendia!`, { permanent: true });\n        //TODO move to actor#prepareDerivedData\n        if (this.item.isOwned) {\n          ui?.notifications.error(`Please choose a valid, existing ancestral trait!`, { permanent: true });\n        }\n      }\n    } else if (this.item.type === 'profession') {\n      const profTrait = formData['data.professionalTrait.value'];\n      let item;\n      item = await ZweihanderUtils.findItemWorldWide('trait', profTrait);\n      if (item) {\n        formData['data.professionalTrait.value'] = item.name;\n      }\n      if (!item && profTrait.trim() !== '') {\n        ui?.notifications.warn(`Couldn't find a professional trait with a name like ${profTrait} anywhere in the world or in compendia!`, { permanent: true });\n        //TODO move to actor#prepareDerivedData\n        if (this.item.isOwned) {\n          ui?.notifications.error(`Please choose a valid, existing professional trait!`, { permanent: true });\n        }\n      }\n      const specTrait = formData['data.specialTrait.value'];\n      item = await ZweihanderUtils.findItemWorldWide('trait', specTrait);\n      if (item) {\n        formData['data.specialTrait.value'] = item.name;\n      }\n      if (!item && specTrait.trim() !== '') {\n        ui?.notifications.warn(`Couldn't find a special trait with a name like ${specTrait} anywhere in the world or in compendia!`, { permanent: true });\n        //TODO move to actor#prepareDerivedData\n        if (this.item.isOwned) {\n          ui?.notifications.error(`Please choose a valid, existing special trait!`, { permanent: true });\n        }\n      }\n      const drawback = formData['data.drawback.value'];\n      item = await ZweihanderUtils.findItemWorldWide('drawback', drawback);\n      if (item) {\n        formData['data.drawback.value'] = item.name;\n      }\n      if (!item && drawback.trim() !== '') {\n        ui?.notifications.warn(`Couldn't find a drawback with a name like ${drawback} anywhere in the world or in compendia!`, { permanent: true });\n        //TODO move to actor#prepareDerivedData\n        if (this.item.isOwned) {\n          ui?.notifications.error(`Please choose a valid, existing drawback!`, { permanent: true });\n        }\n      }\n    }\n    super._updateObject(event, formData);\n  }\n\n  async acceptArrayInput(event, prevent = true) {\n    if (prevent) event.preventDefault();\n    const html = event.currentTarget;\n    const arrayInput = $(html).parent('.array-input');\n    const target = arrayInput.data('arrayInputTarget');\n    const input = arrayInput.find('input').val();\n    let array = getProperty(this.item.toObject(false), target);\n    const max = arrayInput.data('arrayInputMax') ?? Number.MAX_SAFE_INTEGER;\n    if (!input?.trim()) return;\n    const inputs = input.split(',').map(v => v.trim()).filter(v => v !== '');\n    if (array.length + inputs.length > max) {\n      const caption = arrayInput.parents('.form-group').find('label').text();\n      ui?.notifications.warn(`You can't add more than ${max} entries in \"${caption}\"!`);\n      const toAdd = max - array.length;\n      inputs.splice(toAdd, inputs.length - toAdd);\n      if (inputs.length === 0) return;\n    }\n    switch (target) {\n      case 'data.ancestralModifiers.negative':\n      case 'data.ancestralModifiers.positive':\n        array = array.concat(await this.addInputToArray(inputs, async x => this.validateBonusAbbr(x), false));\n        break;\n      case 'data.bonusAdvances':\n        array = array.concat(\n          await this.addInputToArray(inputs, async x => {\n            const vx = await this.validateBonusAbbr(x); return vx ? {value: vx} : vx\n          }, false)\n        );\n        break;\n      case 'data.talents':\n        array = array.concat(await this.addInputToArray(inputs, async x => await this.validateTalent(x)));\n        break;\n      case 'data.skillRanks':\n        array = array.concat(await this.addInputToArray(inputs, async x => await this.validateSkillRank(x)));\n        break;\n    }\n    await this.item.update({ [target]: array }).then(() => this.render(false));\n  }\n\n  async addInputToArray(inputs, validationFn, unique = true) {\n    if (unique) {\n      inputs = [...new Set(inputs)];\n    }\n    const array = [];\n    for (let input of inputs) {\n      const validatedInput = await validationFn(input);\n      if (validatedInput) {\n        array.push(validatedInput);\n      }\n    }\n    return array;\n  }\n\n  async removeArrayInput(event) {\n    event.preventDefault();\n    const html = event.currentTarget;\n    const arrayInput = $(html).parents('.array-input');\n    const target = arrayInput.data('arrayInputTarget');\n    const array = getProperty(this.item.toObject(false), target);\n    const i = $(html).data('arrayInputIndex');\n    array.splice(i, 1);\n    this.item.update({ [target]: array }).then(() => this.render(false));\n  }\n\n  async validateBonusAbbr(bonusAbbr) {\n    //TODO: move to const?\n    const validValues = ['[CB]', '[BB]', '[AB]', '[PB]', '[IB]', '[WB]', '[FB]'];\n    const sanitized = `[${bonusAbbr.trim().replaceAll(/[^a-zA-Z]/g, '').toUpperCase()}]`;\n    if (validValues.includes(sanitized)) {\n      return sanitized;\n    } else {\n      ui?.notifications.warn(`\"${sanitized}\" is not a valid Bonus Abbreviation! Valid values: ${validValues}`)\n    }\n  }\n\n  async validateTalent(talent) {\n    const item = this.item;\n    if (item.data.data?.talents?.some(t => ZweihanderUtils.normalizedEquals(t.value,talent))) {\n      ui?.notifications.warn(`A Talent named \"${talent}\" already belongs to item \"${item.name}\" of type \"${item.type}\". Skill Ranks must be unique!`);\n      return;\n    }\n    const foundItem = await ZweihanderUtils.findItemWorldWide('talent', talent);\n    if (foundItem) {\n      return {value: foundItem.name};\n    } else {\n      ui?.notifications.warn(`Couldn't find Talent with a name like ${talent} anywhere in the world or in compendia!`, { permanent: true });\n      //TODO move to actor#prepareDerivedData\n      if (this.item.isOwned) {\n        ui?.notifications.error(`Please choose a valid, existing talent!`, { permanent: true });\n      }\n      return {value: talent};\n    }\n  }\n\n  async validateSkillRank(skillRank) {\n    const item = this.item;\n    if (item.data.data?.skillRanks?.some(sr => ZweihanderUtils.normalizedEquals(sr.value,skillRank))) {\n      ui?.notifications.warn(`A Skill Rank in \"${skillRank}\" already belongs to item \"${item.name}\" of type \"${item.type}\". Skill Ranks must be unique!`);\n      return;\n    }\n    const foundItem = await ZweihanderUtils.findItemWorldWide('skill', skillRank);\n    if (foundItem) {\n      return {value: foundItem.name};\n    } else {\n      ui?.notifications.warn(`Couldn't find Skill Rank with a name like ${skillRank} anywhere in the world or in compendia!`, { permanent: true });\n      //TODO move to actor#prepareDerivedData\n      if (this.item.isOwned) {\n        ui?.notifications.error(`Please choose a valid, existing skill!`, { permanent: true });\n      }\n      return {value: skillRank};\n    }\n  }\n\n}\n","export default class FortuneTracker extends Application {\n\n  static get PARAMS() {\n    const size = game.settings.get(\"zweihander\", \"fortuneTrackerSize\");\n    switch (size) {\n      case \"compact\":\n        return {\n          compact: true,\n          tokenSize: 25,\n          padding: 0,\n          areaSize: 60\n        }\n      case \"normal\":\n        return {\n          tokenSize: 64,\n          padding: 5,\n          areaSize: 120\n        }\n      case \"big\":\n        return {\n          tokenSize: 83,\n          padding: 10,\n          areaSize: 180\n        }\n      case \"huge\":\n        return {\n          tokenSize: 125,\n          padding: 15,\n          areaSize: 300\n        }\n    }\n  }\n\n  static registerPersistingSettings() {\n    game.settings.register(\"zweihander\", \"fortuneTrackerPersistedStateTotal\", {\n      name: \"fortuneTrackerPersistedStateTotal\",\n      hint: \"\",\n      scope: \"world\",\n      type: Number,\n      default: 0,\n      config: false\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerPersistedStateUsed\", {\n      name: \"fortuneTrackerPersistedStateUsed\",\n      hint: \"\",\n      scope: \"world\",\n      type: Number,\n      default: 0,\n      config: false\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerPersistedStateRemoved\", {\n      name: \"fortuneTrackerPersistedStateRemoved\",\n      hint: \"\",\n      scope: \"world\",\n      type: Number,\n      default: 0,\n      config: false\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerRuleSystem\", {\n      name: \"Fortune Tracker Rule System\",\n      hint: \"Choose how you wish to implement fortune points and misfortune points in your game.\",\n      scope: \"world\",\n      type: String,\n      choices: {\n        \"remove\": \"Using misfortune points removes them from the game\",\n        \"keep\": \"Using misfortune points returns them to the party as fortune points\"\n      },\n      default: \"remove\",\n      config: true\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerNotifications\", {\n      name: \"Fortune Tracker Notification Behaviour\",\n      hint: \"Choose how you wish to be notified about spent Fortune points.\",\n      scope: \"world\",\n      type: String,\n      choices: {\n        \"none\": \"No Notifications (See current value on hovering tokens)\",\n        \"notify\": \"Post Foundry Notifications\",\n        \"chat\": \"Post Chat Messages\"\n      },\n      default: \"notify\",\n      config: true\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerSize\", {\n      name: \"Fortune Tracker Size\",\n      hint: \"Choose the size of your fortune tracker.\",\n      scope: \"client\",\n      type: String,\n      choices: {\n        \"compact\": \"Compact (Text)\",\n        \"normal\": \"Normal (Tokens)\",\n        \"big\": \"Big (Tokens)\",\n        \"huge\": \"Huge (Tokens)\"\n      },\n      default: \"normal\",\n      config: true\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerFortunePath\", {\n      name: \"Fortune Token Image\",\n      hint: \"Customize the fortune token image. For best appearance use an image of at least 125x125 pixels.\",\n      scope: \"world\",\n      type: String,\n      default: \"systems/zweihander/assets/fortune-life.png\",\n      config: true\n    });\n    game.settings.register(\"zweihander\", \"fortuneTrackerMisfortunePath\", {\n      name: \"Misfortune Token Image\",\n      hint: \"Customize the misfortune token image. For best appearance use an image of at least 125x125 pixels.\",\n      scope: \"world\",\n      type: String,\n      default: \"systems/zweihander/assets/fortune-death.png\",\n      config: true\n    });\n  }\n\n  // business logic\n\n  #waiting = false;\n\n  #state = {\n    total: 0,\n    used: 0,\n    removed: 0\n  }\n\n  #socket;\n\n  #positions = [];\n\n  // this should be refactored to a getter if we ever offer the user to close the fortune tracker app\n  #closable = false;\n\n\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      template: 'systems/zweihander/templates/fortune-tracker.hbs',\n      popOut: true,\n      resizable: false,\n      title: 'Fortune Tracker',\n      id: 'fortuneTrackerApp',\n      classes: ['zweihander'],\n      width: FortuneTracker.PARAMS.areaSize * 2,\n      height: FortuneTracker.PARAMS.areaSize + 30,\n      top: 60,\n      left: 125\n    });\n  }\n\n  constructor(socket) {\n    super();\n    const that = this;\n    function requestSync(state, requestingUserId) {\n      if (state) {\n        let validationError = that.validate(state, requestingUserId);\n        if (!validationError) {\n          socket.executeForEveryone(\"broadcastState\", state);\n        } else {\n          socket.executeForEveryone(\"broadcastState\", that.state);\n          socket.executeAsUser(\"showIllegalStateNotification\", requestingUserId, validationError);\n        }\n      } else {\n        return that.state;\n      }\n    }\n    \n    function broadcastState(state) {\n      that.state = state;\n    }\n    \n    function showIllegalStateNotification(validationError) {\n      ui.notifications.error(validationError);\n    }\n\n    socket.register(\"requestSync\", requestSync);\n    socket.register(\"broadcastState\", broadcastState);\n    socket.register(\"showIllegalStateNotification\", showIllegalStateNotification);\n\n    this.#socket = socket;\n    \n    // generate random positions\n    this.generateRandomPositionValues();\n  }\n\n  get resetRule() {\n    return \"Set total fortune points to the number of connected players plus one.\";\n  }\n\n  get rules() {\n    return game.settings.get(\"zweihander\", \"fortuneTrackerRuleSystem\");\n  }\n\n  get state() {\n    return {\n      total: this.#state.total,\n      used: this.#state.used,\n      removed: this.#state.removed\n    }\n  }\n\n  set state(updatedState) {\n    if (updatedState.used !== this.used || updatedState.removed !== this.removed || updatedState.total !== this.total) {\n      this.playAudio();\n    }\n    this.#waiting = false;\n    this.#state = updatedState;\n    if (game.users.get(game.userId).isGM) {\n      game.settings.set(\"zweihander\", \"fortuneTrackerPersistedStateTotal\", this.total);\n      game.settings.set(\"zweihander\", \"fortuneTrackerPersistedStateUsed\", this.used);\n      game.settings.set(\"zweihander\", \"fortuneTrackerPersistedStateRemoved\", this.removed);\n    }\n    this.render(!this.closable);\n  }\n\n  get total() {\n    return this.#state.total;\n  }\n\n  increaseTotal() {\n    const s = this.state;\n    s.total++;\n    return s;\n  }\n\n  decreaseTotal() {\n    const s = this.state;\n    s.total--;\n    if (s.total < s.used) {\n      s.used--;\n    }\n    if (s.total < s.removed) {\n      s.removed--;\n    }\n    return s;\n  }\n\n  //TODO implement different rule systems\n  spendFortune() {\n    const s = this.state;\n    s.used++;\n    return s;\n  }\n\n  //TODO implement different rule systems\n  spendMisfortune() {\n    const s = this.state;\n    const r = this.rules;\n    if (r === \"keep\") {\n      s.used--;\n    } else {\n      s.removed++;\n    }\n    return s;\n  }\n\n  get used() {\n    return this.#state.used;\n  }\n\n  get removed() {\n    return this.#state.removed;\n  }\n\n  get fortune() {\n    return this.total - this.used;\n  }\n\n  get misfortune() {\n    return this.used - this.removed;\n  }\n\n  generateRandomPositionValues(keepFortune=0, keepMisfortune=0) {\n\n    function getRandomIntInclusive(min, max) {\n      min = Math.ceil(min);\n      max = Math.floor(max);\n      return Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and the minimum is inclusive\n    }\n\n    const n = (keepFortune * 2) % 20;\n    const m = 20 + (keepMisfortune * 2) % 20;\n    \n    for (let i = n; i < 40; i++) {\n      if (i < 20 || (i >= m && i < 40)) {\n        this.#positions[i] = (getRandomIntInclusive(FortuneTracker.PARAMS.padding, FortuneTracker.PARAMS.areaSize - FortuneTracker.PARAMS.tokenSize - FortuneTracker.PARAMS.padding));\n      }\n    }\n    \n  }\n  //TODO implement different rule systems\n  validate(updatedState, requestingUserId) {\n    // console.log(this.state);\n    // console.log(updatedState);\n    const notifySetting = game.settings.get(\"zweihander\", \"fortuneTrackerNotifications\");\n    const user = game.users.get(requestingUserId);\n    if (updatedState.total !== this.total && !user.isGM) {\n      return \"You are not privileged to change the total amount of fortune in the game!\";\n    } else if (updatedState.removed !== this.removed && !user.isGM) {\n      return \"You are not privileged to spend misfortune! Know your place peasant, or be smited!\";\n    } else if (updatedState.used < this.used && !user.isGM) {\n      return \"You are not privileged to spend misfortune! Know your place, peasant!\";\n    } else if (updatedState.total < 0) {\n      return \"Sorry, but you can't have a negative amount of fortune. Kindly turn a demon or a foul god for the equivalent outcome!\";\n    } else if (updatedState.used < 0) {\n      return \"There is no misfortune left for the GM at this time.\";\n    } else if (updatedState.removed < 0) {\n      return \"Can't have negative removed tokens! (You should never see this error. If you do, please contact the developer.)\";\n    } else if (updatedState.used > updatedState.total) {\n      return \"There is no fortune left for the party at this time.\"\n    } else if (updatedState.removed > updatedState.used) {\n      return \"There is no misfortune left for the GM at this time.\"\n    } else {\n      if (updatedState.used === this.used + 1) {\n        const name = user.charname ? user.charname : user.name;\n        if (notifySetting === \"notify\") {\n          ui.notifications.info(`${name} used a fortune point. Current fortune points: ${updatedState.total-updatedState.used}/${updatedState.total}`);\n        } else if (notifySetting === \"chat\") {\n          ChatMessage.create({user: requestingUserId, content: `${name} used a fortune point. Let's hope they make it count! <p><b>Current fortune points: ${updatedState.total-updatedState.used}/${updatedState.total} </b></p>`})\n        }\n      } else if ((updatedState.remove === this.remove + 1 || updatedState.used === this.used - 1) && this.total === updatedState.total) {\n        if (notifySetting === \"notify\") {\n          ui.notifications.info(`Brace yourselves, the GM used a misfortune point! Current fortune points: ${updatedState.total-updatedState.used}/${updatedState.total}`);\n        } else if (notifySetting === \"chat\") {\n          ChatMessage.create({user: requestingUserId, content: `Brace yourselves, the GM used a misfortune point! <p><b>Current fortune points: ${updatedState.total-updatedState.used}/${updatedState.total} </b></p>`})\n        }\n      }\n      return false;\n    }\n  }\n\n  // Foundry methods\n  getData() {\n    this.generateRandomPositionValues(this.fortune, this.misfortune);\n    let fortunePositions = [];\n    for (let i = 0; i < this.fortune; i++) {\n      let t = this.#positions[2 * (i % 10)];\n      let l = this.#positions[2 * (i % 10) + 1];\n      fortunePositions.push({ t, l })\n    }\n    let misfortunePositions = [];\n    for (let i = 0; i < this.misfortune; i++) {\n      let t = this.#positions[2 * (i % 10) + 20];\n      let l = this.#positions[2 * (i % 10) + 21];\n      misfortunePositions.push({ t, l })\n    }\n    return {\n      total: this.total,\n      fortune: {\n        value: this.fortune,\n        positions: fortunePositions,\n        path: game.settings.get(\"zweihander\", \"fortuneTrackerFortunePath\")\n      },\n      misfortune: {\n        value: this.misfortune,\n        positions: misfortunePositions,\n        path: game.settings.get(\"zweihander\", \"fortuneTrackerMisfortunePath\")\n      },\n      waiting: this.#waiting,\n      params: FortuneTracker.PARAMS\n    }\n  }\n\n  async syncState() {\n    if (game.users.get(game.userId).isGM) {\n      this.#state = {\n        total: game.settings.get(\"zweihander\", \"fortuneTrackerPersistedStateTotal\"),\n        used: game.settings.get(\"zweihander\", \"fortuneTrackerPersistedStateUsed\"),\n        removed: game.settings.get(\"zweihander\", \"fortuneTrackerPersistedStateRemoved\")\n      };\n      this.#waiting = false;\n      this.#socket.executeForOthers(\"broadcastState\", this.state);\n    } else {\n      this.#state = await this.requestSync();\n    }\n    this.render(!this.closable);\n  }\n\n  resetState() {\n    if (game.users.get(game.userId).isGM) {\n      const activePlayers = game.users.players.map(x => (x.active ? 1 : 0)).reduce((x, y) => x + y, 0);\n      this.state = {\n        total: activePlayers + 1, //TODO: customize this for rule systems\n        used: 0,\n        removed: 0\n      }\n      this.#socket.executeForOthers(\"broadcastState\", this.state);\n    } else {\n      ui.notifications.error(\"Only the GM may reset the fortune tracker. Keep your dirty hands to yourself, foolish thing!\");\n    }\n  }\n\n  async requestSync(updatedState) {\n    try {\n      if (updatedState) {\n        return await this.#socket.executeAsGM(\"requestSync\", updatedState, game.userId);\n      } else {\n        return await this.#socket.executeAsGM(\"requestSync\");\n      }\n    } catch (e) {\n      console.error(e);\n      this.#waiting = true;\n      this.render(!this.closable);\n      ui.notifications.warn(\"Fortune Tracker is waiting for a GM to (re)connect.\");\n      return this.state;\n    }\n  }\n\n  // toggle() {\n  //   if (this.rendered) {\n  //     this.close();\n  //   } else {\n  //     this.render(true);\n  //     this.syncState();\n  //   }    \n  // }\n\n  // hookToChatTab(app, html, data) {\n  //   if (app.tabName === \"chat\") {\n  //     let controls = html.find('#chat-controls > .control-buttons');\n  //     controls.css({flex: \"0 0 auto\"});\n  //     controls.prepend(`\n  //       <a class=\"open-fortune-tracker\" title=\"Toggle Fortune Tracker\">\n  //         <i class=\"fas ra ra-circle-of-circles\"></i>\n  //       </a>\n  //     `);\n  //     html.find(\".open-fortune-tracker\").click(this.toggle.bind(this))\n  //   }\n  // }\n\n  // This should go to main.js if we ever fancy to offer the user to close the fortune tracker. \n  // Hooks.on(\"renderSidebarTab\", (app, html, data) => {\n  //   fortuneTrackerApp.hookToChatTab(app, html, data);\n  // })\n\n  async close() {\n    // can't touch (close) this\n  }\n\n  activateListeners(html) {\n    const app = html.parents(\"#fortuneTrackerApp\");\n    let totalTrigger;\n    if (!app.find('#fortuneTrackerAppTotal').length) {\n      app.find('a.header-button.close').before(`\n        <a id=\"fortuneTrackerAppTotal\" class=\"waiting-${this.#waiting}\">\n          Total: ${this.total}\n        </a>\n        <a class=\"fortune-tracker-reset\" title=\"${this.resetRule}\">\n          <i class=\"fas fa-sync-alt\"></i>\n        </a>\n      `);\n      let resetTrigger = app.find('.fortune-tracker-reset');\n      resetTrigger.click(event => {\n        event.preventDefault();\n        this.resetState();\n      });\n      totalTrigger = app.find('#fortuneTrackerAppTotal');\n      app.find('a.header-button.close').remove();\n    } else {\n      app.find('#fortuneTrackerAppTotal')\n        .replaceWith(`<a id=\"fortuneTrackerAppTotal\" class=\"waiting-${this.#waiting}\">Total: ${this.total}</a>`);\n      totalTrigger = app.find('#fortuneTrackerAppTotal')\n    }\n    totalTrigger.click(event => {\n      event.preventDefault();\n      this.requestSync(this.increaseTotal());\n    });\n    totalTrigger.contextmenu(event => {\n      event.preventDefault();\n      this.requestSync(this.decreaseTotal());\n    });\n\n    let fortuneTrigger = html.find('.fortune-tracker-fortune-trigger');\n    fortuneTrigger.click(event => {\n      event.preventDefault();\n      this.requestSync(this.spendFortune());\n    });\n\n    let misfortuneTrigger = html.find('.fortune-tracker-misfortune-trigger');\n    misfortuneTrigger.click(event => {\n      event.preventDefault();\n      this.requestSync(this.spendMisfortune());\n    });\n  }\n\n  playAudio() {\n    AudioHelper.play({src: 'systems/zweihander/assets/sounds/coins.mp3', volume: 0.5, loop: false}, true);\n  }\n}","export const registerSystemSettings = function() {\n  /* -------------------------------------------- */\n  /*  System settings registration                */\n  /* -------------------------------------------- */\n\n  game.settings.register(\"zweihander\", \"systemMigrationVersion\", {\n    name: \"System Migration Version\",\n    scope: \"world\",\n    config: false,\n    type: String,\n    default: \"\"\n  });\n\n  game.settings.register(\"zweihander\", \"encumbranceNineForOne\", {\n    name: \"Small Item Encumbrance\",\n    hint: \"Enable or disable rule for small item Encumbrance, where 9 small items add up to 1 point of Encumbrance.\",\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true\n  });\n\n  game.settings.register(\"zweihander\", \"trackRewardPoints\", {\n    name: \"Automatically Track Reward Points\",\n    hint: \"Enable or disable the automatic tracking of Reward Point expenditure.\",\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true\n  });\n\n  game.settings.register(\"zweihander\", \"theme\", {\n    name: \"Zweihander Sheet Theme\",\n    hint: \"Choose a theme for your Zweihander sheets\",\n    scope: \"client\",\n    type: String,\n    default: \"gruvbox-dark\",\n    choices: {\n      \"gruvbox-dark\": \"Gruvbox Dark\",\n      \"gruvbox-light\": \"Gruvbox Light\"\n    },\n    config: true,\n    onChange: theme => {\n      $(\".system-zweihander\").addClass(\"zweihander-theme-\" + theme);\n      $(\".system-zweihander\").removeClass((i, c) =>\n        c.split(\" \").filter(c =>\n          c.startsWith(\"zweihander-theme-\") && c !== \"zweihander-theme-\" + theme\n        )\n      );\n    }\n  });\n}","/**\n * Define a set of template paths to pre-load\n * Pre-loaded templates are compiled and cached for fast access when rendering\n * @returns {Promise}\n */\n\nexport const preloadHandlebarsTemplates = async function () {\n  const $$ = (path) => 'systems/zweihander/templates/' + path + '.hbs'\n  return loadTemplates([\n    $$('pc/tab-afflictions'),\n    $$('pc/tab-background'),\n    $$('pc/tab-magick'),\n    $$('pc/tab-main'),\n    $$('pc/tab-tiers'),\n    $$('pc/tab-trappings'),\n    $$('pc/header'),\n    $$('item/ancestry'),\n    $$('item/armor'),\n    $$('item/condition'),\n    $$('item/disease'),\n    $$('item/disorder'),\n    $$('item/drawback'),\n    $$('item/injury'),\n    $$('item/profession'),\n    $$('item/ritual'),\n    $$('item/skill'),\n    $$('item/spell'),\n    $$('item/talent'),\n    $$('item/trait'),\n    $$('item/trapping'),\n    $$('item/quality'),\n    $$('item/uniqueAdvance'),\n    $$('item/weapon')\n  ]);\n};\n","/**\n * Define a set of handlebar helpers\n * @returns {Promise}\n */\nexport const registerHandlebarHelpers = async function () {\n  function uuidv4() {\n    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n  }\n\n  const $$ = (name, fn) => Handlebars.registerHelper(name, fn);\n\n  $$('$$', function(path) {\n    return 'systems/zweihander/templates/' + path + '.hbs'\n  })\n\n  $$('getFirstLetter', function(word) {\n    if (typeof word !== 'string') return '';\n    return word.charAt(0).toUpperCase();\n  });\n\n  $$('capitalize', function(word) {\n    if (typeof word !== 'string') return '';\n    return word.capitalize();\n  });\n\n  $$('isMissing', function(toCheck, options) {\n    if (!Array.isArray(toCheck))\n      return toCheck === \"\" ? options.inverse(this) : options.fn(this);\n    else\n      return toCheck[0] === \"\" ? options.inverse(this) : options.fn(this);  // An empty input field results in first element of array becoming the empty String\n  });\n\n  $$('oddOrEven', function(idx) {\n    if ((idx + 1) % 2)\n      return \"odd\";\n    else\n      return \"even\";\n  });\n\n  $$('radioRanks', function(name, choices, options) {\n    const checked = options.hash['checked'] || null;\n\n    let html = \"\";\n    let i = 0;\n    let uuid = uuidv4();\n    for (let [key, label] of Object.entries(choices)) {\n      const isChecked = checked === key;\n      html += `<input type=\"radio\" class=\"rd\" name=\"${name}\" id=\"${uuid}.${name + i}\" value=\"${key}\" ${isChecked ? \"checked\" : \"\"}><label for=\"${uuid}.${name + i++}\">${label}</label>`;\n    }\n\n    return new Handlebars.SafeString(html);\n  });\n\n  $$('radioThresholds', function(name, choices, options) {\n    const checked = options.hash['checked'] || null;\n    const elem = options.hash['elem'] || \"span\"\n    let html = \"\";\n    let uuid = uuidv4();\n\n    for (let [key, label] of Object.entries(choices)) {\n      const isChecked = checked == key;\n      html += `<div class=\"radio-and-status\"><input type=\"radio\" class=\"radio-rank\" id=\"${uuid}.${key}\" name=\"${name}\" value=\"${key}\" ${isChecked ? \"checked\" : \"\"}><${elem} for=\"${uuid}.${key}\" class=\"status\">${label}</${elem}></div>`;\n    }\n\n    return new Handlebars.SafeString(html);\n  });\n\n  $$('checkUniqueAdvanceType', function(type, associatedSkill) {\n    if (type.trim().toLowerCase() === \"focus\") {\n      return `Focus (${associatedSkill})`;\n    } else {\n      return type;\n    }\n  });\n\n  $$('displayNpcSkillBonus', function(ranks) {\n    let modifier = 0;\n\n    for (let key of Object.keys(ranks)) {\n      if (ranks[key].purchased) {\n        modifier += 10;\n      } else {\n        break;\n      }\n    }\n\n    return modifier !== 0 ? \"+\" + modifier : \"\";\n  });\n\n  $$('rpSettingOn', function(options) {\n    return game.settings.get(\"zweihander\", \"trackRewardPoints\") ? options.fn(this) : options.inverse(this);\n  });\n\n  $$('generateResultText', function(testResult, roll, totalChance, showFlip) {\n    const flipString = showFlip ? \"*\" : \"\";\n\n    switch (testResult) {\n      case 0:\n        return new Handlebars.SafeString(`<span class=\"failure\">Critical Failure</span> (${roll} vs. ${totalChance})${flipString}`);\n      case 1:\n        return new Handlebars.SafeString(`<span class=\"failure\">Failure</span> (${roll} vs. ${totalChance})${flipString}`);\n      case 2:\n        return new Handlebars.SafeString(`<span class=\"success\">Success</span> (${roll} vs. ${totalChance})${flipString}`);\n      case 3:\n        return new Handlebars.SafeString(`<span class=\"success\">Critical Success</span> (${roll} vs. ${totalChance})${flipString}`);\n      default:\n        break;\n    }\n  });\n\n  $$('generateFlipText', function(flip) {\n    return flip === \"no-flip\" ? \"No\" : (flip === \"fail\" ? \"To Fail\" : \"To Succeed\");\n  });\n\n  $$('checkSuccess', function(testResult, options) {\n    return testResult >= 2 ? options.fn(this) : options.inverse(this);\n  });\n\n  $$('checkCriticalSuccess', function(testResult, options) {\n    return testResult === 3 ? options.fn(this) : options.inverse(this);\n  });\n\n  $$('checkCriticalFailure', function(testResult, options) {\n    return testResult === 0 ? options.fn(this) : options.inverse(this);\n  });\n\n  $$('displayIndividualDice', function(arrayOfDice, delimitator, highlight) {\n    let expandedFormula = \"\";\n\n    for (let d = 0; d < arrayOfDice.length; d++) {\n      let results = arrayOfDice[d].results;\n\n      for (let i = 0; i < results.length; i++) {\n        if (highlight && results[i].result === 6)\n          expandedFormula += `<a class=\"highlight\" title=\"Generate Chaos Manifestation\">` + results[i].result + \"</a>\";\n        else\n          expandedFormula += results[i].result;\n\n        if (i !== results.length - 1) {\n          expandedFormula += delimitator;\n        }\n      }\n\n      if (d !== arrayOfDice.length - 1) {\n        expandedFormula += delimitator;\n      }\n    }\n\n    return new Handlebars.SafeString(expandedFormula);\n  });\n\n  $$('selectSpellDifficulty', function(optionIdx, principle) {\n    switch (principle) {\n      case \"Petty\":\n      case \"Generalist\":\n        return optionIdx === 0 ? \"selected\" : \"\";\n      case \"Lesser\":\n        return optionIdx === 1 ? \"selected\" : \"\";\n      case \"Greater\":\n        return optionIdx === 2 ? \"selected\" : \"\";\n      default:\n        break;\n    }\n  });\n  \n  $$('pa2Icon', function(key) {\n    return {\n      'combat': 'ra ra-croc-sword',\n      'brawn': 'ra ra-muscle-up',\n      'agility': 'fa fa-running',\n      'perception': 'ra ra-aware',\n      'intelligence': 'ra ra-book',\n      'willpower': 'ra ra-crystal-ball',\n      'fellowship': 'ra ra-double-team'\n    }[key];\n  })\n\n  $$('markdownIt', function(md) {\n    if (window.MEME?.markdownIt?.render) {\n      return window.MEME?.markdownIt?.render(md)\n    } else {\n      return md;\n    }\n  })\n\n  $$('itemTemplatePath', function(itemType) { \n    return 'systems/zweihander/templates/item/' + itemType + '.hbs';\n  })\n\n  $$('itemImageClass', function(img) {\n    return img.endsWith(\".svg\") ? \"item-image item-image-icon\" : \"item-image item-image-picture\";\n  })\n\n  $$('itemImageStyle', function(img) {\n    return img.endsWith(\".svg\") ? `-webkit-mask-image: url('${img}')` : `background-image: url('${img}')`;\n  })\n\n  $$('arrayInputGroup', function(label, target, array, max=Number.MAX_SAFE_INTEGER, pillDisplayProperty) {\n    return `<div class=\"form-group\">\n    <label>${label}</label>\n    <div class=\"array-input flexrow\" data-array-input-target=\"${target}\" data-array-input-max=\"${max}\">\n      <input name=\"proxy.${target}\" type=\"text\" placeholder=\"Enter values here\">\n      <button class=\"array-input-plus\" type=\"button\" tabindex=\"-1\"><i class=\"fas fa-plus\"></i></button>\n      <div class=\"array-input-pills\">\n        ${array.map((v, i) => `\n          <span class=\"array-input-pill\" data-array-input-index=\"${i}\">${v[pillDisplayProperty] ?? v}</span>\n        `)}\n      </div>\n    </div>\n  </div>`\n  })\n\n  $$('skillBonus', function(bonus) {\n    return bonus ? `+${bonus}` : '';\n  })\n\n  $$('skillRankAbbreviation', function(rank) {\n    return ['-', 'Appr.', 'Jour.', 'Mstr.'][rank];\n  })\n\n}","import ZweihanderBaseItem from \"./item/entity/base-item\";\n\nexport const migrateWorld = async function () {\n  ui.notifications.info(`Applying Zweihander System Migration for version ${game.system.data.version}. Please be patient and do not close your game or shut down your server.`, { permanent: true });\n\n  // Migrate World Actors\n  for (let a of game.actors) {\n    try {\n      const updateData = await migrateActorData(a);\n      if (!foundry.utils.isObjectEmpty(updateData)) {\n        console.log(`Migrating Actor document ${a.name}`);\n        await a.update(updateData, { enforceTypes: false });\n      }\n    } catch (err) {\n      err.message = `Failed Zweihander system migration for Actor ${a.name}: ${err.message}`;\n      console.error(err);\n    }\n  }\n\n  // Migrate World Items\n  for (let i of game.items) {\n    try {\n      const updateData = await migrateItemData(i);\n      if (!foundry.utils.isObjectEmpty(updateData)) {\n        console.log(`Migrating Item document ${i.name}`);\n        await i.update(updateData, { enforceTypes: false });\n      }\n    } catch (err) {\n      err.message = `Failed Zweihander system migration for Item ${i.name}: ${err.message}`;\n      console.error(err);\n    }\n  }\n\n  // Migrate World Compendium Packs\n  for (let p of game.packs) {\n    // if (p.metadata.package !== \"world\") continue;\n    if (![\"Actor\", \"Item\", \"Scene\"].includes(p.documentName)) continue;\n    await migrateCompendium(p);\n  }\n\n  // Set the migration as complete\n  game.settings.set(\"zweihander\", \"systemMigrationVersion\", game.system.data.version);\n  ui.notifications.info(`Zweihander System Migration to version ${game.system.data.version} completed!`, { permanent: true });\n};\n\nconst migrateCompendium = async function (pack) {\n  const entity = pack.documentName;\n  if (![\"Actor\", \"Item\"].includes(entity)) return;\n\n  // Unlock the pack for editing\n  const wasLocked = pack.locked;\n  await pack.configure({ locked: false });\n\n  // Begin by requesting server-side data model migration and get the migrated content\n  const documents = await pack.getDocuments();\n\n  // Iterate over compendium entries - applying fine-tuned migration functions\n  for (let doc of documents) {\n    let updateData = {};\n    try {\n      switch (entity) {\n        // case \"Actor\":\n        //   updateData = migrateActorData(doc.toObject());\n        //   break;\n        case \"Item\":\n          updateData = await migrateItemData(doc);\n          break;\n      }\n\n      // Save the entry, if data was changed\n      if (foundry.utils.isObjectEmpty(updateData)) continue;\n      await doc.update(updateData);\n      console.log(`Migrated ${entity} entity ${doc.name} in Compendium ${pack.collection}`);\n    }\n\n    // Handle migration failures\n    catch (err) {\n      err.message = `Failed Zweihander system migration for entity ${doc.name} in pack ${pack.collection}: ${err.message}`;\n      console.error(err);\n    }\n  }\n  await pack.migrate();\n\n  // Apply the original locked status for the pack\n  await pack.configure({ locked: wasLocked });\n  console.log(`Migrated all ${entity} entities from Compendium ${pack.collection}`);\n}\n\nconst migrateActorData = async function (actor) {\n  const updateData = {};\n  // Actor Data Updates\n  if (actor.data) {\n    // future migrations might need this\n  }\n  // Migrate Owned Items\n  if (!actor.items) return updateData;\n  const items = [];\n  for (let i of actor.items) {\n    // Migrate the Owned Item\n    let itemUpdate = await migrateItemData(i);\n    // Update the Owned Item\n    if (!isObjectEmpty(itemUpdate)) {\n      itemUpdate._id = i.id;\n      items.push(expandObject(itemUpdate));\n    }\n  }\n  if (items.length > 0) updateData.items = items;\n  return updateData;\n};\n\n\nexport const migrateItemData = async function (item) {\n  let updateData = {};\n  const rmSource = ['trait', 'talent', 'drawback'];\n  if (item.type === 'ancestry') {\n    updateData = await migrateAncestry(item);\n  } else if (item.type === 'profession') {\n    updateData = await migrateProfession(item);\n  } else if (rmSource.includes(item.type)) {\n    // item.setFlag('zweihander', 'source', null);\n  }\n  return updateData;\n};\n\nconst migrateAncestry = async function (item) {\n  const actor = item.actor;\n  item = item.toObject();\n  let traitId = item.data.ancestralTrait.linkedId ?? null;\n  let traitValue = item.data.ancestralTrait.value;\n  if (actor) {\n    if (traitValue && !traitId) {\n      const trait = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, traitValue, 'trait', item.name, 'ancestry');\n      traitId = trait.linkedId;\n      traitValue = trait.value;\n    }\n  }\n  return {\n    'data.ancestralTrait.value': traitValue,\n    'data.ancestralTrait.linkedId': traitId,\n    'data.ancestralModifiers.positive': item.data.ancestralModifiers.positive?.value?.split(',')?.map(v => v.trim()) ?? item.data.ancestralModifiers.positive,\n    'data.ancestralModifiers.negative': item.data.ancestralModifiers.negative?.value?.split(',')?.map(v => v.trim()) ?? item.data.ancestralModifiers.negative\n  }\n}\n\nconst migrateProfession = async function (item) {\n  const actor = item.actor;\n  if (item.pack) {\n    debugger;\n  }\n  item = item.toObject();\n  let bonusAdvances = item.data.bonusAdvances?.arrayOfValues?.map(ba => ({ value: ba.name.trim(), purchased: ba.purchased }))\n    ?? item.data.bonusAdvances?.value?.split(',')?.map(v => ({ value: v.trim(), purchased: false }))\n    ?? item.data.bonusAdvances;\n  let talents = item.data.talents?.arrayOfValues?.map(t => ({ value: t.name.trim(), linkedId: null, purchased: t.purchased }))\n    ?? item.data.talents?.value?.split(',')?.map(v => ({ value: v.trim(), linkedId: null, purchased: false }))\n    ?? item.data.talents.map(t => ({ value: t.value.trim(), linkedId: t.linkedId ?? null, purchased: t.purchased }));\n  const actorTier = actor?.data?.data?.tier;\n  const profTier = item.data.tier?.value;\n  const purchaseAll = actorTier && actorTier !== profTier;\n  let skillRanks = item.data.skillRanks?.arrayOfValues?.map(sr => ({ value: sr.name.trim(), purchased: purchaseAll || sr.timesAvailable === 0 }))\n    ?? item.data.skillRanks?.value?.split(',')?.map(v => ({ value: v.trim(), purchased: false }))\n    ?? item.data.skillRanks;\n  let professionalTraitValue = item.data.professionalTrait.value;\n  let professionalTraitId = item.data.professionalTrait.linkedId ?? null;\n  let specialTraitValue = item.data.specialTrait.value;\n  let specialTraitId = item.data.specialTrait.linkedId ?? null;\n  let drawbackValue = item.data.drawback.value;\n  let drawbackId = item.data.drawback.linkedId ?? null;\n  if (actor) {\n    let i;\n    if (professionalTraitValue && !professionalTraitId) {\n      i = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, professionalTraitValue, 'trait', item.name, 'profession');\n      professionalTraitValue = i.value;\n      professionalTraitId = i.linkedId;\n    }\n    if (specialTraitValue && !specialTraitId) {\n      i = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, specialTraitValue, 'trait', item.name, 'profession');\n      specialTraitValue = i.value;\n      specialTraitId = i.linkedId;\n    }\n    if (drawbackValue && !drawbackId) {\n      i = await ZweihanderBaseItem.getOrCreateLinkedItem(actor, drawbackValue, 'drawback', item.name, 'profession');\n      drawbackValue = i.value;\n      drawbackId = i.linkedId;\n    }\n    // const talentNames = talents.map(t => t.value);\n    const talentNames = talents.filter(t => !t.linkedId && t.value).map(t => t.value);\n    if (talentNames.length) {\n      i = await ZweihanderBaseItem.getOrCreateLinkedItems(actor, talentNames, 'talent', item.name, 'profession');\n      talents = i.map((t, j) => ({ ...t, purchased: talents[j].purchased || false }));\n    }\n  }\n  return {\n    'data.bonusAdvances': bonusAdvances,\n    'data.professionalTrait.value': professionalTraitValue,\n    'data.professionalTrait.linkedId': professionalTraitId,\n    'data.specialTrait.value': specialTraitValue,\n    'data.specialTrait.linkedId': specialTraitId,\n    'data.drawback.value': drawbackValue,\n    'data.drawback.linkedId': drawbackId,\n    'data.skillRanks': skillRanks,\n    'data.talents': talents,\n    'data.tier.-=completed': null,\n    'data.tier.-=advancesPurchased': null,\n    'data.tier.value': item?.flags?.zweihander?.professionTier ?? item.data.tier.value,\n    'flags.zweihander.-=professionTier': null\n  }\n}\n\nexport const migrateWorldSafe = async function () {\n  if (!game.user.isGM) return;\n  const currentVersion = game.settings.get(\"zweihander\", \"systemMigrationVersion\");\n  const NEEDS_MIGRATION_VERSION = \"0.3.30\";\n  const COMPATIBLE_MIGRATION_VERSION = \"0.3.30\";\n  const totalDocuments = game.actors.size + game.scenes.size + game.items.size;\n  if (!currentVersion && totalDocuments === 0) return game.settings.set(\"zweihander\", \"systemMigrationVersion\", game.system.data.version);\n  const needsMigration = !currentVersion || isNewerVersion(NEEDS_MIGRATION_VERSION, currentVersion);\n  if (!needsMigration) return;\n\n  // Perform the migration\n  if (currentVersion && isNewerVersion(COMPATIBLE_MIGRATION_VERSION, currentVersion)) {\n    const warning = \"Your Zweihander system data is from too old a Foundry version and cannot be reliably migrated to the latest version. The process will be attempted, but errors may occur.\";\n    ui.notifications.error(warning, { permanent: true });\n  }\n  await migrateWorld();\n}","/*!\n * Intro.js v4.3.0\n * https://introjs.com\n *\n * Copyright (C) 2012-2021 Afshin Mehrabani (@afshinmeh).\n * https://raw.githubusercontent.com/usablica/intro.js/master/license.md\n *\n * Date: Sat, 06 Nov 2021 14:22:05 GMT\n */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.introJs = factory());\n})(this, (function () { 'use strict';\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  /**\n   * Overwrites obj1's values with obj2's and adds obj2's if non existent in obj1\n   * via: http://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically\n   *\n   * @param obj1\n   * @param obj2\n   * @returns obj3 a new object based on obj1 and obj2\n   */\n  function mergeOptions(obj1, obj2) {\n    var obj3 = {};\n    var attrname;\n\n    for (attrname in obj1) {\n      obj3[attrname] = obj1[attrname];\n    }\n\n    for (attrname in obj2) {\n      obj3[attrname] = obj2[attrname];\n    }\n\n    return obj3;\n  }\n\n  /**\n   * Mark any object with an incrementing number\n   * used for keeping track of objects\n   *\n   * @param Object obj   Any object or DOM Element\n   * @param String key\n   * @return Object\n   */\n  var stamp = function () {\n    var keys = {};\n    return function stamp(obj) {\n      var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"introjs-stamp\";\n      // each group increments from 0\n      keys[key] = keys[key] || 0; // stamp only once per object\n\n      if (obj[key] === undefined) {\n        // increment key for each new object\n        obj[key] = keys[key]++;\n      }\n\n      return obj[key];\n    };\n  }();\n\n  /**\n   * Iterates arrays\n   *\n   * @param {Array} arr\n   * @param {Function} forEachFnc\n   * @param {Function} [completeFnc]\n   * @return {Null}\n   */\n  function forEach(arr, forEachFnc, completeFnc) {\n    // in case arr is an empty query selector node list\n    if (arr) {\n      for (var i = 0, len = arr.length; i < len; i++) {\n        forEachFnc(arr[i], i);\n      }\n    }\n\n    if (typeof completeFnc === \"function\") {\n      completeFnc();\n    }\n  }\n\n  /**\n   * DOMEvent Handles all DOM events\n   *\n   * methods:\n   *\n   * on - add event handler\n   * off - remove event\n   */\n\n  var DOMEvent = function () {\n    function DOMEvent() {\n      var events_key = \"introjs_event\";\n      /**\n       * Gets a unique ID for an event listener\n       *\n       * @param obj Object\n       * @param type event type\n       * @param listener Function\n       * @param context Object\n       * @return String\n       */\n\n      this._id = function (obj, type, listener, context) {\n        return type + stamp(listener) + (context ? \"_\".concat(stamp(context)) : \"\");\n      };\n      /**\n       * Adds event listener\n       *\n       * @param obj Object obj\n       * @param type String\n       * @param listener Function\n       * @param context Object\n       * @param useCapture Boolean\n       * @return null\n       */\n\n\n      this.on = function (obj, type, listener, context, useCapture) {\n        var id = this._id.apply(this, arguments);\n\n        var handler = function handler(e) {\n          return listener.call(context || obj, e || window.event);\n        };\n\n        if (\"addEventListener\" in obj) {\n          obj.addEventListener(type, handler, useCapture);\n        } else if (\"attachEvent\" in obj) {\n          obj.attachEvent(\"on\".concat(type), handler);\n        }\n\n        obj[events_key] = obj[events_key] || {};\n        obj[events_key][id] = handler;\n      };\n      /**\n       * Removes event listener\n       *\n       * @param obj Object\n       * @param type String\n       * @param listener Function\n       * @param context Object\n       * @param useCapture Boolean\n       * @return null\n       */\n\n\n      this.off = function (obj, type, listener, context, useCapture) {\n        var id = this._id.apply(this, arguments);\n\n        var handler = obj[events_key] && obj[events_key][id];\n\n        if (!handler) {\n          return;\n        }\n\n        if (\"removeEventListener\" in obj) {\n          obj.removeEventListener(type, handler, useCapture);\n        } else if (\"detachEvent\" in obj) {\n          obj.detachEvent(\"on\".concat(type), handler);\n        }\n\n        obj[events_key][id] = null;\n      };\n    }\n\n    return new DOMEvent();\n  }();\n\n  var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n  function createCommonjsModule(fn, module) {\n  \treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n  }\n\n  var check = function (it) {\n    return it && it.Math == Math && it;\n  };\n\n  // https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\n  var global_1 =\n    // eslint-disable-next-line es/no-global-this -- safe\n    check(typeof globalThis == 'object' && globalThis) ||\n    check(typeof window == 'object' && window) ||\n    // eslint-disable-next-line no-restricted-globals -- safe\n    check(typeof self == 'object' && self) ||\n    check(typeof commonjsGlobal == 'object' && commonjsGlobal) ||\n    // eslint-disable-next-line no-new-func -- fallback\n    (function () { return this; })() || Function('return this')();\n\n  var fails = function (exec) {\n    try {\n      return !!exec();\n    } catch (error) {\n      return true;\n    }\n  };\n\n  // Detect IE8's incomplete defineProperty implementation\n  var descriptors = !fails(function () {\n    // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n    return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n  });\n\n  var call$2 = Function.prototype.call;\n\n  var functionCall = call$2.bind ? call$2.bind(call$2) : function () {\n    return call$2.apply(call$2, arguments);\n  };\n\n  var $propertyIsEnumerable = {}.propertyIsEnumerable;\n  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\n  var getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;\n\n  // Nashorn ~ JDK8 bug\n  var NASHORN_BUG = getOwnPropertyDescriptor$1 && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n  // `Object.prototype.propertyIsEnumerable` method implementation\n  // https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\n  var f$4 = NASHORN_BUG ? function propertyIsEnumerable(V) {\n    var descriptor = getOwnPropertyDescriptor$1(this, V);\n    return !!descriptor && descriptor.enumerable;\n  } : $propertyIsEnumerable;\n\n  var objectPropertyIsEnumerable = {\n  \tf: f$4\n  };\n\n  var createPropertyDescriptor = function (bitmap, value) {\n    return {\n      enumerable: !(bitmap & 1),\n      configurable: !(bitmap & 2),\n      writable: !(bitmap & 4),\n      value: value\n    };\n  };\n\n  var FunctionPrototype$2 = Function.prototype;\n  var bind$2 = FunctionPrototype$2.bind;\n  var call$1 = FunctionPrototype$2.call;\n  var callBind = bind$2 && bind$2.bind(call$1);\n\n  var functionUncurryThis = bind$2 ? function (fn) {\n    return fn && callBind(call$1, fn);\n  } : function (fn) {\n    return fn && function () {\n      return call$1.apply(fn, arguments);\n    };\n  };\n\n  var toString$1 = functionUncurryThis({}.toString);\n  var stringSlice$5 = functionUncurryThis(''.slice);\n\n  var classofRaw = function (it) {\n    return stringSlice$5(toString$1(it), 8, -1);\n  };\n\n  var Object$4 = global_1.Object;\n  var split = functionUncurryThis(''.split);\n\n  // fallback for non-array-like ES3 and non-enumerable old V8 strings\n  var indexedObject = fails(function () {\n    // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n    // eslint-disable-next-line no-prototype-builtins -- safe\n    return !Object$4('z').propertyIsEnumerable(0);\n  }) ? function (it) {\n    return classofRaw(it) == 'String' ? split(it, '') : Object$4(it);\n  } : Object$4;\n\n  var TypeError$c = global_1.TypeError;\n\n  // `RequireObjectCoercible` abstract operation\n  // https://tc39.es/ecma262/#sec-requireobjectcoercible\n  var requireObjectCoercible = function (it) {\n    if (it == undefined) throw TypeError$c(\"Can't call method on \" + it);\n    return it;\n  };\n\n  // toObject with fallback for non-array-like ES3 strings\n\n\n\n  var toIndexedObject = function (it) {\n    return indexedObject(requireObjectCoercible(it));\n  };\n\n  // `IsCallable` abstract operation\n  // https://tc39.es/ecma262/#sec-iscallable\n  var isCallable = function (argument) {\n    return typeof argument == 'function';\n  };\n\n  var isObject = function (it) {\n    return typeof it == 'object' ? it !== null : isCallable(it);\n  };\n\n  var aFunction = function (argument) {\n    return isCallable(argument) ? argument : undefined;\n  };\n\n  var getBuiltIn = function (namespace, method) {\n    return arguments.length < 2 ? aFunction(global_1[namespace]) : global_1[namespace] && global_1[namespace][method];\n  };\n\n  var objectIsPrototypeOf = functionUncurryThis({}.isPrototypeOf);\n\n  var engineUserAgent = getBuiltIn('navigator', 'userAgent') || '';\n\n  var process = global_1.process;\n  var Deno = global_1.Deno;\n  var versions = process && process.versions || Deno && Deno.version;\n  var v8 = versions && versions.v8;\n  var match, version$1;\n\n  if (v8) {\n    match = v8.split('.');\n    // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n    // but their correct versions are not interesting for us\n    version$1 = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n  }\n\n  // BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n  // so check `userAgent` even if `.v8` exists, but 0\n  if (!version$1 && engineUserAgent) {\n    match = engineUserAgent.match(/Edge\\/(\\d+)/);\n    if (!match || match[1] >= 74) {\n      match = engineUserAgent.match(/Chrome\\/(\\d+)/);\n      if (match) version$1 = +match[1];\n    }\n  }\n\n  var engineV8Version = version$1;\n\n  /* eslint-disable es/no-symbol -- required for testing */\n\n\n\n  // eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\n  var nativeSymbol = !!Object.getOwnPropertySymbols && !fails(function () {\n    var symbol = Symbol();\n    // Chrome 38 Symbol has incorrect toString conversion\n    // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n    return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n      // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n      !Symbol.sham && engineV8Version && engineV8Version < 41;\n  });\n\n  /* eslint-disable es/no-symbol -- required for testing */\n\n\n  var useSymbolAsUid = nativeSymbol\n    && !Symbol.sham\n    && typeof Symbol.iterator == 'symbol';\n\n  var Object$3 = global_1.Object;\n\n  var isSymbol = useSymbolAsUid ? function (it) {\n    return typeof it == 'symbol';\n  } : function (it) {\n    var $Symbol = getBuiltIn('Symbol');\n    return isCallable($Symbol) && objectIsPrototypeOf($Symbol.prototype, Object$3(it));\n  };\n\n  var String$3 = global_1.String;\n\n  var tryToString = function (argument) {\n    try {\n      return String$3(argument);\n    } catch (error) {\n      return 'Object';\n    }\n  };\n\n  var TypeError$b = global_1.TypeError;\n\n  // `Assert: IsCallable(argument) is true`\n  var aCallable = function (argument) {\n    if (isCallable(argument)) return argument;\n    throw TypeError$b(tryToString(argument) + ' is not a function');\n  };\n\n  // `GetMethod` abstract operation\n  // https://tc39.es/ecma262/#sec-getmethod\n  var getMethod = function (V, P) {\n    var func = V[P];\n    return func == null ? undefined : aCallable(func);\n  };\n\n  var TypeError$a = global_1.TypeError;\n\n  // `OrdinaryToPrimitive` abstract operation\n  // https://tc39.es/ecma262/#sec-ordinarytoprimitive\n  var ordinaryToPrimitive = function (input, pref) {\n    var fn, val;\n    if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = functionCall(fn, input))) return val;\n    if (isCallable(fn = input.valueOf) && !isObject(val = functionCall(fn, input))) return val;\n    if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = functionCall(fn, input))) return val;\n    throw TypeError$a(\"Can't convert object to primitive value\");\n  };\n\n  // eslint-disable-next-line es/no-object-defineproperty -- safe\n  var defineProperty$1 = Object.defineProperty;\n\n  var setGlobal = function (key, value) {\n    try {\n      defineProperty$1(global_1, key, { value: value, configurable: true, writable: true });\n    } catch (error) {\n      global_1[key] = value;\n    } return value;\n  };\n\n  var SHARED = '__core-js_shared__';\n  var store$1 = global_1[SHARED] || setGlobal(SHARED, {});\n\n  var sharedStore = store$1;\n\n  var shared = createCommonjsModule(function (module) {\n  (module.exports = function (key, value) {\n    return sharedStore[key] || (sharedStore[key] = value !== undefined ? value : {});\n  })('versions', []).push({\n    version: '3.19.1',\n    mode: 'global',\n    copyright: ' 2021 Denis Pushkarev (zloirock.ru)'\n  });\n  });\n\n  var Object$2 = global_1.Object;\n\n  // `ToObject` abstract operation\n  // https://tc39.es/ecma262/#sec-toobject\n  var toObject = function (argument) {\n    return Object$2(requireObjectCoercible(argument));\n  };\n\n  var hasOwnProperty = functionUncurryThis({}.hasOwnProperty);\n\n  // `HasOwnProperty` abstract operation\n  // https://tc39.es/ecma262/#sec-hasownproperty\n  var hasOwnProperty_1 = Object.hasOwn || function hasOwn(it, key) {\n    return hasOwnProperty(toObject(it), key);\n  };\n\n  var id = 0;\n  var postfix = Math.random();\n  var toString = functionUncurryThis(1.0.toString);\n\n  var uid = function (key) {\n    return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n  };\n\n  var WellKnownSymbolsStore = shared('wks');\n  var Symbol$1 = global_1.Symbol;\n  var symbolFor = Symbol$1 && Symbol$1['for'];\n  var createWellKnownSymbol = useSymbolAsUid ? Symbol$1 : Symbol$1 && Symbol$1.withoutSetter || uid;\n\n  var wellKnownSymbol = function (name) {\n    if (!hasOwnProperty_1(WellKnownSymbolsStore, name) || !(nativeSymbol || typeof WellKnownSymbolsStore[name] == 'string')) {\n      var description = 'Symbol.' + name;\n      if (nativeSymbol && hasOwnProperty_1(Symbol$1, name)) {\n        WellKnownSymbolsStore[name] = Symbol$1[name];\n      } else if (useSymbolAsUid && symbolFor) {\n        WellKnownSymbolsStore[name] = symbolFor(description);\n      } else {\n        WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n      }\n    } return WellKnownSymbolsStore[name];\n  };\n\n  var TypeError$9 = global_1.TypeError;\n  var TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n  // `ToPrimitive` abstract operation\n  // https://tc39.es/ecma262/#sec-toprimitive\n  var toPrimitive = function (input, pref) {\n    if (!isObject(input) || isSymbol(input)) return input;\n    var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n    var result;\n    if (exoticToPrim) {\n      if (pref === undefined) pref = 'default';\n      result = functionCall(exoticToPrim, input, pref);\n      if (!isObject(result) || isSymbol(result)) return result;\n      throw TypeError$9(\"Can't convert object to primitive value\");\n    }\n    if (pref === undefined) pref = 'number';\n    return ordinaryToPrimitive(input, pref);\n  };\n\n  // `ToPropertyKey` abstract operation\n  // https://tc39.es/ecma262/#sec-topropertykey\n  var toPropertyKey = function (argument) {\n    var key = toPrimitive(argument, 'string');\n    return isSymbol(key) ? key : key + '';\n  };\n\n  var document$1 = global_1.document;\n  // typeof document.createElement is 'object' in old IE\n  var EXISTS$1 = isObject(document$1) && isObject(document$1.createElement);\n\n  var documentCreateElement = function (it) {\n    return EXISTS$1 ? document$1.createElement(it) : {};\n  };\n\n  // Thank's IE8 for his funny defineProperty\n  var ie8DomDefine = !descriptors && !fails(function () {\n    // eslint-disable-next-line es/no-object-defineproperty -- requied for testing\n    return Object.defineProperty(documentCreateElement('div'), 'a', {\n      get: function () { return 7; }\n    }).a != 7;\n  });\n\n  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\n  var $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n  // `Object.getOwnPropertyDescriptor` method\n  // https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\n  var f$3 = descriptors ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n    O = toIndexedObject(O);\n    P = toPropertyKey(P);\n    if (ie8DomDefine) try {\n      return $getOwnPropertyDescriptor(O, P);\n    } catch (error) { /* empty */ }\n    if (hasOwnProperty_1(O, P)) return createPropertyDescriptor(!functionCall(objectPropertyIsEnumerable.f, O, P), O[P]);\n  };\n\n  var objectGetOwnPropertyDescriptor = {\n  \tf: f$3\n  };\n\n  var String$2 = global_1.String;\n  var TypeError$8 = global_1.TypeError;\n\n  // `Assert: Type(argument) is Object`\n  var anObject = function (argument) {\n    if (isObject(argument)) return argument;\n    throw TypeError$8(String$2(argument) + ' is not an object');\n  };\n\n  var TypeError$7 = global_1.TypeError;\n  // eslint-disable-next-line es/no-object-defineproperty -- safe\n  var $defineProperty = Object.defineProperty;\n\n  // `Object.defineProperty` method\n  // https://tc39.es/ecma262/#sec-object.defineproperty\n  var f$2 = descriptors ? $defineProperty : function defineProperty(O, P, Attributes) {\n    anObject(O);\n    P = toPropertyKey(P);\n    anObject(Attributes);\n    if (ie8DomDefine) try {\n      return $defineProperty(O, P, Attributes);\n    } catch (error) { /* empty */ }\n    if ('get' in Attributes || 'set' in Attributes) throw TypeError$7('Accessors not supported');\n    if ('value' in Attributes) O[P] = Attributes.value;\n    return O;\n  };\n\n  var objectDefineProperty = {\n  \tf: f$2\n  };\n\n  var createNonEnumerableProperty = descriptors ? function (object, key, value) {\n    return objectDefineProperty.f(object, key, createPropertyDescriptor(1, value));\n  } : function (object, key, value) {\n    object[key] = value;\n    return object;\n  };\n\n  var functionToString = functionUncurryThis(Function.toString);\n\n  // this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\n  if (!isCallable(sharedStore.inspectSource)) {\n    sharedStore.inspectSource = function (it) {\n      return functionToString(it);\n    };\n  }\n\n  var inspectSource = sharedStore.inspectSource;\n\n  var WeakMap$1 = global_1.WeakMap;\n\n  var nativeWeakMap = isCallable(WeakMap$1) && /native code/.test(inspectSource(WeakMap$1));\n\n  var keys = shared('keys');\n\n  var sharedKey = function (key) {\n    return keys[key] || (keys[key] = uid(key));\n  };\n\n  var hiddenKeys$1 = {};\n\n  var OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\n  var TypeError$6 = global_1.TypeError;\n  var WeakMap = global_1.WeakMap;\n  var set, get, has;\n\n  var enforce = function (it) {\n    return has(it) ? get(it) : set(it, {});\n  };\n\n  var getterFor = function (TYPE) {\n    return function (it) {\n      var state;\n      if (!isObject(it) || (state = get(it)).type !== TYPE) {\n        throw TypeError$6('Incompatible receiver, ' + TYPE + ' required');\n      } return state;\n    };\n  };\n\n  if (nativeWeakMap || sharedStore.state) {\n    var store = sharedStore.state || (sharedStore.state = new WeakMap());\n    var wmget = functionUncurryThis(store.get);\n    var wmhas = functionUncurryThis(store.has);\n    var wmset = functionUncurryThis(store.set);\n    set = function (it, metadata) {\n      if (wmhas(store, it)) throw new TypeError$6(OBJECT_ALREADY_INITIALIZED);\n      metadata.facade = it;\n      wmset(store, it, metadata);\n      return metadata;\n    };\n    get = function (it) {\n      return wmget(store, it) || {};\n    };\n    has = function (it) {\n      return wmhas(store, it);\n    };\n  } else {\n    var STATE = sharedKey('state');\n    hiddenKeys$1[STATE] = true;\n    set = function (it, metadata) {\n      if (hasOwnProperty_1(it, STATE)) throw new TypeError$6(OBJECT_ALREADY_INITIALIZED);\n      metadata.facade = it;\n      createNonEnumerableProperty(it, STATE, metadata);\n      return metadata;\n    };\n    get = function (it) {\n      return hasOwnProperty_1(it, STATE) ? it[STATE] : {};\n    };\n    has = function (it) {\n      return hasOwnProperty_1(it, STATE);\n    };\n  }\n\n  var internalState = {\n    set: set,\n    get: get,\n    has: has,\n    enforce: enforce,\n    getterFor: getterFor\n  };\n\n  var FunctionPrototype$1 = Function.prototype;\n  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\n  var getDescriptor = descriptors && Object.getOwnPropertyDescriptor;\n\n  var EXISTS = hasOwnProperty_1(FunctionPrototype$1, 'name');\n  // additional protection from minified / mangled / dropped function names\n  var PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\n  var CONFIGURABLE = EXISTS && (!descriptors || (descriptors && getDescriptor(FunctionPrototype$1, 'name').configurable));\n\n  var functionName = {\n    EXISTS: EXISTS,\n    PROPER: PROPER,\n    CONFIGURABLE: CONFIGURABLE\n  };\n\n  var redefine = createCommonjsModule(function (module) {\n  var CONFIGURABLE_FUNCTION_NAME = functionName.CONFIGURABLE;\n\n  var getInternalState = internalState.get;\n  var enforceInternalState = internalState.enforce;\n  var TEMPLATE = String(String).split('String');\n\n  (module.exports = function (O, key, value, options) {\n    var unsafe = options ? !!options.unsafe : false;\n    var simple = options ? !!options.enumerable : false;\n    var noTargetGet = options ? !!options.noTargetGet : false;\n    var name = options && options.name !== undefined ? options.name : key;\n    var state;\n    if (isCallable(value)) {\n      if (String(name).slice(0, 7) === 'Symbol(') {\n        name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n      }\n      if (!hasOwnProperty_1(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n        createNonEnumerableProperty(value, 'name', name);\n      }\n      state = enforceInternalState(value);\n      if (!state.source) {\n        state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n      }\n    }\n    if (O === global_1) {\n      if (simple) O[key] = value;\n      else setGlobal(key, value);\n      return;\n    } else if (!unsafe) {\n      delete O[key];\n    } else if (!noTargetGet && O[key]) {\n      simple = true;\n    }\n    if (simple) O[key] = value;\n    else createNonEnumerableProperty(O, key, value);\n  // add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n  })(Function.prototype, 'toString', function toString() {\n    return isCallable(this) && getInternalState(this).source || inspectSource(this);\n  });\n  });\n\n  var ceil = Math.ceil;\n  var floor$2 = Math.floor;\n\n  // `ToIntegerOrInfinity` abstract operation\n  // https://tc39.es/ecma262/#sec-tointegerorinfinity\n  var toIntegerOrInfinity = function (argument) {\n    var number = +argument;\n    // eslint-disable-next-line no-self-compare -- safe\n    return number !== number || number === 0 ? 0 : (number > 0 ? floor$2 : ceil)(number);\n  };\n\n  var max$3 = Math.max;\n  var min$4 = Math.min;\n\n  // Helper for a popular repeating case of the spec:\n  // Let integer be ? ToInteger(index).\n  // If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\n  var toAbsoluteIndex = function (index, length) {\n    var integer = toIntegerOrInfinity(index);\n    return integer < 0 ? max$3(integer + length, 0) : min$4(integer, length);\n  };\n\n  var min$3 = Math.min;\n\n  // `ToLength` abstract operation\n  // https://tc39.es/ecma262/#sec-tolength\n  var toLength = function (argument) {\n    return argument > 0 ? min$3(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n  };\n\n  // `LengthOfArrayLike` abstract operation\n  // https://tc39.es/ecma262/#sec-lengthofarraylike\n  var lengthOfArrayLike = function (obj) {\n    return toLength(obj.length);\n  };\n\n  // `Array.prototype.{ indexOf, includes }` methods implementation\n  var createMethod$2 = function (IS_INCLUDES) {\n    return function ($this, el, fromIndex) {\n      var O = toIndexedObject($this);\n      var length = lengthOfArrayLike(O);\n      var index = toAbsoluteIndex(fromIndex, length);\n      var value;\n      // Array#includes uses SameValueZero equality algorithm\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (IS_INCLUDES && el != el) while (length > index) {\n        value = O[index++];\n        // eslint-disable-next-line no-self-compare -- NaN check\n        if (value != value) return true;\n      // Array#indexOf ignores holes, Array#includes - not\n      } else for (;length > index; index++) {\n        if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n      } return !IS_INCLUDES && -1;\n    };\n  };\n\n  var arrayIncludes = {\n    // `Array.prototype.includes` method\n    // https://tc39.es/ecma262/#sec-array.prototype.includes\n    includes: createMethod$2(true),\n    // `Array.prototype.indexOf` method\n    // https://tc39.es/ecma262/#sec-array.prototype.indexof\n    indexOf: createMethod$2(false)\n  };\n\n  var indexOf$1 = arrayIncludes.indexOf;\n\n\n  var push$4 = functionUncurryThis([].push);\n\n  var objectKeysInternal = function (object, names) {\n    var O = toIndexedObject(object);\n    var i = 0;\n    var result = [];\n    var key;\n    for (key in O) !hasOwnProperty_1(hiddenKeys$1, key) && hasOwnProperty_1(O, key) && push$4(result, key);\n    // Don't enum bug & hidden keys\n    while (names.length > i) if (hasOwnProperty_1(O, key = names[i++])) {\n      ~indexOf$1(result, key) || push$4(result, key);\n    }\n    return result;\n  };\n\n  // IE8- don't enum bug keys\n  var enumBugKeys = [\n    'constructor',\n    'hasOwnProperty',\n    'isPrototypeOf',\n    'propertyIsEnumerable',\n    'toLocaleString',\n    'toString',\n    'valueOf'\n  ];\n\n  var hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n  // `Object.getOwnPropertyNames` method\n  // https://tc39.es/ecma262/#sec-object.getownpropertynames\n  // eslint-disable-next-line es/no-object-getownpropertynames -- safe\n  var f$1 = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n    return objectKeysInternal(O, hiddenKeys);\n  };\n\n  var objectGetOwnPropertyNames = {\n  \tf: f$1\n  };\n\n  // eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\n  var f = Object.getOwnPropertySymbols;\n\n  var objectGetOwnPropertySymbols = {\n  \tf: f\n  };\n\n  var concat$2 = functionUncurryThis([].concat);\n\n  // all object keys, includes non-enumerable and symbols\n  var ownKeys = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n    var keys = objectGetOwnPropertyNames.f(anObject(it));\n    var getOwnPropertySymbols = objectGetOwnPropertySymbols.f;\n    return getOwnPropertySymbols ? concat$2(keys, getOwnPropertySymbols(it)) : keys;\n  };\n\n  var copyConstructorProperties = function (target, source) {\n    var keys = ownKeys(source);\n    var defineProperty = objectDefineProperty.f;\n    var getOwnPropertyDescriptor = objectGetOwnPropertyDescriptor.f;\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      if (!hasOwnProperty_1(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  };\n\n  var replacement = /#|\\.prototype\\./;\n\n  var isForced = function (feature, detection) {\n    var value = data[normalize(feature)];\n    return value == POLYFILL ? true\n      : value == NATIVE ? false\n      : isCallable(detection) ? fails(detection)\n      : !!detection;\n  };\n\n  var normalize = isForced.normalize = function (string) {\n    return String(string).replace(replacement, '.').toLowerCase();\n  };\n\n  var data = isForced.data = {};\n  var NATIVE = isForced.NATIVE = 'N';\n  var POLYFILL = isForced.POLYFILL = 'P';\n\n  var isForced_1 = isForced;\n\n  var getOwnPropertyDescriptor = objectGetOwnPropertyDescriptor.f;\n\n\n\n\n\n\n  /*\n    options.target      - name of the target object\n    options.global      - target is the global object\n    options.stat        - export as static methods of target\n    options.proto       - export as prototype methods of target\n    options.real        - real prototype method for the `pure` version\n    options.forced      - export even if the native feature is available\n    options.bind        - bind methods to the target, required for the `pure` version\n    options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n    options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n    options.sham        - add a flag to not completely full polyfills\n    options.enumerable  - export as enumerable property\n    options.noTargetGet - prevent calling a getter on target\n    options.name        - the .name of the function if it does not match the key\n  */\n  var _export = function (options, source) {\n    var TARGET = options.target;\n    var GLOBAL = options.global;\n    var STATIC = options.stat;\n    var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n    if (GLOBAL) {\n      target = global_1;\n    } else if (STATIC) {\n      target = global_1[TARGET] || setGlobal(TARGET, {});\n    } else {\n      target = (global_1[TARGET] || {}).prototype;\n    }\n    if (target) for (key in source) {\n      sourceProperty = source[key];\n      if (options.noTargetGet) {\n        descriptor = getOwnPropertyDescriptor(target, key);\n        targetProperty = descriptor && descriptor.value;\n      } else targetProperty = target[key];\n      FORCED = isForced_1(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n      // contained in target\n      if (!FORCED && targetProperty !== undefined) {\n        if (typeof sourceProperty == typeof targetProperty) continue;\n        copyConstructorProperties(sourceProperty, targetProperty);\n      }\n      // add a flag to not completely full polyfills\n      if (options.sham || (targetProperty && targetProperty.sham)) {\n        createNonEnumerableProperty(sourceProperty, 'sham', true);\n      }\n      // extend global\n      redefine(target, key, sourceProperty, options);\n    }\n  };\n\n  var TO_STRING_TAG$1 = wellKnownSymbol('toStringTag');\n  var test$1 = {};\n\n  test$1[TO_STRING_TAG$1] = 'z';\n\n  var toStringTagSupport = String(test$1) === '[object z]';\n\n  var TO_STRING_TAG = wellKnownSymbol('toStringTag');\n  var Object$1 = global_1.Object;\n\n  // ES3 wrong here\n  var CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n  // fallback for IE11 Script Access Denied error\n  var tryGet = function (it, key) {\n    try {\n      return it[key];\n    } catch (error) { /* empty */ }\n  };\n\n  // getting tag from ES6+ `Object.prototype.toString`\n  var classof = toStringTagSupport ? classofRaw : function (it) {\n    var O, tag, result;\n    return it === undefined ? 'Undefined' : it === null ? 'Null'\n      // @@toStringTag case\n      : typeof (tag = tryGet(O = Object$1(it), TO_STRING_TAG)) == 'string' ? tag\n      // builtinTag case\n      : CORRECT_ARGUMENTS ? classofRaw(O)\n      // ES3 arguments fallback\n      : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n  };\n\n  var String$1 = global_1.String;\n\n  var toString_1 = function (argument) {\n    if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n    return String$1(argument);\n  };\n\n  // `RegExp.prototype.flags` getter implementation\n  // https://tc39.es/ecma262/#sec-get-regexp.prototype.flags\n  var regexpFlags = function () {\n    var that = anObject(this);\n    var result = '';\n    if (that.global) result += 'g';\n    if (that.ignoreCase) result += 'i';\n    if (that.multiline) result += 'm';\n    if (that.dotAll) result += 's';\n    if (that.unicode) result += 'u';\n    if (that.sticky) result += 'y';\n    return result;\n  };\n\n  // babel-minify and Closure Compiler transpiles RegExp('a', 'y') -> /a/y and it causes SyntaxError\n  var $RegExp$2 = global_1.RegExp;\n\n  var UNSUPPORTED_Y$2 = fails(function () {\n    var re = $RegExp$2('a', 'y');\n    re.lastIndex = 2;\n    return re.exec('abcd') != null;\n  });\n\n  var BROKEN_CARET = fails(function () {\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=773687\n    var re = $RegExp$2('^r', 'gy');\n    re.lastIndex = 2;\n    return re.exec('str') != null;\n  });\n\n  var regexpStickyHelpers = {\n  \tUNSUPPORTED_Y: UNSUPPORTED_Y$2,\n  \tBROKEN_CARET: BROKEN_CARET\n  };\n\n  // `Object.keys` method\n  // https://tc39.es/ecma262/#sec-object.keys\n  // eslint-disable-next-line es/no-object-keys -- safe\n  var objectKeys = Object.keys || function keys(O) {\n    return objectKeysInternal(O, enumBugKeys);\n  };\n\n  // `Object.defineProperties` method\n  // https://tc39.es/ecma262/#sec-object.defineproperties\n  // eslint-disable-next-line es/no-object-defineproperties -- safe\n  var objectDefineProperties = descriptors ? Object.defineProperties : function defineProperties(O, Properties) {\n    anObject(O);\n    var props = toIndexedObject(Properties);\n    var keys = objectKeys(Properties);\n    var length = keys.length;\n    var index = 0;\n    var key;\n    while (length > index) objectDefineProperty.f(O, key = keys[index++], props[key]);\n    return O;\n  };\n\n  var html = getBuiltIn('document', 'documentElement');\n\n  /* global ActiveXObject -- old IE, WSH */\n\n\n\n\n\n\n\n\n  var GT = '>';\n  var LT = '<';\n  var PROTOTYPE = 'prototype';\n  var SCRIPT = 'script';\n  var IE_PROTO = sharedKey('IE_PROTO');\n\n  var EmptyConstructor = function () { /* empty */ };\n\n  var scriptTag = function (content) {\n    return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n  };\n\n  // Create object with fake `null` prototype: use ActiveX Object with cleared prototype\n  var NullProtoObjectViaActiveX = function (activeXDocument) {\n    activeXDocument.write(scriptTag(''));\n    activeXDocument.close();\n    var temp = activeXDocument.parentWindow.Object;\n    activeXDocument = null; // avoid memory leak\n    return temp;\n  };\n\n  // Create object with fake `null` prototype: use iframe Object with cleared prototype\n  var NullProtoObjectViaIFrame = function () {\n    // Thrash, waste and sodomy: IE GC bug\n    var iframe = documentCreateElement('iframe');\n    var JS = 'java' + SCRIPT + ':';\n    var iframeDocument;\n    iframe.style.display = 'none';\n    html.appendChild(iframe);\n    // https://github.com/zloirock/core-js/issues/475\n    iframe.src = String(JS);\n    iframeDocument = iframe.contentWindow.document;\n    iframeDocument.open();\n    iframeDocument.write(scriptTag('document.F=Object'));\n    iframeDocument.close();\n    return iframeDocument.F;\n  };\n\n  // Check for document.domain and active x support\n  // No need to use active x approach when document.domain is not set\n  // see https://github.com/es-shims/es5-shim/issues/150\n  // variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n  // avoid IE GC bug\n  var activeXDocument;\n  var NullProtoObject = function () {\n    try {\n      activeXDocument = new ActiveXObject('htmlfile');\n    } catch (error) { /* ignore */ }\n    NullProtoObject = typeof document != 'undefined'\n      ? document.domain && activeXDocument\n        ? NullProtoObjectViaActiveX(activeXDocument) // old IE\n        : NullProtoObjectViaIFrame()\n      : NullProtoObjectViaActiveX(activeXDocument); // WSH\n    var length = enumBugKeys.length;\n    while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n    return NullProtoObject();\n  };\n\n  hiddenKeys$1[IE_PROTO] = true;\n\n  // `Object.create` method\n  // https://tc39.es/ecma262/#sec-object.create\n  var objectCreate = Object.create || function create(O, Properties) {\n    var result;\n    if (O !== null) {\n      EmptyConstructor[PROTOTYPE] = anObject(O);\n      result = new EmptyConstructor();\n      EmptyConstructor[PROTOTYPE] = null;\n      // add \"__proto__\" for Object.getPrototypeOf polyfill\n      result[IE_PROTO] = O;\n    } else result = NullProtoObject();\n    return Properties === undefined ? result : objectDefineProperties(result, Properties);\n  };\n\n  // babel-minify and Closure Compiler transpiles RegExp('.', 's') -> /./s and it causes SyntaxError\n  var $RegExp$1 = global_1.RegExp;\n\n  var regexpUnsupportedDotAll = fails(function () {\n    var re = $RegExp$1('.', 's');\n    return !(re.dotAll && re.exec('\\n') && re.flags === 's');\n  });\n\n  // babel-minify and Closure Compiler transpiles RegExp('(?<a>b)', 'g') -> /(?<a>b)/g and it causes SyntaxError\n  var $RegExp = global_1.RegExp;\n\n  var regexpUnsupportedNcg = fails(function () {\n    var re = $RegExp('(?<a>b)', 'g');\n    return re.exec('b').groups.a !== 'b' ||\n      'b'.replace(re, '$<a>c') !== 'bc';\n  });\n\n  /* eslint-disable regexp/no-empty-capturing-group, regexp/no-empty-group, regexp/no-lazy-ends -- testing */\n  /* eslint-disable regexp/no-useless-quantifier -- testing */\n\n\n\n\n\n\n\n  var getInternalState = internalState.get;\n\n\n\n  var nativeReplace = shared('native-string-replace', String.prototype.replace);\n  var nativeExec = RegExp.prototype.exec;\n  var patchedExec = nativeExec;\n  var charAt$3 = functionUncurryThis(''.charAt);\n  var indexOf = functionUncurryThis(''.indexOf);\n  var replace$1 = functionUncurryThis(''.replace);\n  var stringSlice$4 = functionUncurryThis(''.slice);\n\n  var UPDATES_LAST_INDEX_WRONG = (function () {\n    var re1 = /a/;\n    var re2 = /b*/g;\n    functionCall(nativeExec, re1, 'a');\n    functionCall(nativeExec, re2, 'a');\n    return re1.lastIndex !== 0 || re2.lastIndex !== 0;\n  })();\n\n  var UNSUPPORTED_Y$1 = regexpStickyHelpers.UNSUPPORTED_Y || regexpStickyHelpers.BROKEN_CARET;\n\n  // nonparticipating capturing group, copied from es5-shim's String#split patch.\n  var NPCG_INCLUDED = /()??/.exec('')[1] !== undefined;\n\n  var PATCH = UPDATES_LAST_INDEX_WRONG || NPCG_INCLUDED || UNSUPPORTED_Y$1 || regexpUnsupportedDotAll || regexpUnsupportedNcg;\n\n  if (PATCH) {\n    // eslint-disable-next-line max-statements -- TODO\n    patchedExec = function exec(string) {\n      var re = this;\n      var state = getInternalState(re);\n      var str = toString_1(string);\n      var raw = state.raw;\n      var result, reCopy, lastIndex, match, i, object, group;\n\n      if (raw) {\n        raw.lastIndex = re.lastIndex;\n        result = functionCall(patchedExec, raw, str);\n        re.lastIndex = raw.lastIndex;\n        return result;\n      }\n\n      var groups = state.groups;\n      var sticky = UNSUPPORTED_Y$1 && re.sticky;\n      var flags = functionCall(regexpFlags, re);\n      var source = re.source;\n      var charsAdded = 0;\n      var strCopy = str;\n\n      if (sticky) {\n        flags = replace$1(flags, 'y', '');\n        if (indexOf(flags, 'g') === -1) {\n          flags += 'g';\n        }\n\n        strCopy = stringSlice$4(str, re.lastIndex);\n        // Support anchored sticky behavior.\n        if (re.lastIndex > 0 && (!re.multiline || re.multiline && charAt$3(str, re.lastIndex - 1) !== '\\n')) {\n          source = '(?: ' + source + ')';\n          strCopy = ' ' + strCopy;\n          charsAdded++;\n        }\n        // ^(? + rx + ) is needed, in combination with some str slicing, to\n        // simulate the 'y' flag.\n        reCopy = new RegExp('^(?:' + source + ')', flags);\n      }\n\n      if (NPCG_INCLUDED) {\n        reCopy = new RegExp('^' + source + '$(?!\\\\s)', flags);\n      }\n      if (UPDATES_LAST_INDEX_WRONG) lastIndex = re.lastIndex;\n\n      match = functionCall(nativeExec, sticky ? reCopy : re, strCopy);\n\n      if (sticky) {\n        if (match) {\n          match.input = stringSlice$4(match.input, charsAdded);\n          match[0] = stringSlice$4(match[0], charsAdded);\n          match.index = re.lastIndex;\n          re.lastIndex += match[0].length;\n        } else re.lastIndex = 0;\n      } else if (UPDATES_LAST_INDEX_WRONG && match) {\n        re.lastIndex = re.global ? match.index + match[0].length : lastIndex;\n      }\n      if (NPCG_INCLUDED && match && match.length > 1) {\n        // Fix browsers whose `exec` methods don't consistently return `undefined`\n        // for NPCG, like IE8. NOTE: This doesn' work for /(.?)?/\n        functionCall(nativeReplace, match[0], reCopy, function () {\n          for (i = 1; i < arguments.length - 2; i++) {\n            if (arguments[i] === undefined) match[i] = undefined;\n          }\n        });\n      }\n\n      if (match && groups) {\n        match.groups = object = objectCreate(null);\n        for (i = 0; i < groups.length; i++) {\n          group = groups[i];\n          object[group[0]] = match[group[1]];\n        }\n      }\n\n      return match;\n    };\n  }\n\n  var regexpExec = patchedExec;\n\n  // `RegExp.prototype.exec` method\n  // https://tc39.es/ecma262/#sec-regexp.prototype.exec\n  _export({ target: 'RegExp', proto: true, forced: /./.exec !== regexpExec }, {\n    exec: regexpExec\n  });\n\n  // TODO: Remove from `core-js@4` since it's moved to entry points\n\n\n\n\n\n\n\n\n  var SPECIES$4 = wellKnownSymbol('species');\n  var RegExpPrototype$1 = RegExp.prototype;\n\n  var fixRegexpWellKnownSymbolLogic = function (KEY, exec, FORCED, SHAM) {\n    var SYMBOL = wellKnownSymbol(KEY);\n\n    var DELEGATES_TO_SYMBOL = !fails(function () {\n      // String methods call symbol-named RegEp methods\n      var O = {};\n      O[SYMBOL] = function () { return 7; };\n      return ''[KEY](O) != 7;\n    });\n\n    var DELEGATES_TO_EXEC = DELEGATES_TO_SYMBOL && !fails(function () {\n      // Symbol-named RegExp methods call .exec\n      var execCalled = false;\n      var re = /a/;\n\n      if (KEY === 'split') {\n        // We can't use real regex here since it causes deoptimization\n        // and serious performance degradation in V8\n        // https://github.com/zloirock/core-js/issues/306\n        re = {};\n        // RegExp[@@split] doesn't call the regex's exec method, but first creates\n        // a new one. We need to return the patched regex when creating the new one.\n        re.constructor = {};\n        re.constructor[SPECIES$4] = function () { return re; };\n        re.flags = '';\n        re[SYMBOL] = /./[SYMBOL];\n      }\n\n      re.exec = function () { execCalled = true; return null; };\n\n      re[SYMBOL]('');\n      return !execCalled;\n    });\n\n    if (\n      !DELEGATES_TO_SYMBOL ||\n      !DELEGATES_TO_EXEC ||\n      FORCED\n    ) {\n      var uncurriedNativeRegExpMethod = functionUncurryThis(/./[SYMBOL]);\n      var methods = exec(SYMBOL, ''[KEY], function (nativeMethod, regexp, str, arg2, forceStringMethod) {\n        var uncurriedNativeMethod = functionUncurryThis(nativeMethod);\n        var $exec = regexp.exec;\n        if ($exec === regexpExec || $exec === RegExpPrototype$1.exec) {\n          if (DELEGATES_TO_SYMBOL && !forceStringMethod) {\n            // The native String method already delegates to @@method (this\n            // polyfilled function), leasing to infinite recursion.\n            // We avoid it by directly calling the native @@method method.\n            return { done: true, value: uncurriedNativeRegExpMethod(regexp, str, arg2) };\n          }\n          return { done: true, value: uncurriedNativeMethod(str, regexp, arg2) };\n        }\n        return { done: false };\n      });\n\n      redefine(String.prototype, KEY, methods[0]);\n      redefine(RegExpPrototype$1, SYMBOL, methods[1]);\n    }\n\n    if (SHAM) createNonEnumerableProperty(RegExpPrototype$1[SYMBOL], 'sham', true);\n  };\n\n  var charAt$2 = functionUncurryThis(''.charAt);\n  var charCodeAt = functionUncurryThis(''.charCodeAt);\n  var stringSlice$3 = functionUncurryThis(''.slice);\n\n  var createMethod$1 = function (CONVERT_TO_STRING) {\n    return function ($this, pos) {\n      var S = toString_1(requireObjectCoercible($this));\n      var position = toIntegerOrInfinity(pos);\n      var size = S.length;\n      var first, second;\n      if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;\n      first = charCodeAt(S, position);\n      return first < 0xD800 || first > 0xDBFF || position + 1 === size\n        || (second = charCodeAt(S, position + 1)) < 0xDC00 || second > 0xDFFF\n          ? CONVERT_TO_STRING\n            ? charAt$2(S, position)\n            : first\n          : CONVERT_TO_STRING\n            ? stringSlice$3(S, position, position + 2)\n            : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;\n    };\n  };\n\n  var stringMultibyte = {\n    // `String.prototype.codePointAt` method\n    // https://tc39.es/ecma262/#sec-string.prototype.codepointat\n    codeAt: createMethod$1(false),\n    // `String.prototype.at` method\n    // https://github.com/mathiasbynens/String.prototype.at\n    charAt: createMethod$1(true)\n  };\n\n  var charAt$1 = stringMultibyte.charAt;\n\n  // `AdvanceStringIndex` abstract operation\n  // https://tc39.es/ecma262/#sec-advancestringindex\n  var advanceStringIndex = function (S, index, unicode) {\n    return index + (unicode ? charAt$1(S, index).length : 1);\n  };\n\n  var TypeError$5 = global_1.TypeError;\n\n  // `RegExpExec` abstract operation\n  // https://tc39.es/ecma262/#sec-regexpexec\n  var regexpExecAbstract = function (R, S) {\n    var exec = R.exec;\n    if (isCallable(exec)) {\n      var result = functionCall(exec, R, S);\n      if (result !== null) anObject(result);\n      return result;\n    }\n    if (classofRaw(R) === 'RegExp') return functionCall(regexpExec, R, S);\n    throw TypeError$5('RegExp#exec called on incompatible receiver');\n  };\n\n  // @@match logic\n  fixRegexpWellKnownSymbolLogic('match', function (MATCH, nativeMatch, maybeCallNative) {\n    return [\n      // `String.prototype.match` method\n      // https://tc39.es/ecma262/#sec-string.prototype.match\n      function match(regexp) {\n        var O = requireObjectCoercible(this);\n        var matcher = regexp == undefined ? undefined : getMethod(regexp, MATCH);\n        return matcher ? functionCall(matcher, regexp, O) : new RegExp(regexp)[MATCH](toString_1(O));\n      },\n      // `RegExp.prototype[@@match]` method\n      // https://tc39.es/ecma262/#sec-regexp.prototype-@@match\n      function (string) {\n        var rx = anObject(this);\n        var S = toString_1(string);\n        var res = maybeCallNative(nativeMatch, rx, S);\n\n        if (res.done) return res.value;\n\n        if (!rx.global) return regexpExecAbstract(rx, S);\n\n        var fullUnicode = rx.unicode;\n        rx.lastIndex = 0;\n        var A = [];\n        var n = 0;\n        var result;\n        while ((result = regexpExecAbstract(rx, S)) !== null) {\n          var matchStr = toString_1(result[0]);\n          A[n] = matchStr;\n          if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n          n++;\n        }\n        return n === 0 ? null : A;\n      }\n    ];\n  });\n\n  // `IsArray` abstract operation\n  // https://tc39.es/ecma262/#sec-isarray\n  // eslint-disable-next-line es/no-array-isarray -- safe\n  var isArray = Array.isArray || function isArray(argument) {\n    return classofRaw(argument) == 'Array';\n  };\n\n  var createProperty = function (object, key, value) {\n    var propertyKey = toPropertyKey(key);\n    if (propertyKey in object) objectDefineProperty.f(object, propertyKey, createPropertyDescriptor(0, value));\n    else object[propertyKey] = value;\n  };\n\n  var noop = function () { /* empty */ };\n  var empty = [];\n  var construct = getBuiltIn('Reflect', 'construct');\n  var constructorRegExp = /^\\s*(?:class|function)\\b/;\n  var exec$1 = functionUncurryThis(constructorRegExp.exec);\n  var INCORRECT_TO_STRING = !constructorRegExp.exec(noop);\n\n  var isConstructorModern = function (argument) {\n    if (!isCallable(argument)) return false;\n    try {\n      construct(noop, empty, argument);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  };\n\n  var isConstructorLegacy = function (argument) {\n    if (!isCallable(argument)) return false;\n    switch (classof(argument)) {\n      case 'AsyncFunction':\n      case 'GeneratorFunction':\n      case 'AsyncGeneratorFunction': return false;\n      // we can't check .prototype since constructors produced by .bind haven't it\n    } return INCORRECT_TO_STRING || !!exec$1(constructorRegExp, inspectSource(argument));\n  };\n\n  // `IsConstructor` abstract operation\n  // https://tc39.es/ecma262/#sec-isconstructor\n  var isConstructor = !construct || fails(function () {\n    var called;\n    return isConstructorModern(isConstructorModern.call)\n      || !isConstructorModern(Object)\n      || !isConstructorModern(function () { called = true; })\n      || called;\n  }) ? isConstructorLegacy : isConstructorModern;\n\n  var SPECIES$3 = wellKnownSymbol('species');\n  var Array$2 = global_1.Array;\n\n  // a part of `ArraySpeciesCreate` abstract operation\n  // https://tc39.es/ecma262/#sec-arrayspeciescreate\n  var arraySpeciesConstructor = function (originalArray) {\n    var C;\n    if (isArray(originalArray)) {\n      C = originalArray.constructor;\n      // cross-realm fallback\n      if (isConstructor(C) && (C === Array$2 || isArray(C.prototype))) C = undefined;\n      else if (isObject(C)) {\n        C = C[SPECIES$3];\n        if (C === null) C = undefined;\n      }\n    } return C === undefined ? Array$2 : C;\n  };\n\n  // `ArraySpeciesCreate` abstract operation\n  // https://tc39.es/ecma262/#sec-arrayspeciescreate\n  var arraySpeciesCreate = function (originalArray, length) {\n    return new (arraySpeciesConstructor(originalArray))(length === 0 ? 0 : length);\n  };\n\n  var SPECIES$2 = wellKnownSymbol('species');\n\n  var arrayMethodHasSpeciesSupport = function (METHOD_NAME) {\n    // We can't use this feature detection in V8 since it causes\n    // deoptimization and serious performance degradation\n    // https://github.com/zloirock/core-js/issues/677\n    return engineV8Version >= 51 || !fails(function () {\n      var array = [];\n      var constructor = array.constructor = {};\n      constructor[SPECIES$2] = function () {\n        return { foo: 1 };\n      };\n      return array[METHOD_NAME](Boolean).foo !== 1;\n    });\n  };\n\n  var IS_CONCAT_SPREADABLE = wellKnownSymbol('isConcatSpreadable');\n  var MAX_SAFE_INTEGER$1 = 0x1FFFFFFFFFFFFF;\n  var MAXIMUM_ALLOWED_INDEX_EXCEEDED = 'Maximum allowed index exceeded';\n  var TypeError$4 = global_1.TypeError;\n\n  // We can't use this feature detection in V8 since it causes\n  // deoptimization and serious performance degradation\n  // https://github.com/zloirock/core-js/issues/679\n  var IS_CONCAT_SPREADABLE_SUPPORT = engineV8Version >= 51 || !fails(function () {\n    var array = [];\n    array[IS_CONCAT_SPREADABLE] = false;\n    return array.concat()[0] !== array;\n  });\n\n  var SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('concat');\n\n  var isConcatSpreadable = function (O) {\n    if (!isObject(O)) return false;\n    var spreadable = O[IS_CONCAT_SPREADABLE];\n    return spreadable !== undefined ? !!spreadable : isArray(O);\n  };\n\n  var FORCED$1 = !IS_CONCAT_SPREADABLE_SUPPORT || !SPECIES_SUPPORT;\n\n  // `Array.prototype.concat` method\n  // https://tc39.es/ecma262/#sec-array.prototype.concat\n  // with adding support of @@isConcatSpreadable and @@species\n  _export({ target: 'Array', proto: true, forced: FORCED$1 }, {\n    // eslint-disable-next-line no-unused-vars -- required for `.length`\n    concat: function concat(arg) {\n      var O = toObject(this);\n      var A = arraySpeciesCreate(O, 0);\n      var n = 0;\n      var i, k, length, len, E;\n      for (i = -1, length = arguments.length; i < length; i++) {\n        E = i === -1 ? O : arguments[i];\n        if (isConcatSpreadable(E)) {\n          len = lengthOfArrayLike(E);\n          if (n + len > MAX_SAFE_INTEGER$1) throw TypeError$4(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n          for (k = 0; k < len; k++, n++) if (k in E) createProperty(A, n, E[k]);\n        } else {\n          if (n >= MAX_SAFE_INTEGER$1) throw TypeError$4(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n          createProperty(A, n++, E);\n        }\n      }\n      A.length = n;\n      return A;\n    }\n  });\n\n  // `Object.prototype.toString` method implementation\n  // https://tc39.es/ecma262/#sec-object.prototype.tostring\n  var objectToString = toStringTagSupport ? {}.toString : function toString() {\n    return '[object ' + classof(this) + ']';\n  };\n\n  // `Object.prototype.toString` method\n  // https://tc39.es/ecma262/#sec-object.prototype.tostring\n  if (!toStringTagSupport) {\n    redefine(Object.prototype, 'toString', objectToString, { unsafe: true });\n  }\n\n  var PROPER_FUNCTION_NAME = functionName.PROPER;\n\n\n\n\n\n\n\n  var TO_STRING = 'toString';\n  var RegExpPrototype = RegExp.prototype;\n  var n$ToString = RegExpPrototype[TO_STRING];\n  var getFlags = functionUncurryThis(regexpFlags);\n\n  var NOT_GENERIC = fails(function () { return n$ToString.call({ source: 'a', flags: 'b' }) != '/a/b'; });\n  // FF44- RegExp#toString has a wrong name\n  var INCORRECT_NAME = PROPER_FUNCTION_NAME && n$ToString.name != TO_STRING;\n\n  // `RegExp.prototype.toString` method\n  // https://tc39.es/ecma262/#sec-regexp.prototype.tostring\n  if (NOT_GENERIC || INCORRECT_NAME) {\n    redefine(RegExp.prototype, TO_STRING, function toString() {\n      var R = anObject(this);\n      var p = toString_1(R.source);\n      var rf = R.flags;\n      var f = toString_1(rf === undefined && objectIsPrototypeOf(RegExpPrototype, R) && !('flags' in RegExpPrototype) ? getFlags(R) : rf);\n      return '/' + p + '/' + f;\n    }, { unsafe: true });\n  }\n\n  var FunctionPrototype = Function.prototype;\n  var apply = FunctionPrototype.apply;\n  var bind$1 = FunctionPrototype.bind;\n  var call = FunctionPrototype.call;\n\n  // eslint-disable-next-line es/no-reflect -- safe\n  var functionApply = typeof Reflect == 'object' && Reflect.apply || (bind$1 ? call.bind(apply) : function () {\n    return call.apply(apply, arguments);\n  });\n\n  var MATCH$1 = wellKnownSymbol('match');\n\n  // `IsRegExp` abstract operation\n  // https://tc39.es/ecma262/#sec-isregexp\n  var isRegexp = function (it) {\n    var isRegExp;\n    return isObject(it) && ((isRegExp = it[MATCH$1]) !== undefined ? !!isRegExp : classofRaw(it) == 'RegExp');\n  };\n\n  var TypeError$3 = global_1.TypeError;\n\n  // `Assert: IsConstructor(argument) is true`\n  var aConstructor = function (argument) {\n    if (isConstructor(argument)) return argument;\n    throw TypeError$3(tryToString(argument) + ' is not a constructor');\n  };\n\n  var SPECIES$1 = wellKnownSymbol('species');\n\n  // `SpeciesConstructor` abstract operation\n  // https://tc39.es/ecma262/#sec-speciesconstructor\n  var speciesConstructor = function (O, defaultConstructor) {\n    var C = anObject(O).constructor;\n    var S;\n    return C === undefined || (S = anObject(C)[SPECIES$1]) == undefined ? defaultConstructor : aConstructor(S);\n  };\n\n  var arraySlice = functionUncurryThis([].slice);\n\n  var UNSUPPORTED_Y = regexpStickyHelpers.UNSUPPORTED_Y;\n  var MAX_UINT32 = 0xFFFFFFFF;\n  var min$2 = Math.min;\n  var $push = [].push;\n  var exec = functionUncurryThis(/./.exec);\n  var push$3 = functionUncurryThis($push);\n  var stringSlice$2 = functionUncurryThis(''.slice);\n\n  // Chrome 51 has a buggy \"split\" implementation when RegExp#exec !== nativeExec\n  // Weex JS has frozen built-in prototypes, so use try / catch wrapper\n  var SPLIT_WORKS_WITH_OVERWRITTEN_EXEC = !fails(function () {\n    // eslint-disable-next-line regexp/no-empty-group -- required for testing\n    var re = /(?:)/;\n    var originalExec = re.exec;\n    re.exec = function () { return originalExec.apply(this, arguments); };\n    var result = 'ab'.split(re);\n    return result.length !== 2 || result[0] !== 'a' || result[1] !== 'b';\n  });\n\n  // @@split logic\n  fixRegexpWellKnownSymbolLogic('split', function (SPLIT, nativeSplit, maybeCallNative) {\n    var internalSplit;\n    if (\n      'abbc'.split(/(b)*/)[1] == 'c' ||\n      // eslint-disable-next-line regexp/no-empty-group -- required for testing\n      'test'.split(/(?:)/, -1).length != 4 ||\n      'ab'.split(/(?:ab)*/).length != 2 ||\n      '.'.split(/(.?)(.?)/).length != 4 ||\n      // eslint-disable-next-line regexp/no-empty-capturing-group, regexp/no-empty-group -- required for testing\n      '.'.split(/()()/).length > 1 ||\n      ''.split(/.?/).length\n    ) {\n      // based on es5-shim implementation, need to rework it\n      internalSplit = function (separator, limit) {\n        var string = toString_1(requireObjectCoercible(this));\n        var lim = limit === undefined ? MAX_UINT32 : limit >>> 0;\n        if (lim === 0) return [];\n        if (separator === undefined) return [string];\n        // If `separator` is not a regex, use native split\n        if (!isRegexp(separator)) {\n          return functionCall(nativeSplit, string, separator, lim);\n        }\n        var output = [];\n        var flags = (separator.ignoreCase ? 'i' : '') +\n                    (separator.multiline ? 'm' : '') +\n                    (separator.unicode ? 'u' : '') +\n                    (separator.sticky ? 'y' : '');\n        var lastLastIndex = 0;\n        // Make `global` and avoid `lastIndex` issues by working with a copy\n        var separatorCopy = new RegExp(separator.source, flags + 'g');\n        var match, lastIndex, lastLength;\n        while (match = functionCall(regexpExec, separatorCopy, string)) {\n          lastIndex = separatorCopy.lastIndex;\n          if (lastIndex > lastLastIndex) {\n            push$3(output, stringSlice$2(string, lastLastIndex, match.index));\n            if (match.length > 1 && match.index < string.length) functionApply($push, output, arraySlice(match, 1));\n            lastLength = match[0].length;\n            lastLastIndex = lastIndex;\n            if (output.length >= lim) break;\n          }\n          if (separatorCopy.lastIndex === match.index) separatorCopy.lastIndex++; // Avoid an infinite loop\n        }\n        if (lastLastIndex === string.length) {\n          if (lastLength || !exec(separatorCopy, '')) push$3(output, '');\n        } else push$3(output, stringSlice$2(string, lastLastIndex));\n        return output.length > lim ? arraySlice(output, 0, lim) : output;\n      };\n    // Chakra, V8\n    } else if ('0'.split(undefined, 0).length) {\n      internalSplit = function (separator, limit) {\n        return separator === undefined && limit === 0 ? [] : functionCall(nativeSplit, this, separator, limit);\n      };\n    } else internalSplit = nativeSplit;\n\n    return [\n      // `String.prototype.split` method\n      // https://tc39.es/ecma262/#sec-string.prototype.split\n      function split(separator, limit) {\n        var O = requireObjectCoercible(this);\n        var splitter = separator == undefined ? undefined : getMethod(separator, SPLIT);\n        return splitter\n          ? functionCall(splitter, separator, O, limit)\n          : functionCall(internalSplit, toString_1(O), separator, limit);\n      },\n      // `RegExp.prototype[@@split]` method\n      // https://tc39.es/ecma262/#sec-regexp.prototype-@@split\n      //\n      // NOTE: This cannot be properly polyfilled in engines that don't support\n      // the 'y' flag.\n      function (string, limit) {\n        var rx = anObject(this);\n        var S = toString_1(string);\n        var res = maybeCallNative(internalSplit, rx, S, limit, internalSplit !== nativeSplit);\n\n        if (res.done) return res.value;\n\n        var C = speciesConstructor(rx, RegExp);\n\n        var unicodeMatching = rx.unicode;\n        var flags = (rx.ignoreCase ? 'i' : '') +\n                    (rx.multiline ? 'm' : '') +\n                    (rx.unicode ? 'u' : '') +\n                    (UNSUPPORTED_Y ? 'g' : 'y');\n\n        // ^(? + rx + ) is needed, in combination with some S slicing, to\n        // simulate the 'y' flag.\n        var splitter = new C(UNSUPPORTED_Y ? '^(?:' + rx.source + ')' : rx, flags);\n        var lim = limit === undefined ? MAX_UINT32 : limit >>> 0;\n        if (lim === 0) return [];\n        if (S.length === 0) return regexpExecAbstract(splitter, S) === null ? [S] : [];\n        var p = 0;\n        var q = 0;\n        var A = [];\n        while (q < S.length) {\n          splitter.lastIndex = UNSUPPORTED_Y ? 0 : q;\n          var z = regexpExecAbstract(splitter, UNSUPPORTED_Y ? stringSlice$2(S, q) : S);\n          var e;\n          if (\n            z === null ||\n            (e = min$2(toLength(splitter.lastIndex + (UNSUPPORTED_Y ? q : 0)), S.length)) === p\n          ) {\n            q = advanceStringIndex(S, q, unicodeMatching);\n          } else {\n            push$3(A, stringSlice$2(S, p, q));\n            if (A.length === lim) return A;\n            for (var i = 1; i <= z.length - 1; i++) {\n              push$3(A, z[i]);\n              if (A.length === lim) return A;\n            }\n            q = p = e;\n          }\n        }\n        push$3(A, stringSlice$2(S, p));\n        return A;\n      }\n    ];\n  }, !SPLIT_WORKS_WITH_OVERWRITTEN_EXEC, UNSUPPORTED_Y);\n\n  /**\n   * Append a class to an element\n   *\n   * @api private\n   * @method _addClass\n   * @param {Object} element\n   * @param {String} className\n   * @returns null\n   */\n\n  function addClass(element, className) {\n    if (element instanceof SVGElement) {\n      // svg\n      var pre = element.getAttribute(\"class\") || \"\";\n\n      if (!pre.match(className)) {\n        // check if element doesn't already have className\n        element.setAttribute(\"class\", \"\".concat(pre, \" \").concat(className));\n      }\n    } else {\n      if (element.classList !== undefined) {\n        // check for modern classList property\n        var classes = className.split(\" \");\n        forEach(classes, function (cls) {\n          element.classList.add(cls);\n        });\n      } else if (!element.className.match(className)) {\n        // check if element doesn't already have className\n        element.className += \" \".concat(className);\n      }\n    }\n  }\n\n  /**\n   * Get an element CSS property on the page\n   * Thanks to JavaScript Kit: http://www.javascriptkit.com/dhtmltutors/dhtmlcascade4.shtml\n   *\n   * @api private\n   * @method _getPropValue\n   * @param {Object} element\n   * @param {String} propName\n   * @returns string property value\n   */\n  function getPropValue(element, propName) {\n    var propValue = \"\";\n\n    if (element.currentStyle) {\n      //IE\n      propValue = element.currentStyle[propName];\n    } else if (document.defaultView && document.defaultView.getComputedStyle) {\n      //Others\n      propValue = document.defaultView.getComputedStyle(element, null).getPropertyValue(propName);\n    } //Prevent exception in IE\n\n\n    if (propValue && propValue.toLowerCase) {\n      return propValue.toLowerCase();\n    } else {\n      return propValue;\n    }\n  }\n\n  /**\n   * To set the show element\n   * This function set a relative (in most cases) position and changes the z-index\n   *\n   * @api private\n   * @method _setShowElement\n   * @param {Object} targetElement\n   */\n\n  function setShowElement(_ref) {\n    var element = _ref.element;\n    addClass(element, \"introjs-showElement\");\n    var currentElementPosition = getPropValue(element, \"position\");\n\n    if (currentElementPosition !== \"absolute\" && currentElementPosition !== \"relative\" && currentElementPosition !== \"sticky\" && currentElementPosition !== \"fixed\") {\n      //change to new intro item\n      addClass(element, \"introjs-relativePosition\");\n    }\n  }\n\n  /**\n   * Find the nearest scrollable parent\n   * copied from https://stackoverflow.com/questions/35939886/find-first-scrollable-parent\n   *\n   * @param Element element\n   * @return Element\n   */\n  function getScrollParent(element) {\n    var style = window.getComputedStyle(element);\n    var excludeStaticParent = style.position === \"absolute\";\n    var overflowRegex = /(auto|scroll)/;\n    if (style.position === \"fixed\") return document.body;\n\n    for (var parent = element; parent = parent.parentElement;) {\n      style = window.getComputedStyle(parent);\n\n      if (excludeStaticParent && style.position === \"static\") {\n        continue;\n      }\n\n      if (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) return parent;\n    }\n\n    return document.body;\n  }\n\n  /**\n   * scroll a scrollable element to a child element\n   *\n   * @param {Object} targetElement\n   */\n\n  function scrollParentToElement(targetElement) {\n    var element = targetElement.element;\n    if (!this._options.scrollToElement) return;\n    var parent = getScrollParent(element);\n    if (parent === document.body) return;\n    parent.scrollTop = element.offsetTop - parent.offsetTop;\n  }\n\n  /**\n   * Provides a cross-browser way to get the screen dimensions\n   * via: http://stackoverflow.com/questions/5864467/internet-explorer-innerheight\n   *\n   * @api private\n   * @method _getWinSize\n   * @returns {Object} width and height attributes\n   */\n  function getWinSize() {\n    if (window.innerWidth !== undefined) {\n      return {\n        width: window.innerWidth,\n        height: window.innerHeight\n      };\n    } else {\n      var D = document.documentElement;\n      return {\n        width: D.clientWidth,\n        height: D.clientHeight\n      };\n    }\n  }\n\n  /**\n   * Check to see if the element is in the viewport or not\n   * http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport\n   *\n   * @api private\n   * @method _elementInViewport\n   * @param {Object} el\n   */\n  function elementInViewport(el) {\n    var rect = el.getBoundingClientRect();\n    return rect.top >= 0 && rect.left >= 0 && rect.bottom + 80 <= window.innerHeight && // add 80 to get the text right\n    rect.right <= window.innerWidth;\n  }\n\n  /**\n   * To change the scroll of `window` after highlighting an element\n   *\n   * @api private\n   * @param {String} scrollTo\n   * @param {Object} targetElement\n   * @param {Object} tooltipLayer\n   */\n\n  function scrollTo(scrollTo, _ref, tooltipLayer) {\n    var element = _ref.element;\n    if (scrollTo === \"off\") return;\n    var rect;\n    if (!this._options.scrollToElement) return;\n\n    if (scrollTo === \"tooltip\") {\n      rect = tooltipLayer.getBoundingClientRect();\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n\n    if (!elementInViewport(element)) {\n      var winHeight = getWinSize().height;\n      var top = rect.bottom - (rect.bottom - rect.top); // TODO (afshinm): do we need scroll padding now?\n      // I have changed the scroll option and now it scrolls the window to\n      // the center of the target element or tooltip.\n\n      if (top < 0 || element.clientHeight > winHeight) {\n        window.scrollBy(0, rect.top - (winHeight / 2 - rect.height / 2) - this._options.scrollPadding); // 30px padding from edge to look nice\n        //Scroll down\n      } else {\n        window.scrollBy(0, rect.top - (winHeight / 2 - rect.height / 2) + this._options.scrollPadding); // 30px padding from edge to look nice\n      }\n    }\n  }\n\n  /**\n   * Setting anchors to behave like buttons\n   *\n   * @api private\n   * @method _setAnchorAsButton\n   */\n  function setAnchorAsButton(anchor) {\n    anchor.setAttribute(\"role\", \"button\");\n    anchor.tabIndex = 0;\n  }\n\n  // eslint-disable-next-line es/no-object-assign -- safe\n  var $assign = Object.assign;\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  var defineProperty = Object.defineProperty;\n  var concat$1 = functionUncurryThis([].concat);\n\n  // `Object.assign` method\n  // https://tc39.es/ecma262/#sec-object.assign\n  var objectAssign = !$assign || fails(function () {\n    // should have correct order of operations (Edge bug)\n    if (descriptors && $assign({ b: 1 }, $assign(defineProperty({}, 'a', {\n      enumerable: true,\n      get: function () {\n        defineProperty(this, 'b', {\n          value: 3,\n          enumerable: false\n        });\n      }\n    }), { b: 2 })).b !== 1) return true;\n    // should work with symbols and should have deterministic property order (V8 bug)\n    var A = {};\n    var B = {};\n    // eslint-disable-next-line es/no-symbol -- safe\n    var symbol = Symbol();\n    var alphabet = 'abcdefghijklmnopqrst';\n    A[symbol] = 7;\n    alphabet.split('').forEach(function (chr) { B[chr] = chr; });\n    return $assign({}, A)[symbol] != 7 || objectKeys($assign({}, B)).join('') != alphabet;\n  }) ? function assign(target, source) { // eslint-disable-line no-unused-vars -- required for `.length`\n    var T = toObject(target);\n    var argumentsLength = arguments.length;\n    var index = 1;\n    var getOwnPropertySymbols = objectGetOwnPropertySymbols.f;\n    var propertyIsEnumerable = objectPropertyIsEnumerable.f;\n    while (argumentsLength > index) {\n      var S = indexedObject(arguments[index++]);\n      var keys = getOwnPropertySymbols ? concat$1(objectKeys(S), getOwnPropertySymbols(S)) : objectKeys(S);\n      var length = keys.length;\n      var j = 0;\n      var key;\n      while (length > j) {\n        key = keys[j++];\n        if (!descriptors || functionCall(propertyIsEnumerable, S, key)) T[key] = S[key];\n      }\n    } return T;\n  } : $assign;\n\n  // `Object.assign` method\n  // https://tc39.es/ecma262/#sec-object.assign\n  // eslint-disable-next-line es/no-object-assign -- required for testing\n  _export({ target: 'Object', stat: true, forced: Object.assign !== objectAssign }, {\n    assign: objectAssign\n  });\n\n  /**\n   * Checks to see if target element (or parents) position is fixed or not\n   *\n   * @api private\n   * @method _isFixed\n   * @param {Object} element\n   * @returns Boolean\n   */\n\n  function isFixed(element) {\n    var p = element.parentNode;\n\n    if (!p || p.nodeName === \"HTML\") {\n      return false;\n    }\n\n    if (getPropValue(element, \"position\") === \"fixed\") {\n      return true;\n    }\n\n    return isFixed(p);\n  }\n\n  /**\n   * Get an element position on the page relative to another element (or body)\n   * Thanks to `meouw`: http://stackoverflow.com/a/442474/375966\n   *\n   * @api private\n   * @method getOffset\n   * @param {Object} element\n   * @param {Object} relativeEl\n   * @returns Element's position info\n   */\n\n  function getOffset(element, relativeEl) {\n    var body = document.body;\n    var docEl = document.documentElement;\n    var scrollTop = window.pageYOffset || docEl.scrollTop || body.scrollTop;\n    var scrollLeft = window.pageXOffset || docEl.scrollLeft || body.scrollLeft;\n    relativeEl = relativeEl || body;\n    var x = element.getBoundingClientRect();\n    var xr = relativeEl.getBoundingClientRect();\n    var relativeElPosition = getPropValue(relativeEl, \"position\");\n    var obj = {\n      width: x.width,\n      height: x.height\n    };\n\n    if (relativeEl.tagName.toLowerCase() !== \"body\" && relativeElPosition === \"relative\" || relativeElPosition === \"sticky\") {\n      // when the container of our target element is _not_ body and has either \"relative\" or \"sticky\" position, we should not\n      // consider the scroll position but we need to include the relative x/y of the container element\n      return Object.assign(obj, {\n        top: x.top - xr.top,\n        left: x.left - xr.left\n      });\n    } else {\n      if (isFixed(element)) {\n        return Object.assign(obj, {\n          top: x.top,\n          left: x.left\n        });\n      } else {\n        return Object.assign(obj, {\n          top: x.top + scrollTop,\n          left: x.left + scrollLeft\n        });\n      }\n    }\n  }\n\n  var floor$1 = Math.floor;\n  var charAt = functionUncurryThis(''.charAt);\n  var replace = functionUncurryThis(''.replace);\n  var stringSlice$1 = functionUncurryThis(''.slice);\n  var SUBSTITUTION_SYMBOLS = /\\$([$&'`]|\\d{1,2}|<[^>]*>)/g;\n  var SUBSTITUTION_SYMBOLS_NO_NAMED = /\\$([$&'`]|\\d{1,2})/g;\n\n  // `GetSubstitution` abstract operation\n  // https://tc39.es/ecma262/#sec-getsubstitution\n  var getSubstitution = function (matched, str, position, captures, namedCaptures, replacement) {\n    var tailPos = position + matched.length;\n    var m = captures.length;\n    var symbols = SUBSTITUTION_SYMBOLS_NO_NAMED;\n    if (namedCaptures !== undefined) {\n      namedCaptures = toObject(namedCaptures);\n      symbols = SUBSTITUTION_SYMBOLS;\n    }\n    return replace(replacement, symbols, function (match, ch) {\n      var capture;\n      switch (charAt(ch, 0)) {\n        case '$': return '$';\n        case '&': return matched;\n        case '`': return stringSlice$1(str, 0, position);\n        case \"'\": return stringSlice$1(str, tailPos);\n        case '<':\n          capture = namedCaptures[stringSlice$1(ch, 1, -1)];\n          break;\n        default: // \\d\\d?\n          var n = +ch;\n          if (n === 0) return match;\n          if (n > m) {\n            var f = floor$1(n / 10);\n            if (f === 0) return match;\n            if (f <= m) return captures[f - 1] === undefined ? charAt(ch, 1) : captures[f - 1] + charAt(ch, 1);\n            return match;\n          }\n          capture = captures[n - 1];\n      }\n      return capture === undefined ? '' : capture;\n    });\n  };\n\n  var REPLACE = wellKnownSymbol('replace');\n  var max$2 = Math.max;\n  var min$1 = Math.min;\n  var concat = functionUncurryThis([].concat);\n  var push$2 = functionUncurryThis([].push);\n  var stringIndexOf$1 = functionUncurryThis(''.indexOf);\n  var stringSlice = functionUncurryThis(''.slice);\n\n  var maybeToString = function (it) {\n    return it === undefined ? it : String(it);\n  };\n\n  // IE <= 11 replaces $0 with the whole match, as if it was $&\n  // https://stackoverflow.com/questions/6024666/getting-ie-to-replace-a-regex-with-the-literal-string-0\n  var REPLACE_KEEPS_$0 = (function () {\n    // eslint-disable-next-line regexp/prefer-escape-replacement-dollar-char -- required for testing\n    return 'a'.replace(/./, '$0') === '$0';\n  })();\n\n  // Safari <= 13.0.3(?) substitutes nth capture where n>m with an empty string\n  var REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE = (function () {\n    if (/./[REPLACE]) {\n      return /./[REPLACE]('a', '$0') === '';\n    }\n    return false;\n  })();\n\n  var REPLACE_SUPPORTS_NAMED_GROUPS = !fails(function () {\n    var re = /./;\n    re.exec = function () {\n      var result = [];\n      result.groups = { a: '7' };\n      return result;\n    };\n    // eslint-disable-next-line regexp/no-useless-dollar-replacements -- false positive\n    return ''.replace(re, '$<a>') !== '7';\n  });\n\n  // @@replace logic\n  fixRegexpWellKnownSymbolLogic('replace', function (_, nativeReplace, maybeCallNative) {\n    var UNSAFE_SUBSTITUTE = REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE ? '$' : '$0';\n\n    return [\n      // `String.prototype.replace` method\n      // https://tc39.es/ecma262/#sec-string.prototype.replace\n      function replace(searchValue, replaceValue) {\n        var O = requireObjectCoercible(this);\n        var replacer = searchValue == undefined ? undefined : getMethod(searchValue, REPLACE);\n        return replacer\n          ? functionCall(replacer, searchValue, O, replaceValue)\n          : functionCall(nativeReplace, toString_1(O), searchValue, replaceValue);\n      },\n      // `RegExp.prototype[@@replace]` method\n      // https://tc39.es/ecma262/#sec-regexp.prototype-@@replace\n      function (string, replaceValue) {\n        var rx = anObject(this);\n        var S = toString_1(string);\n\n        if (\n          typeof replaceValue == 'string' &&\n          stringIndexOf$1(replaceValue, UNSAFE_SUBSTITUTE) === -1 &&\n          stringIndexOf$1(replaceValue, '$<') === -1\n        ) {\n          var res = maybeCallNative(nativeReplace, rx, S, replaceValue);\n          if (res.done) return res.value;\n        }\n\n        var functionalReplace = isCallable(replaceValue);\n        if (!functionalReplace) replaceValue = toString_1(replaceValue);\n\n        var global = rx.global;\n        if (global) {\n          var fullUnicode = rx.unicode;\n          rx.lastIndex = 0;\n        }\n        var results = [];\n        while (true) {\n          var result = regexpExecAbstract(rx, S);\n          if (result === null) break;\n\n          push$2(results, result);\n          if (!global) break;\n\n          var matchStr = toString_1(result[0]);\n          if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n        }\n\n        var accumulatedResult = '';\n        var nextSourcePosition = 0;\n        for (var i = 0; i < results.length; i++) {\n          result = results[i];\n\n          var matched = toString_1(result[0]);\n          var position = max$2(min$1(toIntegerOrInfinity(result.index), S.length), 0);\n          var captures = [];\n          // NOTE: This is equivalent to\n          //   captures = result.slice(1).map(maybeToString)\n          // but for some reason `nativeSlice.call(result, 1, result.length)` (called in\n          // the slice polyfill when slicing native arrays) \"doesn't work\" in safari 9 and\n          // causes a crash (https://pastebin.com/N21QzeQA) when trying to debug it.\n          for (var j = 1; j < result.length; j++) push$2(captures, maybeToString(result[j]));\n          var namedCaptures = result.groups;\n          if (functionalReplace) {\n            var replacerArgs = concat([matched], captures, position, S);\n            if (namedCaptures !== undefined) push$2(replacerArgs, namedCaptures);\n            var replacement = toString_1(functionApply(replaceValue, undefined, replacerArgs));\n          } else {\n            replacement = getSubstitution(matched, S, position, captures, namedCaptures, replaceValue);\n          }\n          if (position >= nextSourcePosition) {\n            accumulatedResult += stringSlice(S, nextSourcePosition, position) + replacement;\n            nextSourcePosition = position + matched.length;\n          }\n        }\n        return accumulatedResult + stringSlice(S, nextSourcePosition);\n      }\n    ];\n  }, !REPLACE_SUPPORTS_NAMED_GROUPS || !REPLACE_KEEPS_$0 || REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);\n\n  /**\n   * Remove a class from an element\n   *\n   * @api private\n   * @method _removeClass\n   * @param {Object} element\n   * @param {RegExp|String} classNameRegex can be regex or string\n   * @returns null\n   */\n  function removeClass(element, classNameRegex) {\n    if (element instanceof SVGElement) {\n      var pre = element.getAttribute(\"class\") || \"\";\n      element.setAttribute(\"class\", pre.replace(classNameRegex, \"\").replace(/^\\s+|\\s+$/g, \"\"));\n    } else {\n      element.className = element.className.replace(classNameRegex, \"\").replace(/^\\s+|\\s+$/g, \"\");\n    }\n  }\n\n  /**\n   * Sets the style of an DOM element\n   *\n   * @param {Object} element\n   * @param {Object|string} style\n   * @return null\n   */\n  function setStyle(element, style) {\n    var cssText = \"\";\n\n    if (element.style.cssText) {\n      cssText += element.style.cssText;\n    }\n\n    if (typeof style === \"string\") {\n      cssText += style;\n    } else {\n      for (var rule in style) {\n        cssText += \"\".concat(rule, \":\").concat(style[rule], \";\");\n      }\n    }\n\n    element.style.cssText = cssText;\n  }\n\n  /**\n   * Update the position of the helper layer on the screen\n   *\n   * @api private\n   * @method _setHelperLayerPosition\n   * @param {Object} helperLayer\n   */\n\n  function setHelperLayerPosition(helperLayer) {\n    if (helperLayer) {\n      //prevent error when `this._currentStep` in undefined\n      if (!this._introItems[this._currentStep]) return;\n      var currentElement = this._introItems[this._currentStep];\n      var elementPosition = getOffset(currentElement.element, this._targetElement);\n      var widthHeightPadding = this._options.helperElementPadding; // If the target element is fixed, the tooltip should be fixed as well.\n      // Otherwise, remove a fixed class that may be left over from the previous\n      // step.\n\n      if (isFixed(currentElement.element)) {\n        addClass(helperLayer, \"introjs-fixedTooltip\");\n      } else {\n        removeClass(helperLayer, \"introjs-fixedTooltip\");\n      }\n\n      if (currentElement.position === \"floating\") {\n        widthHeightPadding = 0;\n      } //set new position to helper layer\n\n\n      setStyle(helperLayer, {\n        width: \"\".concat(elementPosition.width + widthHeightPadding, \"px\"),\n        height: \"\".concat(elementPosition.height + widthHeightPadding, \"px\"),\n        top: \"\".concat(elementPosition.top - widthHeightPadding / 2, \"px\"),\n        left: \"\".concat(elementPosition.left - widthHeightPadding / 2, \"px\")\n      });\n    }\n  }\n\n  var UNSCOPABLES = wellKnownSymbol('unscopables');\n  var ArrayPrototype = Array.prototype;\n\n  // Array.prototype[@@unscopables]\n  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\n  if (ArrayPrototype[UNSCOPABLES] == undefined) {\n    objectDefineProperty.f(ArrayPrototype, UNSCOPABLES, {\n      configurable: true,\n      value: objectCreate(null)\n    });\n  }\n\n  // add a key to Array.prototype[@@unscopables]\n  var addToUnscopables = function (key) {\n    ArrayPrototype[UNSCOPABLES][key] = true;\n  };\n\n  var $includes = arrayIncludes.includes;\n\n\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  _export({ target: 'Array', proto: true }, {\n    includes: function includes(el /* , fromIndex = 0 */) {\n      return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n    }\n  });\n\n  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\n  addToUnscopables('includes');\n\n  var HAS_SPECIES_SUPPORT$2 = arrayMethodHasSpeciesSupport('slice');\n\n  var SPECIES = wellKnownSymbol('species');\n  var Array$1 = global_1.Array;\n  var max$1 = Math.max;\n\n  // `Array.prototype.slice` method\n  // https://tc39.es/ecma262/#sec-array.prototype.slice\n  // fallback for not array-like ES3 strings and DOM objects\n  _export({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT$2 }, {\n    slice: function slice(start, end) {\n      var O = toIndexedObject(this);\n      var length = lengthOfArrayLike(O);\n      var k = toAbsoluteIndex(start, length);\n      var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n      // inline `ArraySpeciesCreate` for usage native `Array#slice` where it's possible\n      var Constructor, result, n;\n      if (isArray(O)) {\n        Constructor = O.constructor;\n        // cross-realm fallback\n        if (isConstructor(Constructor) && (Constructor === Array$1 || isArray(Constructor.prototype))) {\n          Constructor = undefined;\n        } else if (isObject(Constructor)) {\n          Constructor = Constructor[SPECIES];\n          if (Constructor === null) Constructor = undefined;\n        }\n        if (Constructor === Array$1 || Constructor === undefined) {\n          return arraySlice(O, k, fin);\n        }\n      }\n      result = new (Constructor === undefined ? Array$1 : Constructor)(max$1(fin - k, 0));\n      for (n = 0; k < fin; k++, n++) if (k in O) createProperty(result, n, O[k]);\n      result.length = n;\n      return result;\n    }\n  });\n\n  var TypeError$2 = global_1.TypeError;\n\n  var notARegexp = function (it) {\n    if (isRegexp(it)) {\n      throw TypeError$2(\"The method doesn't accept regular expressions\");\n    } return it;\n  };\n\n  var MATCH = wellKnownSymbol('match');\n\n  var correctIsRegexpLogic = function (METHOD_NAME) {\n    var regexp = /./;\n    try {\n      '/./'[METHOD_NAME](regexp);\n    } catch (error1) {\n      try {\n        regexp[MATCH] = false;\n        return '/./'[METHOD_NAME](regexp);\n      } catch (error2) { /* empty */ }\n    } return false;\n  };\n\n  var stringIndexOf = functionUncurryThis(''.indexOf);\n\n  // `String.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-string.prototype.includes\n  _export({ target: 'String', proto: true, forced: !correctIsRegexpLogic('includes') }, {\n    includes: function includes(searchString /* , position = 0 */) {\n      return !!~stringIndexOf(\n        toString_1(requireObjectCoercible(this)),\n        toString_1(notARegexp(searchString)),\n        arguments.length > 1 ? arguments[1] : undefined\n      );\n    }\n  });\n\n  var arrayMethodIsStrict = function (METHOD_NAME, argument) {\n    var method = [][METHOD_NAME];\n    return !!method && fails(function () {\n      // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n      method.call(null, argument || function () { throw 1; }, 1);\n    });\n  };\n\n  var un$Join = functionUncurryThis([].join);\n\n  var ES3_STRINGS = indexedObject != Object;\n  var STRICT_METHOD$1 = arrayMethodIsStrict('join', ',');\n\n  // `Array.prototype.join` method\n  // https://tc39.es/ecma262/#sec-array.prototype.join\n  _export({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD$1 }, {\n    join: function join(separator) {\n      return un$Join(toIndexedObject(this), separator === undefined ? ',' : separator);\n    }\n  });\n\n  var bind = functionUncurryThis(functionUncurryThis.bind);\n\n  // optional / simple context binding\n  var functionBindContext = function (fn, that) {\n    aCallable(fn);\n    return that === undefined ? fn : bind ? bind(fn, that) : function (/* ...args */) {\n      return fn.apply(that, arguments);\n    };\n  };\n\n  var push$1 = functionUncurryThis([].push);\n\n  // `Array.prototype.{ forEach, map, filter, some, every, find, findIndex, filterReject }` methods implementation\n  var createMethod = function (TYPE) {\n    var IS_MAP = TYPE == 1;\n    var IS_FILTER = TYPE == 2;\n    var IS_SOME = TYPE == 3;\n    var IS_EVERY = TYPE == 4;\n    var IS_FIND_INDEX = TYPE == 6;\n    var IS_FILTER_REJECT = TYPE == 7;\n    var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n    return function ($this, callbackfn, that, specificCreate) {\n      var O = toObject($this);\n      var self = indexedObject(O);\n      var boundFunction = functionBindContext(callbackfn, that);\n      var length = lengthOfArrayLike(self);\n      var index = 0;\n      var create = specificCreate || arraySpeciesCreate;\n      var target = IS_MAP ? create($this, length) : IS_FILTER || IS_FILTER_REJECT ? create($this, 0) : undefined;\n      var value, result;\n      for (;length > index; index++) if (NO_HOLES || index in self) {\n        value = self[index];\n        result = boundFunction(value, index, O);\n        if (TYPE) {\n          if (IS_MAP) target[index] = result; // map\n          else if (result) switch (TYPE) {\n            case 3: return true;              // some\n            case 5: return value;             // find\n            case 6: return index;             // findIndex\n            case 2: push$1(target, value);      // filter\n          } else switch (TYPE) {\n            case 4: return false;             // every\n            case 7: push$1(target, value);      // filterReject\n          }\n        }\n      }\n      return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : target;\n    };\n  };\n\n  var arrayIteration = {\n    // `Array.prototype.forEach` method\n    // https://tc39.es/ecma262/#sec-array.prototype.foreach\n    forEach: createMethod(0),\n    // `Array.prototype.map` method\n    // https://tc39.es/ecma262/#sec-array.prototype.map\n    map: createMethod(1),\n    // `Array.prototype.filter` method\n    // https://tc39.es/ecma262/#sec-array.prototype.filter\n    filter: createMethod(2),\n    // `Array.prototype.some` method\n    // https://tc39.es/ecma262/#sec-array.prototype.some\n    some: createMethod(3),\n    // `Array.prototype.every` method\n    // https://tc39.es/ecma262/#sec-array.prototype.every\n    every: createMethod(4),\n    // `Array.prototype.find` method\n    // https://tc39.es/ecma262/#sec-array.prototype.find\n    find: createMethod(5),\n    // `Array.prototype.findIndex` method\n    // https://tc39.es/ecma262/#sec-array.prototype.findIndex\n    findIndex: createMethod(6),\n    // `Array.prototype.filterReject` method\n    // https://github.com/tc39/proposal-array-filtering\n    filterReject: createMethod(7)\n  };\n\n  var $filter = arrayIteration.filter;\n\n\n  var HAS_SPECIES_SUPPORT$1 = arrayMethodHasSpeciesSupport('filter');\n\n  // `Array.prototype.filter` method\n  // https://tc39.es/ecma262/#sec-array.prototype.filter\n  // with adding support of @@species\n  _export({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT$1 }, {\n    filter: function filter(callbackfn /* , thisArg */) {\n      return $filter(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    }\n  });\n\n  /**\n   * Set tooltip left so it doesn't go off the right side of the window\n   *\n   * @return boolean true, if tooltipLayerStyleLeft is ok.  false, otherwise.\n   */\n  function checkRight(targetOffset, tooltipLayerStyleLeft, tooltipOffset, windowSize, tooltipLayer) {\n    if (targetOffset.left + tooltipLayerStyleLeft + tooltipOffset.width > windowSize.width) {\n      // off the right side of the window\n      tooltipLayer.style.left = \"\".concat(windowSize.width - tooltipOffset.width - targetOffset.left, \"px\");\n      return false;\n    }\n\n    tooltipLayer.style.left = \"\".concat(tooltipLayerStyleLeft, \"px\");\n    return true;\n  }\n\n  /**\n   * Set tooltip right so it doesn't go off the left side of the window\n   *\n   * @return boolean true, if tooltipLayerStyleRight is ok.  false, otherwise.\n   */\n  function checkLeft(targetOffset, tooltipLayerStyleRight, tooltipOffset, tooltipLayer) {\n    if (targetOffset.left + targetOffset.width - tooltipLayerStyleRight - tooltipOffset.width < 0) {\n      // off the left side of the window\n      tooltipLayer.style.left = \"\".concat(-targetOffset.left, \"px\");\n      return false;\n    }\n\n    tooltipLayer.style.right = \"\".concat(tooltipLayerStyleRight, \"px\");\n    return true;\n  }\n\n  var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\n\n  var TypeError$1 = global_1.TypeError;\n  var max = Math.max;\n  var min = Math.min;\n  var MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\n  var MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n  // `Array.prototype.splice` method\n  // https://tc39.es/ecma262/#sec-array.prototype.splice\n  // with adding support of @@species\n  _export({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n    splice: function splice(start, deleteCount /* , ...items */) {\n      var O = toObject(this);\n      var len = lengthOfArrayLike(O);\n      var actualStart = toAbsoluteIndex(start, len);\n      var argumentsLength = arguments.length;\n      var insertCount, actualDeleteCount, A, k, from, to;\n      if (argumentsLength === 0) {\n        insertCount = actualDeleteCount = 0;\n      } else if (argumentsLength === 1) {\n        insertCount = 0;\n        actualDeleteCount = len - actualStart;\n      } else {\n        insertCount = argumentsLength - 2;\n        actualDeleteCount = min(max(toIntegerOrInfinity(deleteCount), 0), len - actualStart);\n      }\n      if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n        throw TypeError$1(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n      }\n      A = arraySpeciesCreate(O, actualDeleteCount);\n      for (k = 0; k < actualDeleteCount; k++) {\n        from = actualStart + k;\n        if (from in O) createProperty(A, k, O[from]);\n      }\n      A.length = actualDeleteCount;\n      if (insertCount < actualDeleteCount) {\n        for (k = actualStart; k < len - actualDeleteCount; k++) {\n          from = k + actualDeleteCount;\n          to = k + insertCount;\n          if (from in O) O[to] = O[from];\n          else delete O[to];\n        }\n        for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n      } else if (insertCount > actualDeleteCount) {\n        for (k = len - actualDeleteCount; k > actualStart; k--) {\n          from = k + actualDeleteCount - 1;\n          to = k + insertCount - 1;\n          if (from in O) O[to] = O[from];\n          else delete O[to];\n        }\n      }\n      for (k = 0; k < insertCount; k++) {\n        O[k + actualStart] = arguments[k + 2];\n      }\n      O.length = len - actualDeleteCount + insertCount;\n      return A;\n    }\n  });\n\n  /**\n   * Remove an entry from a string array if it's there, does nothing if it isn't there.\n   *\n   * @param {Array} stringArray\n   * @param {String} stringToRemove\n   */\n  function removeEntry(stringArray, stringToRemove) {\n    if (stringArray.includes(stringToRemove)) {\n      stringArray.splice(stringArray.indexOf(stringToRemove), 1);\n    }\n  }\n\n  /**\n   * auto-determine alignment\n   * @param {Integer}  offsetLeft\n   * @param {Integer}  tooltipWidth\n   * @param {Object}   windowSize\n   * @param {String}   desiredAlignment\n   * @return {String}  calculatedAlignment\n   */\n\n  function _determineAutoAlignment(offsetLeft, tooltipWidth, _ref, desiredAlignment) {\n    var width = _ref.width;\n    var halfTooltipWidth = tooltipWidth / 2;\n    var winWidth = Math.min(width, window.screen.width);\n    var possibleAlignments = [\"-left-aligned\", \"-middle-aligned\", \"-right-aligned\"];\n    var calculatedAlignment = \"\"; // valid left must be at least a tooltipWidth\n    // away from right side\n\n    if (winWidth - offsetLeft < tooltipWidth) {\n      removeEntry(possibleAlignments, \"-left-aligned\");\n    } // valid middle must be at least half\n    // width away from both sides\n\n\n    if (offsetLeft < halfTooltipWidth || winWidth - offsetLeft < halfTooltipWidth) {\n      removeEntry(possibleAlignments, \"-middle-aligned\");\n    } // valid right must be at least a tooltipWidth\n    // width away from left side\n\n\n    if (offsetLeft < tooltipWidth) {\n      removeEntry(possibleAlignments, \"-right-aligned\");\n    }\n\n    if (possibleAlignments.length) {\n      if (possibleAlignments.includes(desiredAlignment)) {\n        // the desired alignment is valid\n        calculatedAlignment = desiredAlignment;\n      } else {\n        // pick the first valid position, in order\n        calculatedAlignment = possibleAlignments[0];\n      }\n    } else {\n      // if screen width is too small\n      // for ANY alignment, middle is\n      // probably the best for visibility\n      calculatedAlignment = \"-middle-aligned\";\n    }\n\n    return calculatedAlignment;\n  }\n  /**\n   * Determines the position of the tooltip based on the position precedence and availability\n   * of screen space.\n   *\n   * @param {Object}    targetElement\n   * @param {Object}    tooltipLayer\n   * @param {String}    desiredTooltipPosition\n   * @return {String}   calculatedPosition\n   */\n\n\n  function _determineAutoPosition(targetElement, tooltipLayer, desiredTooltipPosition) {\n    // Take a clone of position precedence. These will be the available\n    var possiblePositions = this._options.positionPrecedence.slice();\n\n    var windowSize = getWinSize();\n    var tooltipHeight = getOffset(tooltipLayer).height + 10;\n    var tooltipWidth = getOffset(tooltipLayer).width + 20;\n    var targetElementRect = targetElement.getBoundingClientRect(); // If we check all the possible areas, and there are no valid places for the tooltip, the element\n    // must take up most of the screen real estate. Show the tooltip floating in the middle of the screen.\n\n    var calculatedPosition = \"floating\";\n    /*\n     * auto determine position\n     */\n    // Check for space below\n\n    if (targetElementRect.bottom + tooltipHeight > windowSize.height) {\n      removeEntry(possiblePositions, \"bottom\");\n    } // Check for space above\n\n\n    if (targetElementRect.top - tooltipHeight < 0) {\n      removeEntry(possiblePositions, \"top\");\n    } // Check for space to the right\n\n\n    if (targetElementRect.right + tooltipWidth > windowSize.width) {\n      removeEntry(possiblePositions, \"right\");\n    } // Check for space to the left\n\n\n    if (targetElementRect.left - tooltipWidth < 0) {\n      removeEntry(possiblePositions, \"left\");\n    } // @var {String}  ex: 'right-aligned'\n\n\n    var desiredAlignment = function (pos) {\n      var hyphenIndex = pos.indexOf(\"-\");\n\n      if (hyphenIndex !== -1) {\n        // has alignment\n        return pos.substr(hyphenIndex);\n      }\n\n      return \"\";\n    }(desiredTooltipPosition || \"\"); // strip alignment from position\n\n\n    if (desiredTooltipPosition) {\n      // ex: \"bottom-right-aligned\"\n      // should return 'bottom'\n      desiredTooltipPosition = desiredTooltipPosition.split(\"-\")[0];\n    }\n\n    if (possiblePositions.length) {\n      if (possiblePositions.includes(desiredTooltipPosition)) {\n        // If the requested position is in the list, choose that\n        calculatedPosition = desiredTooltipPosition;\n      } else {\n        // Pick the first valid position, in order\n        calculatedPosition = possiblePositions[0];\n      }\n    } // only top and bottom positions have optional alignments\n\n\n    if ([\"top\", \"bottom\"].includes(calculatedPosition)) {\n      calculatedPosition += _determineAutoAlignment(targetElementRect.left, tooltipWidth, windowSize, desiredAlignment);\n    }\n\n    return calculatedPosition;\n  }\n  /**\n   * Render tooltip box in the page\n   *\n   * @api private\n   * @method placeTooltip\n   * @param {HTMLElement} targetElement\n   * @param {HTMLElement} tooltipLayer\n   * @param {HTMLElement} arrowLayer\n   * @param {Boolean} hintMode\n   */\n\n\n  function placeTooltip(targetElement, tooltipLayer, arrowLayer, hintMode) {\n    var tooltipCssClass = \"\";\n    var currentStepObj;\n    var tooltipOffset;\n    var targetOffset;\n    var windowSize;\n    var currentTooltipPosition;\n    hintMode = hintMode || false; //reset the old style\n\n    tooltipLayer.style.top = null;\n    tooltipLayer.style.right = null;\n    tooltipLayer.style.bottom = null;\n    tooltipLayer.style.left = null;\n    tooltipLayer.style.marginLeft = null;\n    tooltipLayer.style.marginTop = null;\n    arrowLayer.style.display = \"inherit\"; //prevent error when `this._currentStep` is undefined\n\n    if (!this._introItems[this._currentStep]) return; //if we have a custom css class for each step\n\n    currentStepObj = this._introItems[this._currentStep];\n\n    if (typeof currentStepObj.tooltipClass === \"string\") {\n      tooltipCssClass = currentStepObj.tooltipClass;\n    } else {\n      tooltipCssClass = this._options.tooltipClass;\n    }\n\n    tooltipLayer.className = [\"introjs-tooltip\", tooltipCssClass].filter(Boolean).join(\" \");\n    tooltipLayer.setAttribute(\"role\", \"dialog\");\n    currentTooltipPosition = this._introItems[this._currentStep].position; // Floating is always valid, no point in calculating\n\n    if (currentTooltipPosition !== \"floating\" && this._options.autoPosition) {\n      currentTooltipPosition = _determineAutoPosition.call(this, targetElement, tooltipLayer, currentTooltipPosition);\n    }\n\n    var tooltipLayerStyleLeft;\n    targetOffset = getOffset(targetElement);\n    tooltipOffset = getOffset(tooltipLayer);\n    windowSize = getWinSize();\n    addClass(tooltipLayer, \"introjs-\".concat(currentTooltipPosition));\n\n    switch (currentTooltipPosition) {\n      case \"top-right-aligned\":\n        arrowLayer.className = \"introjs-arrow bottom-right\";\n        var tooltipLayerStyleRight = 0;\n        checkLeft(targetOffset, tooltipLayerStyleRight, tooltipOffset, tooltipLayer);\n        tooltipLayer.style.bottom = \"\".concat(targetOffset.height + 20, \"px\");\n        break;\n\n      case \"top-middle-aligned\":\n        arrowLayer.className = \"introjs-arrow bottom-middle\";\n        var tooltipLayerStyleLeftRight = targetOffset.width / 2 - tooltipOffset.width / 2; // a fix for middle aligned hints\n\n        if (hintMode) {\n          tooltipLayerStyleLeftRight += 5;\n        }\n\n        if (checkLeft(targetOffset, tooltipLayerStyleLeftRight, tooltipOffset, tooltipLayer)) {\n          tooltipLayer.style.right = null;\n          checkRight(targetOffset, tooltipLayerStyleLeftRight, tooltipOffset, windowSize, tooltipLayer);\n        }\n\n        tooltipLayer.style.bottom = \"\".concat(targetOffset.height + 20, \"px\");\n        break;\n\n      case \"top-left-aligned\": // top-left-aligned is the same as the default top\n\n      case \"top\":\n        arrowLayer.className = \"introjs-arrow bottom\";\n        tooltipLayerStyleLeft = hintMode ? 0 : 15;\n        checkRight(targetOffset, tooltipLayerStyleLeft, tooltipOffset, windowSize, tooltipLayer);\n        tooltipLayer.style.bottom = \"\".concat(targetOffset.height + 20, \"px\");\n        break;\n\n      case \"right\":\n        tooltipLayer.style.left = \"\".concat(targetOffset.width + 20, \"px\");\n\n        if (targetOffset.top + tooltipOffset.height > windowSize.height) {\n          // In this case, right would have fallen below the bottom of the screen.\n          // Modify so that the bottom of the tooltip connects with the target\n          arrowLayer.className = \"introjs-arrow left-bottom\";\n          tooltipLayer.style.top = \"-\".concat(tooltipOffset.height - targetOffset.height - 20, \"px\");\n        } else {\n          arrowLayer.className = \"introjs-arrow left\";\n        }\n\n        break;\n\n      case \"left\":\n        if (!hintMode && this._options.showStepNumbers === true) {\n          tooltipLayer.style.top = \"15px\";\n        }\n\n        if (targetOffset.top + tooltipOffset.height > windowSize.height) {\n          // In this case, left would have fallen below the bottom of the screen.\n          // Modify so that the bottom of the tooltip connects with the target\n          tooltipLayer.style.top = \"-\".concat(tooltipOffset.height - targetOffset.height - 20, \"px\");\n          arrowLayer.className = \"introjs-arrow right-bottom\";\n        } else {\n          arrowLayer.className = \"introjs-arrow right\";\n        }\n\n        tooltipLayer.style.right = \"\".concat(targetOffset.width + 20, \"px\");\n        break;\n\n      case \"floating\":\n        arrowLayer.style.display = \"none\"; //we have to adjust the top and left of layer manually for intro items without element\n\n        tooltipLayer.style.left = \"50%\";\n        tooltipLayer.style.top = \"50%\";\n        tooltipLayer.style.marginLeft = \"-\".concat(tooltipOffset.width / 2, \"px\");\n        tooltipLayer.style.marginTop = \"-\".concat(tooltipOffset.height / 2, \"px\");\n        break;\n\n      case \"bottom-right-aligned\":\n        arrowLayer.className = \"introjs-arrow top-right\";\n        tooltipLayerStyleRight = 0;\n        checkLeft(targetOffset, tooltipLayerStyleRight, tooltipOffset, tooltipLayer);\n        tooltipLayer.style.top = \"\".concat(targetOffset.height + 20, \"px\");\n        break;\n\n      case \"bottom-middle-aligned\":\n        arrowLayer.className = \"introjs-arrow top-middle\";\n        tooltipLayerStyleLeftRight = targetOffset.width / 2 - tooltipOffset.width / 2; // a fix for middle aligned hints\n\n        if (hintMode) {\n          tooltipLayerStyleLeftRight += 5;\n        }\n\n        if (checkLeft(targetOffset, tooltipLayerStyleLeftRight, tooltipOffset, tooltipLayer)) {\n          tooltipLayer.style.right = null;\n          checkRight(targetOffset, tooltipLayerStyleLeftRight, tooltipOffset, windowSize, tooltipLayer);\n        }\n\n        tooltipLayer.style.top = \"\".concat(targetOffset.height + 20, \"px\");\n        break;\n      // case 'bottom-left-aligned':\n      // Bottom-left-aligned is the same as the default bottom\n      // case 'bottom':\n      // Bottom going to follow the default behavior\n\n      default:\n        arrowLayer.className = \"introjs-arrow top\";\n        tooltipLayerStyleLeft = 0;\n        checkRight(targetOffset, tooltipLayerStyleLeft, tooltipOffset, windowSize, tooltipLayer);\n        tooltipLayer.style.top = \"\".concat(targetOffset.height + 20, \"px\");\n    }\n  }\n\n  /**\n   * To remove all show element(s)\n   *\n   * @api private\n   * @method _removeShowElement\n   */\n\n  function removeShowElement() {\n    var elms = document.querySelectorAll(\".introjs-showElement\");\n    forEach(elms, function (elm) {\n      removeClass(elm, /introjs-[a-zA-Z]+/g);\n    });\n  }\n\n  function _createElement(tagname, attrs) {\n    var element = document.createElement(tagname);\n    attrs = attrs || {}; // regex for matching attributes that need to be set with setAttribute\n\n    var setAttRegex = /^(?:role|data-|aria-)/;\n\n    for (var k in attrs) {\n      var v = attrs[k];\n\n      if (k === \"style\") {\n        setStyle(element, v);\n      } else if (k.match(setAttRegex)) {\n        element.setAttribute(k, v);\n      } else {\n        element[k] = v;\n      }\n    }\n\n    return element;\n  }\n\n  /**\n   * Appends `element` to `parentElement`\n   *\n   * @param {Element} parentElement\n   * @param {Element} element\n   * @param {Boolean} [animate=false]\n   */\n\n  function appendChild(parentElement, element, animate) {\n    if (animate) {\n      var existingOpacity = element.style.opacity || \"1\";\n      setStyle(element, {\n        opacity: \"0\"\n      });\n      window.setTimeout(function () {\n        setStyle(element, {\n          opacity: existingOpacity\n        });\n      }, 10);\n    }\n\n    parentElement.appendChild(element);\n  }\n\n  /**\n   * Gets the current progress percentage\n   *\n   * @api private\n   * @method _getProgress\n   * @returns current progress percentage\n   */\n\n  function _getProgress() {\n    // Steps are 0 indexed\n    var currentStep = parseInt(this._currentStep + 1, 10);\n    return currentStep / this._introItems.length * 100;\n  }\n  /**\n   * Add disableinteraction layer and adjust the size and position of the layer\n   *\n   * @api private\n   * @method _disableInteraction\n   */\n\n\n  function _disableInteraction() {\n    var disableInteractionLayer = document.querySelector(\".introjs-disableInteraction\");\n\n    if (disableInteractionLayer === null) {\n      disableInteractionLayer = _createElement(\"div\", {\n        className: \"introjs-disableInteraction\"\n      });\n\n      this._targetElement.appendChild(disableInteractionLayer);\n    }\n\n    setHelperLayerPosition.call(this, disableInteractionLayer);\n  }\n  /**\n   * Creates the bullets layer\n   * @returns HTMLElement\n   * @private\n   */\n\n\n  function _createBullets(targetElement) {\n    var self = this;\n    var bulletsLayer = _createElement(\"div\", {\n      className: \"introjs-bullets\"\n    });\n\n    if (this._options.showBullets === false) {\n      bulletsLayer.style.display = \"none\";\n    }\n\n    var ulContainer = _createElement(\"ul\");\n    ulContainer.setAttribute(\"role\", \"tablist\");\n\n    var anchorClick = function anchorClick() {\n      self.goToStep(this.getAttribute(\"data-stepnumber\"));\n    };\n\n    forEach(this._introItems, function (_ref, i) {\n      var step = _ref.step;\n      var innerLi = _createElement(\"li\");\n      var anchorLink = _createElement(\"a\");\n      innerLi.setAttribute(\"role\", \"presentation\");\n      anchorLink.setAttribute(\"role\", \"tab\");\n      anchorLink.onclick = anchorClick;\n\n      if (i === targetElement.step - 1) {\n        anchorLink.className = \"active\";\n      }\n\n      setAnchorAsButton(anchorLink);\n      anchorLink.innerHTML = \"&nbsp;\";\n      anchorLink.setAttribute(\"data-stepnumber\", step);\n      innerLi.appendChild(anchorLink);\n      ulContainer.appendChild(innerLi);\n    });\n    bulletsLayer.appendChild(ulContainer);\n    return bulletsLayer;\n  }\n  /**\n   * Deletes and recreates the bullets layer\n   * @param oldReferenceLayer\n   * @param targetElement\n   * @private\n   */\n\n\n  function _recreateBullets(oldReferenceLayer, targetElement) {\n    if (this._options.showBullets) {\n      var existing = document.querySelector(\".introjs-bullets\");\n      existing.parentNode.replaceChild(_createBullets.call(this, targetElement), existing);\n    }\n  }\n  /**\n   * Updates the bullets\n   *\n   * @param oldReferenceLayer\n   * @param targetElement\n   */\n\n  function _updateBullets(oldReferenceLayer, targetElement) {\n    if (this._options.showBullets) {\n      oldReferenceLayer.querySelector(\".introjs-bullets li > a.active\").className = \"\";\n      oldReferenceLayer.querySelector(\".introjs-bullets li > a[data-stepnumber=\\\"\".concat(targetElement.step, \"\\\"]\")).className = \"active\";\n    }\n  }\n  /**\n   * Creates the progress-bar layer and elements\n   * @returns {*}\n   * @private\n   */\n\n\n  function _createProgressBar() {\n    var progressLayer = _createElement(\"div\");\n    progressLayer.className = \"introjs-progress\";\n\n    if (this._options.showProgress === false) {\n      progressLayer.style.display = \"none\";\n    }\n\n    var progressBar = _createElement(\"div\", {\n      className: \"introjs-progressbar\"\n    });\n\n    if (this._options.progressBarAdditionalClass) {\n      progressBar.className += \" \" + this._options.progressBarAdditionalClass;\n    }\n\n    progressBar.setAttribute(\"role\", \"progress\");\n    progressBar.setAttribute(\"aria-valuemin\", 0);\n    progressBar.setAttribute(\"aria-valuemax\", 100);\n    progressBar.setAttribute(\"aria-valuenow\", _getProgress.call(this));\n    progressBar.style.cssText = \"width:\".concat(_getProgress.call(this), \"%;\");\n    progressLayer.appendChild(progressBar);\n    return progressLayer;\n  }\n  /**\n   * Updates an existing progress bar variables\n   * @param oldReferenceLayer\n   * @private\n   */\n\n\n  function _updateProgressBar(oldReferenceLayer) {\n    oldReferenceLayer.querySelector(\".introjs-progress .introjs-progressbar\").style.cssText = \"width:\".concat(_getProgress.call(this), \"%;\");\n    oldReferenceLayer.querySelector(\".introjs-progress .introjs-progressbar\").setAttribute(\"aria-valuenow\", _getProgress.call(this));\n  }\n  /**\n   * Show an element on the page\n   *\n   * @api private\n   * @method _showElement\n   * @param {Object} targetElement\n   */\n\n  function _showElement(targetElement) {\n    var _this = this;\n\n    if (typeof this._introChangeCallback !== \"undefined\") {\n      this._introChangeCallback.call(this, targetElement.element);\n    }\n\n    var self = this;\n    var oldHelperLayer = document.querySelector(\".introjs-helperLayer\");\n    var oldReferenceLayer = document.querySelector(\".introjs-tooltipReferenceLayer\");\n    var highlightClass = \"introjs-helperLayer\";\n    var nextTooltipButton;\n    var prevTooltipButton;\n    var skipTooltipButton; //check for a current step highlight class\n\n    if (typeof targetElement.highlightClass === \"string\") {\n      highlightClass += \" \".concat(targetElement.highlightClass);\n    } //check for options highlight class\n\n\n    if (typeof this._options.highlightClass === \"string\") {\n      highlightClass += \" \".concat(this._options.highlightClass);\n    }\n\n    if (oldHelperLayer !== null && oldReferenceLayer !== null) {\n      var oldHelperNumberLayer = oldReferenceLayer.querySelector(\".introjs-helperNumberLayer\");\n      var oldtooltipLayer = oldReferenceLayer.querySelector(\".introjs-tooltiptext\");\n      var oldTooltipTitleLayer = oldReferenceLayer.querySelector(\".introjs-tooltip-title\");\n      var oldArrowLayer = oldReferenceLayer.querySelector(\".introjs-arrow\");\n      var oldtooltipContainer = oldReferenceLayer.querySelector(\".introjs-tooltip\");\n      skipTooltipButton = oldReferenceLayer.querySelector(\".introjs-skipbutton\");\n      prevTooltipButton = oldReferenceLayer.querySelector(\".introjs-prevbutton\");\n      nextTooltipButton = oldReferenceLayer.querySelector(\".introjs-nextbutton\"); //update or reset the helper highlight class\n\n      oldHelperLayer.className = highlightClass; //hide the tooltip\n\n      oldtooltipContainer.style.opacity = 0;\n      oldtooltipContainer.style.display = \"none\"; // if the target element is within a scrollable element\n\n      scrollParentToElement.call(self, targetElement); // set new position to helper layer\n\n      setHelperLayerPosition.call(self, oldHelperLayer);\n      setHelperLayerPosition.call(self, oldReferenceLayer); //remove old classes if the element still exist\n\n      removeShowElement(); //we should wait until the CSS3 transition is competed (it's 0.3 sec) to prevent incorrect `height` and `width` calculation\n\n      if (self._lastShowElementTimer) {\n        window.clearTimeout(self._lastShowElementTimer);\n      }\n\n      self._lastShowElementTimer = window.setTimeout(function () {\n        // set current step to the label\n        if (oldHelperNumberLayer !== null) {\n          oldHelperNumberLayer.innerHTML = \"\".concat(targetElement.step, \" of \").concat(_this._introItems.length);\n        } // set current tooltip text\n\n\n        oldtooltipLayer.innerHTML = targetElement.intro; // set current tooltip title\n\n        oldTooltipTitleLayer.innerHTML = targetElement.title; //set the tooltip position\n\n        oldtooltipContainer.style.display = \"block\";\n        placeTooltip.call(self, targetElement.element, oldtooltipContainer, oldArrowLayer); //change active bullet\n\n        _updateBullets.call(self, oldReferenceLayer, targetElement);\n\n        _updateProgressBar.call(self, oldReferenceLayer); //show the tooltip\n\n\n        oldtooltipContainer.style.opacity = 1; //reset button focus\n\n        if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null && /introjs-donebutton/gi.test(nextTooltipButton.className)) {\n          // skip button is now \"done\" button\n          nextTooltipButton.focus();\n        } else if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n          //still in the tour, focus on next\n          nextTooltipButton.focus();\n        } // change the scroll of the window, if needed\n\n\n        scrollTo.call(self, targetElement.scrollTo, targetElement, oldtooltipLayer);\n      }, 350); // end of old element if-else condition\n    } else {\n      var helperLayer = _createElement(\"div\", {\n        className: highlightClass\n      });\n      var referenceLayer = _createElement(\"div\", {\n        className: \"introjs-tooltipReferenceLayer\"\n      });\n      var arrowLayer = _createElement(\"div\", {\n        className: \"introjs-arrow\"\n      });\n      var tooltipLayer = _createElement(\"div\", {\n        className: \"introjs-tooltip\"\n      });\n      var tooltipTextLayer = _createElement(\"div\", {\n        className: \"introjs-tooltiptext\"\n      });\n      var tooltipHeaderLayer = _createElement(\"div\", {\n        className: \"introjs-tooltip-header\"\n      });\n      var tooltipTitleLayer = _createElement(\"h1\", {\n        className: \"introjs-tooltip-title\"\n      });\n      var buttonsLayer = _createElement(\"div\");\n      setStyle(helperLayer, {\n        \"box-shadow\": \"0 0 1px 2px rgba(33, 33, 33, 0.8), rgba(33, 33, 33, \".concat(self._options.overlayOpacity.toString(), \") 0 0 0 5000px\")\n      }); // target is within a scrollable element\n\n      scrollParentToElement.call(self, targetElement); //set new position to helper layer\n\n      setHelperLayerPosition.call(self, helperLayer);\n      setHelperLayerPosition.call(self, referenceLayer); //add helper layer to target element\n\n      appendChild(this._targetElement, helperLayer, true);\n      appendChild(this._targetElement, referenceLayer);\n      tooltipTextLayer.innerHTML = targetElement.intro;\n      tooltipTitleLayer.innerHTML = targetElement.title;\n      buttonsLayer.className = \"introjs-tooltipbuttons\";\n\n      if (this._options.showButtons === false) {\n        buttonsLayer.style.display = \"none\";\n      }\n\n      tooltipHeaderLayer.appendChild(tooltipTitleLayer);\n      tooltipLayer.appendChild(tooltipHeaderLayer);\n      tooltipLayer.appendChild(tooltipTextLayer);\n      tooltipLayer.appendChild(_createBullets.call(this, targetElement));\n      tooltipLayer.appendChild(_createProgressBar.call(this)); // add helper layer number\n\n      var helperNumberLayer = _createElement(\"div\");\n\n      if (this._options.showStepNumbers === true) {\n        helperNumberLayer.className = \"introjs-helperNumberLayer\";\n        helperNumberLayer.innerHTML = \"\".concat(targetElement.step, \" of \").concat(this._introItems.length);\n        tooltipLayer.appendChild(helperNumberLayer);\n      }\n\n      tooltipLayer.appendChild(arrowLayer);\n      referenceLayer.appendChild(tooltipLayer); //next button\n\n      nextTooltipButton = _createElement(\"a\");\n\n      nextTooltipButton.onclick = function () {\n        if (self._introItems.length - 1 !== self._currentStep) {\n          nextStep.call(self);\n        } else if (/introjs-donebutton/gi.test(nextTooltipButton.className)) {\n          if (typeof self._introCompleteCallback === \"function\") {\n            self._introCompleteCallback.call(self, self._currentStep, \"done\");\n          }\n\n          exitIntro.call(self, self._targetElement);\n        }\n      };\n\n      setAnchorAsButton(nextTooltipButton);\n      nextTooltipButton.innerHTML = this._options.nextLabel; //previous button\n\n      prevTooltipButton = _createElement(\"a\");\n\n      prevTooltipButton.onclick = function () {\n        if (self._currentStep !== 0) {\n          previousStep.call(self);\n        }\n      };\n\n      setAnchorAsButton(prevTooltipButton);\n      prevTooltipButton.innerHTML = this._options.prevLabel; //skip button\n\n      skipTooltipButton = _createElement(\"a\", {\n        className: \"introjs-skipbutton\"\n      });\n      setAnchorAsButton(skipTooltipButton);\n      skipTooltipButton.innerHTML = this._options.skipLabel;\n\n      skipTooltipButton.onclick = function () {\n        if (self._introItems.length - 1 === self._currentStep && typeof self._introCompleteCallback === \"function\") {\n          self._introCompleteCallback.call(self, self._currentStep, \"skip\");\n        }\n\n        if (typeof self._introSkipCallback === \"function\") {\n          self._introSkipCallback.call(self);\n        }\n\n        exitIntro.call(self, self._targetElement);\n      };\n\n      tooltipHeaderLayer.appendChild(skipTooltipButton); //in order to prevent displaying previous button always\n\n      if (this._introItems.length > 1) {\n        buttonsLayer.appendChild(prevTooltipButton);\n      } // we always need the next button because this\n      // button changes to \"Done\" in the last step of the tour\n\n\n      buttonsLayer.appendChild(nextTooltipButton);\n      tooltipLayer.appendChild(buttonsLayer); //set proper position\n\n      placeTooltip.call(self, targetElement.element, tooltipLayer, arrowLayer); // change the scroll of the window, if needed\n\n      scrollTo.call(this, targetElement.scrollTo, targetElement, tooltipLayer); //end of new element if-else condition\n    } // removing previous disable interaction layer\n\n\n    var disableInteractionLayer = self._targetElement.querySelector(\".introjs-disableInteraction\");\n\n    if (disableInteractionLayer) {\n      disableInteractionLayer.parentNode.removeChild(disableInteractionLayer);\n    } //disable interaction\n\n\n    if (targetElement.disableInteraction) {\n      _disableInteraction.call(self);\n    } // when it's the first step of tour\n\n\n    if (this._currentStep === 0 && this._introItems.length > 1) {\n      if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n        nextTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-nextbutton\");\n        nextTooltipButton.innerHTML = this._options.nextLabel;\n      }\n\n      if (this._options.hidePrev === true) {\n        if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n          prevTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-prevbutton introjs-hidden\");\n        }\n\n        if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n          addClass(nextTooltipButton, \"introjs-fullbutton\");\n        }\n      } else {\n        if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n          prevTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-prevbutton introjs-disabled\");\n        }\n      }\n    } else if (this._introItems.length - 1 === this._currentStep || this._introItems.length === 1) {\n      // last step of tour\n      if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n        prevTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-prevbutton\");\n      }\n\n      if (this._options.hideNext === true) {\n        if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n          nextTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-nextbutton introjs-hidden\");\n        }\n\n        if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n          addClass(prevTooltipButton, \"introjs-fullbutton\");\n        }\n      } else {\n        if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n          if (this._options.nextToDone === true) {\n            nextTooltipButton.innerHTML = this._options.doneLabel;\n            addClass(nextTooltipButton, \"\".concat(this._options.buttonClass, \" introjs-nextbutton introjs-donebutton\"));\n          } else {\n            nextTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-nextbutton introjs-disabled\");\n          }\n        }\n      }\n    } else {\n      // steps between start and end\n      if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n        prevTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-prevbutton\");\n      }\n\n      if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n        nextTooltipButton.className = \"\".concat(this._options.buttonClass, \" introjs-nextbutton\");\n        nextTooltipButton.innerHTML = this._options.nextLabel;\n      }\n    }\n\n    if (typeof prevTooltipButton !== \"undefined\" && prevTooltipButton !== null) {\n      prevTooltipButton.setAttribute(\"role\", \"button\");\n    }\n\n    if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n      nextTooltipButton.setAttribute(\"role\", \"button\");\n    }\n\n    if (typeof skipTooltipButton !== \"undefined\" && skipTooltipButton !== null) {\n      skipTooltipButton.setAttribute(\"role\", \"button\");\n    } //Set focus on \"next\" button, so that hitting Enter always moves you onto the next step\n\n\n    if (typeof nextTooltipButton !== \"undefined\" && nextTooltipButton !== null) {\n      nextTooltipButton.focus();\n    }\n\n    setShowElement(targetElement);\n\n    if (typeof this._introAfterChangeCallback !== \"undefined\") {\n      this._introAfterChangeCallback.call(this, targetElement.element);\n    }\n  }\n\n  /**\n   * Go to specific step of introduction\n   *\n   * @api private\n   * @method _goToStep\n   */\n\n  function goToStep(step) {\n    //because steps starts with zero\n    this._currentStep = step - 2;\n\n    if (typeof this._introItems !== \"undefined\") {\n      nextStep.call(this);\n    }\n  }\n  /**\n   * Go to the specific step of introduction with the explicit [data-step] number\n   *\n   * @api private\n   * @method _goToStepNumber\n   */\n\n  function goToStepNumber(step) {\n    this._currentStepNumber = step;\n\n    if (typeof this._introItems !== \"undefined\") {\n      nextStep.call(this);\n    }\n  }\n  /**\n   * Go to next step on intro\n   *\n   * @api private\n   * @method _nextStep\n   */\n\n  function nextStep() {\n    var _this = this;\n\n    this._direction = \"forward\";\n\n    if (typeof this._currentStepNumber !== \"undefined\") {\n      forEach(this._introItems, function (_ref, i) {\n        var step = _ref.step;\n\n        if (step === _this._currentStepNumber) {\n          _this._currentStep = i - 1;\n          _this._currentStepNumber = undefined;\n        }\n      });\n    }\n\n    if (typeof this._currentStep === \"undefined\") {\n      this._currentStep = 0;\n    } else {\n      ++this._currentStep;\n    }\n\n    var nextStep = this._introItems[this._currentStep];\n    var continueStep = true;\n\n    if (typeof this._introBeforeChangeCallback !== \"undefined\") {\n      continueStep = this._introBeforeChangeCallback.call(this, nextStep && nextStep.element);\n    } // if `onbeforechange` returned `false`, stop displaying the element\n\n\n    if (continueStep === false) {\n      --this._currentStep;\n      return false;\n    }\n\n    if (this._introItems.length <= this._currentStep) {\n      //end of the intro\n      //check if any callback is defined\n      if (typeof this._introCompleteCallback === \"function\") {\n        this._introCompleteCallback.call(this, this._currentStep, \"end\");\n      }\n\n      exitIntro.call(this, this._targetElement);\n      return;\n    }\n\n    _showElement.call(this, nextStep);\n  }\n  /**\n   * Go to previous step on intro\n   *\n   * @api private\n   * @method _previousStep\n   */\n\n  function previousStep() {\n    this._direction = \"backward\";\n\n    if (this._currentStep === 0) {\n      return false;\n    }\n\n    --this._currentStep;\n    var nextStep = this._introItems[this._currentStep];\n    var continueStep = true;\n\n    if (typeof this._introBeforeChangeCallback !== \"undefined\") {\n      continueStep = this._introBeforeChangeCallback.call(this, nextStep && nextStep.element);\n    } // if `onbeforechange` returned `false`, stop displaying the element\n\n\n    if (continueStep === false) {\n      ++this._currentStep;\n      return false;\n    }\n\n    _showElement.call(this, nextStep);\n  }\n  /**\n   * Returns the current step of the intro\n   *\n   * @returns {number | boolean}\n   */\n\n  function currentStep() {\n    return this._currentStep;\n  }\n\n  /**\n   * on keyCode:\n   * https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n   * This feature has been removed from the Web standards.\n   * Though some browsers may still support it, it is in\n   * the process of being dropped.\n   * Instead, you should use KeyboardEvent.code,\n   * if it's implemented.\n   *\n   * jQuery's approach is to test for\n   *   (1) e.which, then\n   *   (2) e.charCode, then\n   *   (3) e.keyCode\n   * https://github.com/jquery/jquery/blob/a6b0705294d336ae2f63f7276de0da1195495363/src/event.js#L638\n   *\n   * @param type var\n   * @return type\n   */\n\n  function onKeyDown(e) {\n    var code = e.code === undefined ? e.which : e.code; // if e.which is null\n\n    if (code === null) {\n      code = e.charCode === null ? e.keyCode : e.charCode;\n    }\n\n    if ((code === \"Escape\" || code === 27) && this._options.exitOnEsc === true) {\n      //escape key pressed, exit the intro\n      //check if exit callback is defined\n      exitIntro.call(this, this._targetElement);\n    } else if (code === \"ArrowLeft\" || code === 37) {\n      //left arrow\n      previousStep.call(this);\n    } else if (code === \"ArrowRight\" || code === 39) {\n      //right arrow\n      nextStep.call(this);\n    } else if (code === \"Enter\" || code === \"NumpadEnter\" || code === 13) {\n      //srcElement === ie\n      var target = e.target || e.srcElement;\n\n      if (target && target.className.match(\"introjs-prevbutton\")) {\n        //user hit enter while focusing on previous button\n        previousStep.call(this);\n      } else if (target && target.className.match(\"introjs-skipbutton\")) {\n        //user hit enter while focusing on skip button\n        if (this._introItems.length - 1 === this._currentStep && typeof this._introCompleteCallback === \"function\") {\n          this._introCompleteCallback.call(this, this._currentStep, \"skip\");\n        }\n\n        exitIntro.call(this, this._targetElement);\n      } else if (target && target.getAttribute(\"data-stepnumber\")) {\n        // user hit enter while focusing on step bullet\n        target.click();\n      } else {\n        //default behavior for responding to enter\n        nextStep.call(this);\n      } //prevent default behaviour on hitting Enter, to prevent steps being skipped in some browsers\n\n\n      if (e.preventDefault) {\n        e.preventDefault();\n      } else {\n        e.returnValue = false;\n      }\n    }\n  }\n\n  /*\n   * makes a copy of the object\n   * @api private\n   * @method _cloneObject\n   */\n  function cloneObject(object) {\n    if (object === null || _typeof(object) !== \"object\" || typeof object.nodeType !== \"undefined\") {\n      return object;\n    }\n\n    var temp = {};\n\n    for (var key in object) {\n      if (typeof window.jQuery !== \"undefined\" && object[key] instanceof window.jQuery) {\n        temp[key] = object[key];\n      } else {\n        temp[key] = cloneObject(object[key]);\n      }\n    }\n\n    return temp;\n  }\n\n  function debounce(func, timeout) {\n    var _this = this;\n\n    var timer;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      clearTimeout(timer);\n      timer = setTimeout(function () {\n        func.apply(_this, args);\n      }, timeout);\n    };\n  }\n\n  /**\n   * Get a queryselector within the hint wrapper\n   *\n   * @param {String} selector\n   * @return {NodeList|Array}\n   */\n\n  function hintQuerySelectorAll(selector) {\n    var hintsWrapper = document.querySelector(\".introjs-hints\");\n    return hintsWrapper ? hintsWrapper.querySelectorAll(selector) : [];\n  }\n  /**\n   * Hide a hint\n   *\n   * @api private\n   * @method hideHint\n   */\n\n  function hideHint(stepId) {\n    var hint = hintQuerySelectorAll(\".introjs-hint[data-step=\\\"\".concat(stepId, \"\\\"]\"))[0];\n    removeHintTooltip.call(this);\n\n    if (hint) {\n      addClass(hint, \"introjs-hidehint\");\n    } // call the callback function (if any)\n\n\n    if (typeof this._hintCloseCallback !== \"undefined\") {\n      this._hintCloseCallback.call(this, stepId);\n    }\n  }\n  /**\n   * Hide all hints\n   *\n   * @api private\n   * @method hideHints\n   */\n\n  function hideHints() {\n    var _this = this;\n\n    var hints = hintQuerySelectorAll(\".introjs-hint\");\n    forEach(hints, function (hint) {\n      hideHint.call(_this, hint.getAttribute(\"data-step\"));\n    });\n  }\n  /**\n   * Show all hints\n   *\n   * @api private\n   * @method _showHints\n   */\n\n  function showHints() {\n    var _this2 = this;\n\n    var hints = hintQuerySelectorAll(\".introjs-hint\");\n\n    if (hints && hints.length) {\n      forEach(hints, function (hint) {\n        showHint.call(_this2, hint.getAttribute(\"data-step\"));\n      });\n    } else {\n      populateHints.call(this, this._targetElement);\n    }\n  }\n  /**\n   * Show a hint\n   *\n   * @api private\n   * @method showHint\n   */\n\n  function showHint(stepId) {\n    var hint = hintQuerySelectorAll(\".introjs-hint[data-step=\\\"\".concat(stepId, \"\\\"]\"))[0];\n\n    if (hint) {\n      removeClass(hint, /introjs-hidehint/g);\n    }\n  }\n  /**\n   * Removes all hint elements on the page\n   * Useful when you want to destroy the elements and add them again (e.g. a modal or popup)\n   *\n   * @api private\n   * @method removeHints\n   */\n\n  function removeHints() {\n    var _this3 = this;\n\n    var hints = hintQuerySelectorAll(\".introjs-hint\");\n    forEach(hints, function (hint) {\n      removeHint.call(_this3, hint.getAttribute(\"data-step\"));\n    });\n    DOMEvent.off(document, \"click\", removeHintTooltip, this, false);\n    DOMEvent.off(window, \"resize\", reAlignHints, this, true);\n    if (this._hintsAutoRefreshFunction) DOMEvent.off(window, \"scroll\", this._hintsAutoRefreshFunction, this, true);\n  }\n  /**\n   * Remove one single hint element from the page\n   * Useful when you want to destroy the element and add them again (e.g. a modal or popup)\n   * Use removeHints if you want to remove all elements.\n   *\n   * @api private\n   * @method removeHint\n   */\n\n  function removeHint(stepId) {\n    var hint = hintQuerySelectorAll(\".introjs-hint[data-step=\\\"\".concat(stepId, \"\\\"]\"))[0];\n\n    if (hint) {\n      hint.parentNode.removeChild(hint);\n    }\n  }\n  /**\n   * Add all available hints to the page\n   *\n   * @api private\n   * @method addHints\n   */\n\n  function addHints() {\n    var _this4 = this;\n\n    var self = this;\n    var hintsWrapper = document.querySelector(\".introjs-hints\");\n\n    if (hintsWrapper === null) {\n      hintsWrapper = _createElement(\"div\", {\n        className: \"introjs-hints\"\n      });\n    }\n    /**\n     * Returns an event handler unique to the hint iteration\n     *\n     * @param {Integer} i\n     * @return {Function}\n     */\n\n\n    var getHintClick = function getHintClick(i) {\n      return function (e) {\n        var evt = e ? e : window.event;\n\n        if (evt.stopPropagation) {\n          evt.stopPropagation();\n        }\n\n        if (evt.cancelBubble !== null) {\n          evt.cancelBubble = true;\n        }\n\n        showHintDialog.call(self, i);\n      };\n    };\n\n    forEach(this._introItems, function (item, i) {\n      // avoid append a hint twice\n      if (document.querySelector(\".introjs-hint[data-step=\\\"\".concat(i, \"\\\"]\"))) {\n        return;\n      }\n\n      var hint = _createElement(\"a\", {\n        className: \"introjs-hint\"\n      });\n      setAnchorAsButton(hint);\n      hint.onclick = getHintClick(i);\n\n      if (!item.hintAnimation) {\n        addClass(hint, \"introjs-hint-no-anim\");\n      } // hint's position should be fixed if the target element's position is fixed\n\n\n      if (isFixed(item.element)) {\n        addClass(hint, \"introjs-fixedhint\");\n      }\n\n      var hintDot = _createElement(\"div\", {\n        className: \"introjs-hint-dot\"\n      });\n      var hintPulse = _createElement(\"div\", {\n        className: \"introjs-hint-pulse\"\n      });\n      hint.appendChild(hintDot);\n      hint.appendChild(hintPulse);\n      hint.setAttribute(\"data-step\", i); // we swap the hint element with target element\n      // because _setHelperLayerPosition uses `element` property\n\n      item.targetElement = item.element;\n      item.element = hint; // align the hint position\n\n      alignHintPosition.call(_this4, item.hintPosition, hint, item.targetElement);\n      hintsWrapper.appendChild(hint);\n    }); // adding the hints wrapper\n\n    document.body.appendChild(hintsWrapper); // call the callback function (if any)\n\n    if (typeof this._hintsAddedCallback !== \"undefined\") {\n      this._hintsAddedCallback.call(this);\n    }\n\n    if (this._options.hintAutoRefreshInterval >= 0) {\n      this._hintsAutoRefreshFunction = debounce(function () {\n        return reAlignHints.call(_this4);\n      }, this._options.hintAutoRefreshInterval);\n      DOMEvent.on(window, \"scroll\", this._hintsAutoRefreshFunction, this, true);\n    }\n  }\n  /**\n   * Aligns hint position\n   *\n   * @api private\n   * @method alignHintPosition\n   * @param {String} position\n   * @param {Object} hint\n   * @param {Object} element\n   */\n\n  function alignHintPosition(position, _ref, element) {\n    var style = _ref.style;\n    // get/calculate offset of target element\n    var offset = getOffset.call(this, element);\n    var iconWidth = 20;\n    var iconHeight = 20; // align the hint element\n\n    switch (position) {\n      default:\n      case \"top-left\":\n        style.left = \"\".concat(offset.left, \"px\");\n        style.top = \"\".concat(offset.top, \"px\");\n        break;\n\n      case \"top-right\":\n        style.left = \"\".concat(offset.left + offset.width - iconWidth, \"px\");\n        style.top = \"\".concat(offset.top, \"px\");\n        break;\n\n      case \"bottom-left\":\n        style.left = \"\".concat(offset.left, \"px\");\n        style.top = \"\".concat(offset.top + offset.height - iconHeight, \"px\");\n        break;\n\n      case \"bottom-right\":\n        style.left = \"\".concat(offset.left + offset.width - iconWidth, \"px\");\n        style.top = \"\".concat(offset.top + offset.height - iconHeight, \"px\");\n        break;\n\n      case \"middle-left\":\n        style.left = \"\".concat(offset.left, \"px\");\n        style.top = \"\".concat(offset.top + (offset.height - iconHeight) / 2, \"px\");\n        break;\n\n      case \"middle-right\":\n        style.left = \"\".concat(offset.left + offset.width - iconWidth, \"px\");\n        style.top = \"\".concat(offset.top + (offset.height - iconHeight) / 2, \"px\");\n        break;\n\n      case \"middle-middle\":\n        style.left = \"\".concat(offset.left + (offset.width - iconWidth) / 2, \"px\");\n        style.top = \"\".concat(offset.top + (offset.height - iconHeight) / 2, \"px\");\n        break;\n\n      case \"bottom-middle\":\n        style.left = \"\".concat(offset.left + (offset.width - iconWidth) / 2, \"px\");\n        style.top = \"\".concat(offset.top + offset.height - iconHeight, \"px\");\n        break;\n\n      case \"top-middle\":\n        style.left = \"\".concat(offset.left + (offset.width - iconWidth) / 2, \"px\");\n        style.top = \"\".concat(offset.top, \"px\");\n        break;\n    }\n  }\n  /**\n   * Triggers when user clicks on the hint element\n   *\n   * @api private\n   * @method _showHintDialog\n   * @param {Number} stepId\n   */\n\n  function showHintDialog(stepId) {\n    var hintElement = document.querySelector(\".introjs-hint[data-step=\\\"\".concat(stepId, \"\\\"]\"));\n    var item = this._introItems[stepId]; // call the callback function (if any)\n\n    if (typeof this._hintClickCallback !== \"undefined\") {\n      this._hintClickCallback.call(this, hintElement, item, stepId);\n    } // remove all open tooltips\n\n\n    var removedStep = removeHintTooltip.call(this); // to toggle the tooltip\n\n    if (parseInt(removedStep, 10) === stepId) {\n      return;\n    }\n\n    var tooltipLayer = _createElement(\"div\", {\n      className: \"introjs-tooltip\"\n    });\n    var tooltipTextLayer = _createElement(\"div\");\n    var arrowLayer = _createElement(\"div\");\n    var referenceLayer = _createElement(\"div\");\n\n    tooltipLayer.onclick = function (e) {\n      //IE9 & Other Browsers\n      if (e.stopPropagation) {\n        e.stopPropagation();\n      } //IE8 and Lower\n      else {\n        e.cancelBubble = true;\n      }\n    };\n\n    tooltipTextLayer.className = \"introjs-tooltiptext\";\n    var tooltipWrapper = _createElement(\"p\");\n    tooltipWrapper.innerHTML = item.hint;\n    tooltipTextLayer.appendChild(tooltipWrapper);\n\n    if (this._options.hintShowButton) {\n      var closeButton = _createElement(\"a\");\n      closeButton.className = this._options.buttonClass;\n      closeButton.setAttribute(\"role\", \"button\");\n      closeButton.innerHTML = this._options.hintButtonLabel;\n      closeButton.onclick = hideHint.bind(this, stepId);\n      tooltipTextLayer.appendChild(closeButton);\n    }\n\n    arrowLayer.className = \"introjs-arrow\";\n    tooltipLayer.appendChild(arrowLayer);\n    tooltipLayer.appendChild(tooltipTextLayer); // set current step for _placeTooltip function\n\n    this._currentStep = hintElement.getAttribute(\"data-step\"); // align reference layer position\n\n    referenceLayer.className = \"introjs-tooltipReferenceLayer introjs-hintReference\";\n    referenceLayer.setAttribute(\"data-step\", hintElement.getAttribute(\"data-step\"));\n    setHelperLayerPosition.call(this, referenceLayer);\n    referenceLayer.appendChild(tooltipLayer);\n    document.body.appendChild(referenceLayer); //set proper position\n\n    placeTooltip.call(this, hintElement, tooltipLayer, arrowLayer, true);\n  }\n  /**\n   * Removes open hint (tooltip hint)\n   *\n   * @api private\n   * @method _removeHintTooltip\n   */\n\n  function removeHintTooltip() {\n    var tooltip = document.querySelector(\".introjs-hintReference\");\n\n    if (tooltip) {\n      var step = tooltip.getAttribute(\"data-step\");\n      tooltip.parentNode.removeChild(tooltip);\n      return step;\n    }\n  }\n  /**\n   * Start parsing hint items\n   *\n   * @api private\n   * @param {Object} targetElm\n   * @method _startHint\n   */\n\n  function populateHints(targetElm) {\n    var _this5 = this;\n\n    this._introItems = [];\n\n    if (this._options.hints) {\n      forEach(this._options.hints, function (hint) {\n        var currentItem = cloneObject(hint);\n\n        if (typeof currentItem.element === \"string\") {\n          //grab the element with given selector from the page\n          currentItem.element = document.querySelector(currentItem.element);\n        }\n\n        currentItem.hintPosition = currentItem.hintPosition || _this5._options.hintPosition;\n        currentItem.hintAnimation = currentItem.hintAnimation || _this5._options.hintAnimation;\n\n        if (currentItem.element !== null) {\n          _this5._introItems.push(currentItem);\n        }\n      });\n    } else {\n      var hints = targetElm.querySelectorAll(\"*[data-hint]\");\n\n      if (!hints || !hints.length) {\n        return false;\n      } //first add intro items with data-step\n\n\n      forEach(hints, function (currentElement) {\n        // hint animation\n        var hintAnimation = currentElement.getAttribute(\"data-hintanimation\");\n\n        if (hintAnimation) {\n          hintAnimation = hintAnimation === \"true\";\n        } else {\n          hintAnimation = _this5._options.hintAnimation;\n        }\n\n        _this5._introItems.push({\n          element: currentElement,\n          hint: currentElement.getAttribute(\"data-hint\"),\n          hintPosition: currentElement.getAttribute(\"data-hintposition\") || _this5._options.hintPosition,\n          hintAnimation: hintAnimation,\n          tooltipClass: currentElement.getAttribute(\"data-tooltipclass\"),\n          position: currentElement.getAttribute(\"data-position\") || _this5._options.tooltipPosition\n        });\n      });\n    }\n\n    addHints.call(this);\n    DOMEvent.on(document, \"click\", removeHintTooltip, this, false);\n    DOMEvent.on(window, \"resize\", reAlignHints, this, true);\n  }\n  /**\n   * Re-aligns all hint elements\n   *\n   * @api private\n   * @method _reAlignHints\n   */\n\n  function reAlignHints() {\n    var _this6 = this;\n\n    forEach(this._introItems, function (_ref2) {\n      var targetElement = _ref2.targetElement,\n          hintPosition = _ref2.hintPosition,\n          element = _ref2.element;\n\n      if (typeof targetElement === \"undefined\") {\n        return;\n      }\n\n      alignHintPosition.call(_this6, hintPosition, element, targetElement);\n    });\n  }\n\n  var floor = Math.floor;\n\n  var mergeSort = function (array, comparefn) {\n    var length = array.length;\n    var middle = floor(length / 2);\n    return length < 8 ? insertionSort(array, comparefn) : merge(\n      array,\n      mergeSort(arraySlice(array, 0, middle), comparefn),\n      mergeSort(arraySlice(array, middle), comparefn),\n      comparefn\n    );\n  };\n\n  var insertionSort = function (array, comparefn) {\n    var length = array.length;\n    var i = 1;\n    var element, j;\n\n    while (i < length) {\n      j = i;\n      element = array[i];\n      while (j && comparefn(array[j - 1], element) > 0) {\n        array[j] = array[--j];\n      }\n      if (j !== i++) array[j] = element;\n    } return array;\n  };\n\n  var merge = function (array, left, right, comparefn) {\n    var llength = left.length;\n    var rlength = right.length;\n    var lindex = 0;\n    var rindex = 0;\n\n    while (lindex < llength || rindex < rlength) {\n      array[lindex + rindex] = (lindex < llength && rindex < rlength)\n        ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n        : lindex < llength ? left[lindex++] : right[rindex++];\n    } return array;\n  };\n\n  var arraySort = mergeSort;\n\n  var firefox = engineUserAgent.match(/firefox\\/(\\d+)/i);\n\n  var engineFfVersion = !!firefox && +firefox[1];\n\n  var engineIsIeOrEdge = /MSIE|Trident/.test(engineUserAgent);\n\n  var webkit = engineUserAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\n  var engineWebkitVersion = !!webkit && +webkit[1];\n\n  var test = [];\n  var un$Sort = functionUncurryThis(test.sort);\n  var push = functionUncurryThis(test.push);\n\n  // IE8-\n  var FAILS_ON_UNDEFINED = fails(function () {\n    test.sort(undefined);\n  });\n  // V8 bug\n  var FAILS_ON_NULL = fails(function () {\n    test.sort(null);\n  });\n  // Old WebKit\n  var STRICT_METHOD = arrayMethodIsStrict('sort');\n\n  var STABLE_SORT = !fails(function () {\n    // feature detection can be too slow, so check engines versions\n    if (engineV8Version) return engineV8Version < 70;\n    if (engineFfVersion && engineFfVersion > 3) return;\n    if (engineIsIeOrEdge) return true;\n    if (engineWebkitVersion) return engineWebkitVersion < 603;\n\n    var result = '';\n    var code, chr, value, index;\n\n    // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n    for (code = 65; code < 76; code++) {\n      chr = String.fromCharCode(code);\n\n      switch (code) {\n        case 66: case 69: case 70: case 72: value = 3; break;\n        case 68: case 71: value = 4; break;\n        default: value = 2;\n      }\n\n      for (index = 0; index < 47; index++) {\n        test.push({ k: chr + index, v: value });\n      }\n    }\n\n    test.sort(function (a, b) { return b.v - a.v; });\n\n    for (index = 0; index < test.length; index++) {\n      chr = test[index].k.charAt(0);\n      if (result.charAt(result.length - 1) !== chr) result += chr;\n    }\n\n    return result !== 'DGBEFHACIJK';\n  });\n\n  var FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\n  var getSortCompare = function (comparefn) {\n    return function (x, y) {\n      if (y === undefined) return -1;\n      if (x === undefined) return 1;\n      if (comparefn !== undefined) return +comparefn(x, y) || 0;\n      return toString_1(x) > toString_1(y) ? 1 : -1;\n    };\n  };\n\n  // `Array.prototype.sort` method\n  // https://tc39.es/ecma262/#sec-array.prototype.sort\n  _export({ target: 'Array', proto: true, forced: FORCED }, {\n    sort: function sort(comparefn) {\n      if (comparefn !== undefined) aCallable(comparefn);\n\n      var array = toObject(this);\n\n      if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n      var items = [];\n      var arrayLength = lengthOfArrayLike(array);\n      var itemsLength, index;\n\n      for (index = 0; index < arrayLength; index++) {\n        if (index in array) push(items, array[index]);\n      }\n\n      arraySort(items, getSortCompare(comparefn));\n\n      itemsLength = items.length;\n      index = 0;\n\n      while (index < itemsLength) array[index] = items[index++];\n      while (index < arrayLength) delete array[index++];\n\n      return array;\n    }\n  });\n\n  /**\n   * Finds all Intro steps from the data-* attributes and the options.steps array\n   *\n   * @api private\n   * @param targetElm\n   * @returns {[]}\n   */\n\n  function fetchIntroSteps(targetElm) {\n    var _this = this;\n\n    var allIntroSteps = targetElm.querySelectorAll(\"*[data-intro]\");\n    var introItems = [];\n\n    if (this._options.steps) {\n      //use steps passed programmatically\n      forEach(this._options.steps, function (step) {\n        var currentItem = cloneObject(step); //set the step\n\n        currentItem.step = introItems.length + 1;\n        currentItem.title = currentItem.title || \"\"; //use querySelector function only when developer used CSS selector\n\n        if (typeof currentItem.element === \"string\") {\n          //grab the element with given selector from the page\n          currentItem.element = document.querySelector(currentItem.element);\n        } //intro without element\n\n\n        if (typeof currentItem.element === \"undefined\" || currentItem.element === null) {\n          var floatingElementQuery = document.querySelector(\".introjsFloatingElement\");\n\n          if (floatingElementQuery === null) {\n            floatingElementQuery = _createElement(\"div\", {\n              className: \"introjsFloatingElement\"\n            });\n            document.body.appendChild(floatingElementQuery);\n          }\n\n          currentItem.element = floatingElementQuery;\n          currentItem.position = \"floating\";\n        }\n\n        currentItem.position = currentItem.position || _this._options.tooltipPosition;\n        currentItem.scrollTo = currentItem.scrollTo || _this._options.scrollTo;\n\n        if (typeof currentItem.disableInteraction === \"undefined\") {\n          currentItem.disableInteraction = _this._options.disableInteraction;\n        }\n\n        if (currentItem.element !== null) {\n          introItems.push(currentItem);\n        }\n      });\n    } else {\n      //use steps from data-* annotations\n      var elmsLength = allIntroSteps.length;\n      var disableInteraction; //if there's no element to intro\n\n      if (elmsLength < 1) {\n        return [];\n      }\n\n      forEach(allIntroSteps, function (currentElement) {\n        // start intro for groups of elements\n        if (_this._options.group && currentElement.getAttribute(\"data-intro-group\") !== _this._options.group) {\n          return;\n        } // skip hidden elements\n\n\n        if (currentElement.style.display === \"none\") {\n          return;\n        }\n\n        var step = parseInt(currentElement.getAttribute(\"data-step\"), 10);\n\n        if (currentElement.hasAttribute(\"data-disable-interaction\")) {\n          disableInteraction = !!currentElement.getAttribute(\"data-disable-interaction\");\n        } else {\n          disableInteraction = _this._options.disableInteraction;\n        }\n\n        if (step > 0) {\n          introItems[step - 1] = {\n            element: currentElement,\n            title: currentElement.getAttribute(\"data-title\") || \"\",\n            intro: currentElement.getAttribute(\"data-intro\"),\n            step: parseInt(currentElement.getAttribute(\"data-step\"), 10),\n            tooltipClass: currentElement.getAttribute(\"data-tooltipclass\"),\n            highlightClass: currentElement.getAttribute(\"data-highlightclass\"),\n            position: currentElement.getAttribute(\"data-position\") || _this._options.tooltipPosition,\n            scrollTo: currentElement.getAttribute(\"data-scrollto\") || _this._options.scrollTo,\n            disableInteraction: disableInteraction\n          };\n        }\n      }); //next add intro items without data-step\n      //todo: we need a cleanup here, two loops are redundant\n\n      var nextStep = 0;\n      forEach(allIntroSteps, function (currentElement) {\n        // start intro for groups of elements\n        if (_this._options.group && currentElement.getAttribute(\"data-intro-group\") !== _this._options.group) {\n          return;\n        }\n\n        if (currentElement.getAttribute(\"data-step\") === null) {\n          while (true) {\n            if (typeof introItems[nextStep] === \"undefined\") {\n              break;\n            } else {\n              nextStep++;\n            }\n          }\n\n          if (currentElement.hasAttribute(\"data-disable-interaction\")) {\n            disableInteraction = !!currentElement.getAttribute(\"data-disable-interaction\");\n          } else {\n            disableInteraction = _this._options.disableInteraction;\n          }\n\n          introItems[nextStep] = {\n            element: currentElement,\n            title: currentElement.getAttribute(\"data-title\") || \"\",\n            intro: currentElement.getAttribute(\"data-intro\"),\n            step: nextStep + 1,\n            tooltipClass: currentElement.getAttribute(\"data-tooltipclass\"),\n            highlightClass: currentElement.getAttribute(\"data-highlightclass\"),\n            position: currentElement.getAttribute(\"data-position\") || _this._options.tooltipPosition,\n            scrollTo: currentElement.getAttribute(\"data-scrollto\") || _this._options.scrollTo,\n            disableInteraction: disableInteraction\n          };\n        }\n      });\n    } //removing undefined/null elements\n\n\n    var tempIntroItems = [];\n\n    for (var z = 0; z < introItems.length; z++) {\n      if (introItems[z]) {\n        // copy non-falsy values to the end of the array\n        tempIntroItems.push(introItems[z]);\n      }\n    }\n\n    introItems = tempIntroItems; //Ok, sort all items with given steps\n\n    introItems.sort(function (a, b) {\n      return a.step - b.step;\n    });\n    return introItems;\n  }\n\n  /**\n   * Update placement of the intro objects on the screen\n   * @api private\n   * @param {boolean} refreshSteps to refresh the intro steps as well\n   */\n\n  function refresh(refreshSteps) {\n    var referenceLayer = document.querySelector(\".introjs-tooltipReferenceLayer\");\n    var helperLayer = document.querySelector(\".introjs-helperLayer\");\n    var disableInteractionLayer = document.querySelector(\".introjs-disableInteraction\"); // re-align intros\n\n    setHelperLayerPosition.call(this, helperLayer);\n    setHelperLayerPosition.call(this, referenceLayer);\n    setHelperLayerPosition.call(this, disableInteractionLayer);\n\n    if (refreshSteps) {\n      this._introItems = fetchIntroSteps.call(this, this._targetElement);\n\n      _recreateBullets.call(this, referenceLayer, this._introItems[this._currentStep]);\n\n      _updateProgressBar.call(this, referenceLayer);\n    } // re-align tooltip\n\n\n    if (this._currentStep !== undefined && this._currentStep !== null) {\n      var oldArrowLayer = document.querySelector(\".introjs-arrow\");\n      var oldtooltipContainer = document.querySelector(\".introjs-tooltip\");\n\n      if (oldtooltipContainer && oldArrowLayer) {\n        placeTooltip.call(this, this._introItems[this._currentStep].element, oldtooltipContainer, oldArrowLayer);\n      }\n    } //re-align hints\n\n\n    reAlignHints.call(this);\n    return this;\n  }\n\n  function onResize() {\n    refresh.call(this);\n  }\n\n  /**\n   * Removes `element` from `parentElement`\n   *\n   * @param {Element} element\n   * @param {Boolean} [animate=false]\n   */\n\n  function removeChild(element, animate) {\n    if (!element || !element.parentElement) return;\n    var parentElement = element.parentElement;\n\n    if (animate) {\n      setStyle(element, {\n        opacity: \"0\"\n      });\n      window.setTimeout(function () {\n        try {\n          // removeChild(..) throws an exception if the child has already been removed (https://developer.mozilla.org/en-US/docs/Web/API/Node/removeChild)\n          // this try-catch is added to make sure this function doesn't throw an exception if the child has been removed\n          // this scenario can happen when start()/exit() is called multiple times and the helperLayer is removed by the\n          // previous exit() call (note: this is a timeout)\n          parentElement.removeChild(element);\n        } catch (e) {}\n      }, 500);\n    } else {\n      parentElement.removeChild(element);\n    }\n  }\n\n  /**\n   * Exit from intro\n   *\n   * @api private\n   * @method _exitIntro\n   * @param {Object} targetElement\n   * @param {Boolean} force - Setting to `true` will skip the result of beforeExit callback\n   */\n\n  function exitIntro(targetElement, force) {\n    var continueExit = true; // calling onbeforeexit callback\n    //\n    // If this callback return `false`, it would halt the process\n\n    if (this._introBeforeExitCallback !== undefined) {\n      continueExit = this._introBeforeExitCallback.call(this);\n    } // skip this check if `force` parameter is `true`\n    // otherwise, if `onbeforeexit` returned `false`, don't exit the intro\n\n\n    if (!force && continueExit === false) return; // remove overlay layers from the page\n\n    var overlayLayers = targetElement.querySelectorAll(\".introjs-overlay\");\n\n    if (overlayLayers && overlayLayers.length) {\n      forEach(overlayLayers, function (overlayLayer) {\n        return removeChild(overlayLayer);\n      });\n    } //remove all helper layers\n\n\n    var helperLayer = targetElement.querySelector(\".introjs-helperLayer\");\n    removeChild(helperLayer, true);\n    var referenceLayer = targetElement.querySelector(\".introjs-tooltipReferenceLayer\");\n    removeChild(referenceLayer); //remove disableInteractionLayer\n\n    var disableInteractionLayer = targetElement.querySelector(\".introjs-disableInteraction\");\n    removeChild(disableInteractionLayer); //remove intro floating element\n\n    var floatingElement = document.querySelector(\".introjsFloatingElement\");\n    removeChild(floatingElement);\n    removeShowElement(); //clean listeners\n\n    DOMEvent.off(window, \"keydown\", onKeyDown, this, true);\n    DOMEvent.off(window, \"resize\", onResize, this, true); //check if any callback is defined\n\n    if (this._introExitCallback !== undefined) {\n      this._introExitCallback.call(this);\n    } //set the step to zero\n\n\n    this._currentStep = undefined;\n  }\n\n  /**\n   * Add overlay layer to the page\n   *\n   * @api private\n   * @method _addOverlayLayer\n   * @param {Object} targetElm\n   */\n\n  function addOverlayLayer(targetElm) {\n    var _this = this;\n\n    var overlayLayer = _createElement(\"div\", {\n      className: \"introjs-overlay\"\n    });\n    setStyle(overlayLayer, {\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      position: \"fixed\"\n    });\n    targetElm.appendChild(overlayLayer);\n\n    if (this._options.exitOnOverlayClick === true) {\n      setStyle(overlayLayer, {\n        cursor: \"pointer\"\n      });\n\n      overlayLayer.onclick = function () {\n        exitIntro.call(_this, targetElm);\n      };\n    }\n\n    return true;\n  }\n\n  /**\n   * Initiate a new introduction/guide from an element in the page\n   *\n   * @api private\n   * @method introForElement\n   * @param {Object} targetElm\n   * @returns {Boolean} Success or not?\n   */\n\n  function introForElement(targetElm) {\n    if (this._introStartCallback !== undefined) {\n      this._introStartCallback.call(this, targetElm);\n    } //set it to the introJs object\n\n\n    var steps = fetchIntroSteps.call(this, targetElm);\n\n    if (steps.length === 0) {\n      return false;\n    }\n\n    this._introItems = steps; //add overlay layer to the page\n\n    if (addOverlayLayer.call(this, targetElm)) {\n      //then, start the show\n      nextStep.call(this);\n\n      if (this._options.keyboardNavigation) {\n        DOMEvent.on(window, \"keydown\", onKeyDown, this, true);\n      } //for window resize\n\n\n      DOMEvent.on(window, \"resize\", onResize, this, true);\n    }\n\n    return false;\n  }\n\n  var version = \"4.3.0\";\n\n  /**\n   * IntroJs main class\n   *\n   * @class IntroJs\n   */\n\n  function IntroJs(obj) {\n    this._targetElement = obj;\n    this._introItems = [];\n    this._options = {\n      /* Next button label in tooltip box */\n      nextLabel: \"Next\",\n\n      /* Previous button label in tooltip box */\n      prevLabel: \"Back\",\n\n      /* Skip button label in tooltip box */\n      skipLabel: \"\",\n\n      /* Done button label in tooltip box */\n      doneLabel: \"Done\",\n\n      /* Hide previous button in the first step? Otherwise, it will be disabled button. */\n      hidePrev: false,\n\n      /* Hide next button in the last step? Otherwise, it will be disabled button (note: this will also hide the \"Done\" button) */\n      hideNext: false,\n\n      /* Change the Next button to Done in the last step of the intro? otherwise, it will render a disabled button */\n      nextToDone: true,\n\n      /* Default tooltip box position */\n      tooltipPosition: \"bottom\",\n\n      /* Next CSS class for tooltip boxes */\n      tooltipClass: \"\",\n\n      /* Start intro for a group of elements */\n      group: \"\",\n\n      /* CSS class that is added to the helperLayer */\n      highlightClass: \"\",\n\n      /* Close introduction when pressing Escape button? */\n      exitOnEsc: true,\n\n      /* Close introduction when clicking on overlay layer? */\n      exitOnOverlayClick: true,\n\n      /* Show step numbers in introduction? */\n      showStepNumbers: false,\n\n      /* Let user use keyboard to navigate the tour? */\n      keyboardNavigation: true,\n\n      /* Show tour control buttons? */\n      showButtons: true,\n\n      /* Show tour bullets? */\n      showBullets: true,\n\n      /* Show tour progress? */\n      showProgress: false,\n\n      /* Scroll to highlighted element? */\n      scrollToElement: true,\n\n      /*\n       * Should we scroll the tooltip or target element?\n       *\n       * Options are: 'element' or 'tooltip'\n       */\n      scrollTo: \"element\",\n\n      /* Padding to add after scrolling when element is not in the viewport (in pixels) */\n      scrollPadding: 30,\n\n      /* Set the overlay opacity */\n      overlayOpacity: 0.5,\n\n      /* To determine the tooltip position automatically based on the window.width/height */\n      autoPosition: true,\n\n      /* Precedence of positions, when auto is enabled */\n      positionPrecedence: [\"bottom\", \"top\", \"right\", \"left\"],\n\n      /* Disable an interaction with element? */\n      disableInteraction: false,\n\n      /* Set how much padding to be used around helper element */\n      helperElementPadding: 10,\n\n      /* Default hint position */\n      hintPosition: \"top-middle\",\n\n      /* Hint button label */\n      hintButtonLabel: \"Got it\",\n\n      /* Display the \"Got it\" button? */\n      hintShowButton: true,\n\n      /* Hints auto-refresh interval in ms (set to -1 to disable) */\n      hintAutoRefreshInterval: 10,\n\n      /* Adding animation to hints? */\n      hintAnimation: true,\n\n      /* additional classes to put on the buttons */\n      buttonClass: \"introjs-button\",\n\n      /* additional classes to put on progress bar */\n      progressBarAdditionalClass: false\n    };\n  }\n\n  var introJs = function introJs(targetElm) {\n    var instance;\n\n    if (_typeof(targetElm) === \"object\") {\n      //Ok, create a new instance\n      instance = new IntroJs(targetElm);\n    } else if (typeof targetElm === \"string\") {\n      //select the target element with query selector\n      var targetElement = document.querySelector(targetElm);\n\n      if (targetElement) {\n        instance = new IntroJs(targetElement);\n      } else {\n        throw new Error(\"There is no element with given selector.\");\n      }\n    } else {\n      instance = new IntroJs(document.body);\n    } // add instance to list of _instances\n    // passing group to stamp to increment\n    // from 0 onward somewhat reliably\n\n\n    introJs.instances[stamp(instance, \"introjs-instance\")] = instance;\n    return instance;\n  };\n  /**\n   * Current IntroJs version\n   *\n   * @property version\n   * @type String\n   */\n\n\n  introJs.version = version;\n  /**\n   * key-val object helper for introJs instances\n   *\n   * @property instances\n   * @type Object\n   */\n\n  introJs.instances = {}; //Prototype\n\n  introJs.fn = IntroJs.prototype = {\n    clone: function clone() {\n      return new IntroJs(this);\n    },\n    setOption: function setOption(option, value) {\n      this._options[option] = value;\n      return this;\n    },\n    setOptions: function setOptions(options) {\n      this._options = mergeOptions(this._options, options);\n      return this;\n    },\n    start: function start() {\n      introForElement.call(this, this._targetElement);\n      return this;\n    },\n    goToStep: function goToStep$1(step) {\n      goToStep.call(this, step);\n\n      return this;\n    },\n    addStep: function addStep(options) {\n      if (!this._options.steps) {\n        this._options.steps = [];\n      }\n\n      this._options.steps.push(options);\n\n      return this;\n    },\n    addSteps: function addSteps(steps) {\n      if (!steps.length) return;\n\n      for (var index = 0; index < steps.length; index++) {\n        this.addStep(steps[index]);\n      }\n\n      return this;\n    },\n    goToStepNumber: function goToStepNumber$1(step) {\n      goToStepNumber.call(this, step);\n\n      return this;\n    },\n    nextStep: function nextStep$1() {\n      nextStep.call(this);\n\n      return this;\n    },\n    previousStep: function previousStep$1() {\n      previousStep.call(this);\n\n      return this;\n    },\n    currentStep: function currentStep$1() {\n      return currentStep.call(this);\n    },\n    exit: function exit(force) {\n      exitIntro.call(this, this._targetElement, force);\n      return this;\n    },\n    refresh: function refresh$1(refreshSteps) {\n      refresh.call(this, refreshSteps);\n\n      return this;\n    },\n    onbeforechange: function onbeforechange(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introBeforeChangeCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onbeforechange was not a function\");\n      }\n\n      return this;\n    },\n    onchange: function onchange(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introChangeCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onchange was not a function.\");\n      }\n\n      return this;\n    },\n    onafterchange: function onafterchange(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introAfterChangeCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onafterchange was not a function\");\n      }\n\n      return this;\n    },\n    oncomplete: function oncomplete(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introCompleteCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for oncomplete was not a function.\");\n      }\n\n      return this;\n    },\n    onhintsadded: function onhintsadded(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._hintsAddedCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onhintsadded was not a function.\");\n      }\n\n      return this;\n    },\n    onhintclick: function onhintclick(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._hintClickCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onhintclick was not a function.\");\n      }\n\n      return this;\n    },\n    onhintclose: function onhintclose(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._hintCloseCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onhintclose was not a function.\");\n      }\n\n      return this;\n    },\n    onstart: function onstart(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introStartCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onstart was not a function.\");\n      }\n\n      return this;\n    },\n    onexit: function onexit(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introExitCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onexit was not a function.\");\n      }\n\n      return this;\n    },\n    onskip: function onskip(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introSkipCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onskip was not a function.\");\n      }\n\n      return this;\n    },\n    onbeforeexit: function onbeforeexit(providedCallback) {\n      if (typeof providedCallback === \"function\") {\n        this._introBeforeExitCallback = providedCallback;\n      } else {\n        throw new Error(\"Provided callback for onbeforeexit was not a function.\");\n      }\n\n      return this;\n    },\n    addHints: function addHints() {\n      populateHints.call(this, this._targetElement);\n      return this;\n    },\n    hideHint: function hideHint$1(stepId) {\n      hideHint.call(this, stepId);\n\n      return this;\n    },\n    hideHints: function hideHints$1() {\n      hideHints.call(this);\n\n      return this;\n    },\n    showHint: function showHint$1(stepId) {\n      showHint.call(this, stepId);\n\n      return this;\n    },\n    showHints: function showHints$1() {\n      showHints.call(this);\n\n      return this;\n    },\n    removeHints: function removeHints$1() {\n      removeHints.call(this);\n\n      return this;\n    },\n    removeHint: function removeHint$1(stepId) {\n      removeHint().call(this, stepId);\n\n      return this;\n    },\n    showHintDialog: function showHintDialog$1(stepId) {\n      showHintDialog.call(this, stepId);\n\n      return this;\n    }\n  };\n\n  return introJs;\n\n}));\n","const ZWEI = {};\n\nZWEI.templates = {\n    \"skill\": \"systems/zweihander/templates/chat/chat-skill.hbs\",\n    \"spell\": \"systems/zweihander/templates/chat/chat-spell.hbs\",\n    \"parry\": \"systems/zweihander/templates/chat/chat-parry.hbs\",\n    \"dodge\": \"systems/zweihander/templates/chat/chat-dodge.hbs\",\n    \"weapon\": \"systems/zweihander/templates/chat/chat-weapon.hbs\",\n    \"skillConfigurationDialog\": \"systems/zweihander/templates/dialog/dialog-skill-configuration.hbs\",\n    \"spellConfigurationDialog\": \"systems/zweihander/templates/dialog/dialog-spell-configuration.hbs\",\n    \"weaponConfigurationDialog\": \"systems/zweihander/templates/dialog/dialog-weapon-configuration.hbs\"\n};\n\nZWEI.rollTypes = {\n    \"skill\": \"skill\",\n    \"spell\": \"spell\",\n    \"parry\": \"parry\",\n    \"dodge\": \"dodge\",\n    \"weapon\": \"weapon\"\n};\n\nZWEI.testRollFormula = \"1d100\";\n\nexport default ZWEI;","/**\n* An implementation of the Zweihnder Grim & Perilous RPG system for FoundryVTT\n* Author: Re4XN\n*/\n\nimport ZweihanderActor from \"./actor/actor\";\nimport ZweihanderActorSheet from \"./actor/sheet/actor-sheet\";\nimport ZweihanderActorConfig from \"./apps/actor-config\";\nimport ZweihanderNpcSheet from \"./actor/sheet/npc-sheet\";\nimport ZweihanderCreatureSheet from \"./actor/sheet/creature-sheet\";\nimport ZweihanderItem from \"./item/item\";\nimport ZweihanderItemSheet from \"./item/sheet/item-sheet\";\nimport FortuneTracker from \"./apps/fortune-tracker\";\nimport * as ZweihanderUtils from \"./utils\";\n\nimport { registerSystemSettings } from \"./settings\";\nimport { preloadHandlebarsTemplates } from \"./template\";\nimport { registerHandlebarHelpers } from \"./helpers\";\nimport { migrateWorldSafe, migrateWorld } from \"./migration\"\nimport { introJs } from \"./utils/intros\";\n\nimport ZWEI from \"./constants.js\";\n\nimport \"../styles/main.scss\"\n\nlet fortuneTrackerApp;\n\n/* -------------------------------------------- */\n/*  Foundry VTT Initialization                  */\n/* -------------------------------------------- */\nHooks.once(\"socketlib.ready\", () => {\n  FortuneTracker.registerPersistingSettings();\n  const socket = socketlib.registerSystem(\"zweihander\");\n  fortuneTrackerApp = new FortuneTracker(socket);\n});\n\nHooks.once(\"ready\", function () {\n  // this is necessary to apply the theme settings\n  // TODO: refactor into own utility-function/class\n  let sheetStyles = game.settings.get(\"zweihander\", \"theme\");\n  game.settings.set(\"zweihander\", \"theme\", sheetStyles);\n  fortuneTrackerApp?.syncState();//.then(() => introJs().start());\n  migrateWorldSafe();\n})\n\nHooks.once(\"init\", async function () {\n  // CONFIG.debug.hooks = true;\n  console.log(`Initializing ZWEIHNDER: Grim & Perilous RPG System`);\n  game.zweihander = {\n    ZweihanderActor,\n    ZweihanderItem,\n    find: ZweihanderUtils.findItemsWorldWide,\n    fortuneTrackerApp,\n    migrate: migrateWorld,\n    introJs: introJs\n  };\n  CONFIG.ChatMessage.template = \"systems/zweihander/templates/chat/chat-message.hbs\";\n  /**\n  * Set an initiative formula for the system\n  * @type {String}\n  */\n  CONFIG.Combat.initiative = {\n    formula: \"1d10 + @stats.secondaryAttributes.initiative.current\",\n    decimals: 2\n  };\n  //TODO probably better to export / import those constants rather than setting on global object.\n  CONFIG.ZWEI = ZWEI;\n  // Define custom Document classes\n  CONFIG.Actor.documentClass = ZweihanderActor;\n  CONFIG.Item.documentClass = ZweihanderItem;\n  // Register sheet application classes\n  Actors.unregisterSheet(\"core\", ActorSheet);\n  Actors.registerSheet(\"zweihander\", ZweihanderActorSheet, { \"types\": [\"character\"], makeDefault: true });\n  Actors.registerSheet(\"zweihander\", ZweihanderNpcSheet, { \"types\": [\"npc\"], makeDefault: true });\n  Actors.registerSheet(\"zweihander\", ZweihanderCreatureSheet, { \"types\": [\"creature\"], makeDefault: true });\n  Items.unregisterSheet(\"core\", ItemSheet);\n  Items.registerSheet(\"zweihander\", ZweihanderItemSheet, { makeDefault: true });\n  // Register settings\n  registerSystemSettings();\n  // Register Helpers\n  await registerHandlebarHelpers();\n  // Register Templates\n  return preloadHandlebarsTemplates();\n});\n\n\nHooks.on(\"renderActorSheet\", (app, html, data) => {\n  //TODO: refactor into actor config class\n  html.find(\".header-button.configure-sheet\").before(`\n  <a class=\"configure-actor\">\n  <i class=\"fas fa-user-cog\"></i>\n  Actor\n  </a>\n  `);\n\n  html.find(\".configure-actor\").click(() => {\n    new ZweihanderActorConfig(app.object).render(true);\n  })\n});\n\nHooks.on(\"renderChatLog\", function (log, html, data) {\n  // TODO: Refactor into Dice class\n\n  $(html).on(\"click\", \".link-details\", (event) => {\n    event.preventDefault();\n\n    const toggler = $(event.currentTarget);\n    const rollDetails = toggler.parents(\".content\").find(\".roll-details\");\n\n    $(rollDetails).slideToggle();\n  });\n});"],"names":["findDifference","datasetA","datasetB","let","diffArray","elementA","some","elementB","name","push","getSymmetricDifference","concat","isObjectEmpty","object","Object","keys","length","primaryAttributeMapping","C","B","A","P","I","W","F","abbreviations2DataPath","str","includeFlavor","key","x","replace","slice","toUpperCase","diacriticsMap","defaultDiacriticsRemovalMap","base","letters","i","j","removeDiacritics","a","normalizeName","toLowerCase","replaceAll","normalizedEquals","b","sortByItemSpecificity","referenceNames","packPriority","specificityScore","score","packValue","pack","includes","isOwner","partitionByNames","names","items","normalizedNames","map","Set","partitions","Array","forEach","index","indexOf","async","findItemsByType","type","takeOne","filterFn","sortFn","partitionFn","filterExpression","packItems","Promise","all","game","packs","filter","documentClass","documentName","getDocuments","flatMap","worldItems","collections","get","item","allItems","p","sort","bin","findItemsWorldWide","opt","findItemWorldWide","then","ZweihanderBaseActor","prepareEmbeddedEntities","actorData","getRollData","rollData","buildPerilDamageLadder","data","initialPeril","initialDamage","ladderIncrement","stats","secondaryAttributes","perilThreshold","damageThreshold","v","getPerilMalus","0","1","2","3","perilCurrent","value","createEmbeddedDocuments","embeddedName","context","actor","filteredData","ancestryAttached","ancestry","numberOfProfessionsAttached","professions","previousTiersCompleted","allTiersAssigned","dragDroppedOwnProfession","profession","tier","completed","every","_id","ui","notifications","error","ZweihanderActorConfig","FormApplication","defaultConfiguration","dthAttribute","pthAttribute","intAttribute","movAttribute","perilOffset","encumbranceModifier","initiativeModifier","movementModifier","parrySkills","dodgeSkills","magickSkills","getValue","getProperty","flags","this","getConfig","cfg","defaultOptions","foundry","utils","mergeObject","super","classes","id","template","width","title","getData","join","_updateObject","event","formData","updateData","expandObject","split","skill","trim","setFlag","ZweihanderPC","prepareBaseData","that","indexedTypes","pluralize","t","injury","armor","quality","toObject","skills","localeCompare","prepareDerivedData","noWarn","configOptions","derived","settings","tierMultiplier","Basic","Intermediate","Advanced","rewardPoints","spent","advancesPurchased","uniqueAdvances","advance","rewardPointCost","reduce","current","total","values","primaryAttributes","bonus","Math","floor","applyBonusModifiers","list","mod","source","attr","ZweihanderUtils.primaryAttributeMapping","warn","ancestralModifiers","positive","negative","advancesList","bonusAdvances","purchased","equippedArmor","equipped","dtm","max","damageThresholdModifier","damageModifier","perilMalus","calcSecondayAttributeSpecialActionValue","secAttr","find","associatedSkill","primAttr","associatedPrimaryAttribute","parry","dodge","magick","carriedTrappings","trappings","carried","weapon","smallTrappingsEnc","encumbrance","quantity","normalTrappingsEnc","coinageEnc","entries","coinage","e","armorEnc","weaponEnc","weapons","w","enc","brawn","overage","ini","initiative","mov","movement","qualities","arrayOfValues","_preCreate","options","user","skillPack","toAdd","toAddDifference","ZweihanderUtils.getSymmetricDifference","update","ZweihanderCreature","spells","rituals","talents","traits","injuries","conditions","skillA","skillB","nameA","nameB","willpower","perilModifier","perilArray","damageArray","ZweihanderNPC","ZweihanderActor","Actor","types","character","npc","creature","constructor","args","dispatch","fnName","orElse","resolve","prepareData","prepareEmbeddedDocuments","applyActiveEffects","_onCreate","enrichedData","updateEmbeddedDocuments","updates","enrichedUpdates","deleteEmbeddedDocuments","ids","_preCreateEmbeddedDocuments","result","userId","_onCreateEmbeddedDocuments","documents","_preUpdateEmbeddedDocuments","_onUpdateEmbeddedDocuments","_preDeleteEmbeddedDocuments","_onDeleteEmbeddedDocuments","ZweihanderDice","rollSkillTest","skillItem","rollType","optionalData","primaryAttribute","rollTarget","rankBonus","currentPeril","Number","perilPenalty","_calculatePerilPenalty","baseChanceModifier","_calculateBaseChanceModifier","rollConfig","_renderConfigurationDialog","additionalChaosDice","additionalFuryDice","difficultyRating","channelPowerBonus","difficultyRatingLabel","_getDifficultyRatingLabel","flip","totalChance","_calculateTotalChance","roll","Roll","CONFIG","ZWEI","testRollFormula","rollResult","evaluate","rollResultTotal","_total","deconstructedRollData","_getDeconstructedRollData","testResult","_getTestResult","match","finalRoll","showFlip","finalTestResult","_handleFlippedResult","damageData","chaosData","formula","ZweihanderUtils.abbreviations2DataPath","damageRoll","_rollFuryDice","indexedDiceTerms","terms","number","faces","explodedTerms","indexedDiceTerm","results","exploded","furyDiceString","damage","damageFormula","additionalRoll","numberOfDice","chaosRoll","_rollChaosDice","chaosFormula","_formula","chaosDice","dice","render","templateData","attributeChance","baseChance","label","toLocaleString","undefined","minimumIntegerDigits","image","img","ZweihanderUtils.isObjectEmpty","_getTemplate","rollOrder","rolls","pool","PoolTerm","fromRolls","fromTerms","_renderChatCard","renderTemplate","html","chatData","CONST","CHAT_MESSAGE_TYPES","ROLL","speaker","ChatMessage","getSpeaker","content","create","templates","skillConfigurationDialog","c","_createDialog","val","spellConfigurationDialog","weaponConfigurationDialog","callbackOnYes","Dialog","buttons","no","icon","yes","callback","default","stringifiedRollValue","units","charAt","tens","spell","flippedRoll","min","ZweihanderActorSheet","ActorSheet","height","resizable","tabs","navSelector","contentSelector","initial","scrollY","owner","editable","isEditable","bind","rankOptions","4","5","6","7","8","9","perilOptions","damageOptions","addSource","zweihander","isManualSource","sortSort","drawbacks","diseases","disorders","bio","flavor","description","purchasedTalents","linkedId","damageThresholdAttribute","perilThresholdAttribute","initiativeAttribute","movementAttribute","activateListeners","click","ev","li","$","currentTarget","parents","sheet","confirm","slideUp","defaultYes","hover","target","attributes","addClass","removeClass","dataset","itemType","createdItemArray","ancestryId","ancestryItem","bringToTop","each","initialValue","text","evaluatedValue","preventDefault","closest","data.equipped","checked","data.tier.completed","data.carried","data.active","_updateDamageThresholdLabel","contextmenu","skillName","itemId","field","professionElement","professionItem","updated","data.chaosRanks.value","data.orderRanks.value","_updateEncumbranceMeter","_damageSheet","_perilSheet","_showItemDescription","_onRollSkill","rollTypes","ZweihanderUtils.findItemWorldWide","damageCurrent","toggleClass","element","findIndex","weaponId","weaponItem","weaponData","weaponQualities","weaponItemData","weaponName","primaryAttributeBonus","spellId","spellItem","spellData","spellName","spellItemData","principle","duration","_formatDuration","distance","effect","reagents","tradition","contents","setDuration","toggler","slideToggle","dtmLabel","encumbranceData","ratio","css","_render","force","toIterate","_saveToggleStates","_setToggleStates","form","parent","toggleStates","elements","isOpen","hasClass","show","ZweihanderNpcSheet","dtypes","itemName","children","_setThresholds","_alternateRowColor","derivedPeril","derivedDamage","ZweihanderCreatureSheet","ZweihanderBaseItem","_getOrCreateLinkedItem","sourceName","sourceType","itemToAdd","existingItemWithSameName","flag","capitalize","setProperty","kind","existingFlag","getFlag","getOrCreateLinkedItem","getOrCreateLinkedItems","itemNames","itemsToCreate","resultMap","normalizedItemName","ZweihanderUtils.normalizeName","y","removeLinkedItem","removeLinkedItems","array","linkedIds","updateLinkedItemIds","linkedItems","ZweihanderUtils.normalizedEquals","getLinkedItemsDifference","newArray","oldArray","arrayMinusByName","namesToAdd","idsToDelete","ZweihanderWeapon","ZweihanderProfession","itemData","isOwned","skillRanks","data.tier.value","data.skillRanks","sr","data.bonusAdvances","ba","talentsToFetch","data.talents","professionalTraitToFetch","professionalTrait","specialTraitToFetch","specialTrait","data.professionalTrait","data.specialTrait","drawbackToFetch","drawback","data.drawback","_preUpdate","changed","diffData","trait","diffPaths","flattenObject","talentsDiff","addedTalents","lookUp","newTrait","newDrawback","_onUpdate","_preDelete","_onDelete","ZweihanderSkill","timesPurchased","rank","ZweihanderAncestry","ancestralTrait","data.ancestralTrait","updatedField","idToDelete","ZweihanderItem","Item","ZweihanderItemSheet","ItemSheet","dragDrop","dragSelector","dropSelector","_canDragStart","selector","_canDragDrop","_onDragDrop","_onDragStart","dragData","actorId","ceneId","isToken","canvas","scene","tokenId","token","dataTransfer","setData","JSON","stringify","ZweihanderUtils.findItemsByType","fp","FilePicker","displayMode","path","document","group","editor","preview","keypress","which","acceptArrayInput","focusout","removeArrayInput","permanent","profTrait","specTrait","prevent","arrayInput","input","MAX_SAFE_INTEGER","inputs","caption","splice","addInputToArray","validateBonusAbbr","vx","validateTalent","validateSkillRank","validationFn","unique","validatedInput","bonusAbbr","validValues","sanitized","talent","foundItem","skillRank","FortuneTracker","Application","PARAMS","compact","tokenSize","padding","areaSize","registerPersistingSettings","register","hint","scope","config","String","choices","remove","keep","none","notify","chat","normal","big","huge","#waiting","#state","used","removed","#socket","#positions","#closable","popOut","top","left","socket","state","requestingUserId","validationError","validate","executeForEveryone","executeAsUser","generateRandomPositionValues","resetRule","rules","updatedState","playAudio","users","isGM","set","closable","increaseTotal","s","decreaseTotal","spendFortune","spendMisfortune","fortune","misfortune","keepFortune","keepMisfortune","m","ceil","random","notifySetting","charname","info","fortunePositions","l","misfortunePositions","positions","waiting","params","syncState","executeForOthers","requestSync","resetState","activePlayers","players","active","executeAsGM","console","close","app","totalTrigger","replaceWith","before","resetTrigger","fortuneTrigger","misfortuneTrigger","AudioHelper","play","src","volume","loop","registerSystemSettings","Boolean","gruvbox-dark","gruvbox-light","onChange","theme","startsWith","preloadHandlebarsTemplates","$$","loadTemplates","registerHandlebarHelpers","uuidv4","crypto","getRandomValues","Uint8Array","toString","fn","Handlebars","registerHelper","word","toCheck","isArray","inverse","idx","hash","uuid","isChecked","SafeString","elem","ranks","modifier","flipString","arrayOfDice","delimitator","highlight","expandedFormula","d","optionIdx","combat","agility","perception","intelligence","fellowship","md","window","MEME","markdownIt","endsWith","pillDisplayProperty","migrateWorld","system","version","actors","migrateActorData","log","enforceTypes","err","message","migrateItemData","migrateCompendium","entity","doc","wasLocked","locked","configure","collection","migrate","itemUpdate","migrateAncestry","migrateProfession","traitId","traitValue","data.ancestralTrait.value","data.ancestralTrait.linkedId","data.ancestralModifiers.positive","data.ancestralModifiers.negative","actorTier","profTier","purchaseAll","timesAvailable","professionalTraitValue","professionalTraitId","specialTraitValue","specialTraitId","drawbackValue","drawbackId","talentNames","data.professionalTrait.value","data.professionalTrait.linkedId","data.specialTrait.value","data.specialTrait.linkedId","data.drawback.value","data.drawback.linkedId","data.tier.-=completed","data.tier.-=advancesPurchased","professionTier","flags.zweihander.-=professionTier","migrateWorldSafe","currentVersion","totalDocuments","size","scenes","isNewerVersion","_typeof","obj","Symbol","iterator","prototype","mergeOptions","obj1","obj2","obj3","attrname","stamp","arguments","arr","forEachFnc","completeFnc","len","DOMEvent","events_key","listener","on","useCapture","apply","handler","call","addEventListener","attachEvent","off","removeEventListener","detachEvent","commonjsGlobal","globalThis","global","self","createCommonjsModule","module","exports","check","it","global_1","Function","fails","exec","descriptors","defineProperty","call$2","functionCall","$propertyIsEnumerable","propertyIsEnumerable","getOwnPropertyDescriptor$1","getOwnPropertyDescriptor","NASHORN_BUG","f$4","objectPropertyIsEnumerable","f","V","descriptor","enumerable","createPropertyDescriptor","bitmap","configurable","writable","FunctionPrototype$2","bind$2","call$1","callBind","functionUncurryThis","toString$1","stringSlice$5","classofRaw","Object$4","indexedObject","TypeError$c","TypeError","requireObjectCoercible","toIndexedObject","isCallable","argument","isObject","aFunction","getBuiltIn","namespace","method","objectIsPrototypeOf","isPrototypeOf","engineUserAgent","process","Deno","versions","v8","version$1","engineV8Version","nativeSymbol","getOwnPropertySymbols","symbol","sham","useSymbolAsUid","Object$3","isSymbol","$Symbol","String$3","tryToString","TypeError$b","aCallable","getMethod","func","TypeError$a","ordinaryToPrimitive","pref","valueOf","defineProperty$1","setGlobal","SHARED","store$1","sharedStore","shared","mode","copyright","Object$2","hasOwnProperty","hasOwnProperty_1","hasOwn","postfix","uid","WellKnownSymbolsStore","Symbol$1","symbolFor","createWellKnownSymbol","withoutSetter","wellKnownSymbol","TypeError$9","TO_PRIMITIVE","toPrimitive","exoticToPrim","toPropertyKey","document$1","EXISTS$1","createElement","documentCreateElement","ie8DomDefine","$getOwnPropertyDescriptor","f$3","objectGetOwnPropertyDescriptor","O","String$2","TypeError$8","anObject","TypeError$7","$defineProperty","f$2","objectDefineProperty","Attributes","createNonEnumerableProperty","functionToString","inspectSource","WeakMap$1","WeakMap","nativeWeakMap","test","sharedKey","hiddenKeys$1","OBJECT_ALREADY_INITIALIZED","TypeError$6","has","enforce","getterFor","TYPE","store","wmget","wmhas","wmset","metadata","facade","STATE","internalState","FunctionPrototype$1","getDescriptor","EXISTS","PROPER","CONFIGURABLE","functionName","something","redefine","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","noTargetGet","floor$2","toIntegerOrInfinity","max$3","min$4","toAbsoluteIndex","integer","min$3","toLength","lengthOfArrayLike","createMethod$2","IS_INCLUDES","$this","el","fromIndex","arrayIncludes","indexOf$1","push$4","objectKeysInternal","enumBugKeys","hiddenKeys","f$1","objectGetOwnPropertyNames","getOwnPropertyNames","objectGetOwnPropertySymbols","concat$2","ownKeys","copyConstructorProperties","replacement","isForced","feature","detection","normalize","POLYFILL","NATIVE","string","isForced_1","_export","TARGET","GLOBAL","STATIC","stat","FORCED","targetProperty","sourceProperty","forced","TO_STRING_TAG$1","test$1","toStringTagSupport","TO_STRING_TAG","Object$1","CORRECT_ARGUMENTS","tryGet","classof","tag","callee","String$1","toString_1","regexpFlags","ignoreCase","multiline","dotAll","unicode","sticky","$RegExp$2","RegExp","UNSUPPORTED_Y$2","BROKEN_CARET","regexpStickyHelpers","UNSUPPORTED_Y","re","lastIndex","objectKeys","objectDefineProperties","defineProperties","Properties","props","GT","LT","PROTOTYPE","SCRIPT","IE_PROTO","EmptyConstructor","scriptTag","NullProtoObjectViaActiveX","activeXDocument","write","temp","parentWindow","NullProtoObjectViaIFrame","iframe","JS","iframeDocument","style","display","appendChild","contentWindow","open","NullProtoObject","ActiveXObject","domain","objectCreate","$RegExp$1","regexpUnsupportedDotAll","$RegExp","regexpUnsupportedNcg","groups","nativeReplace","nativeExec","patchedExec","charAt$3","replace$1","stringSlice$4","UPDATES_LAST_INDEX_WRONG","re1","re2","UNSUPPORTED_Y$1","NPCG_INCLUDED","PATCH","raw","reCopy","charsAdded","strCopy","regexpExec","proto","SPECIES$4","RegExpPrototype$1","fixRegexpWellKnownSymbolLogic","KEY","SHAM","SYMBOL","DELEGATES_TO_SYMBOL","DELEGATES_TO_EXEC","execCalled","uncurriedNativeRegExpMethod","methods","nativeMethod","regexp","arg2","forceStringMethod","uncurriedNativeMethod","$exec","done","charAt$2","charCodeAt","stringSlice$3","createMethod$1","CONVERT_TO_STRING","pos","S","position","first","second","stringMultibyte","charAt$1","codeAt","advanceStringIndex","TypeError$5","regexpExecAbstract","R","MATCH","nativeMatch","maybeCallNative","matcher","rx","res","fullUnicode","n","matchStr","createProperty","propertyKey","noop","empty","construct","constructorRegExp","exec$1","INCORRECT_TO_STRING","isConstructorModern","isConstructorLegacy","isConstructor","called","SPECIES$3","Array$2","arraySpeciesConstructor","originalArray","arraySpeciesCreate","SPECIES$2","arrayMethodHasSpeciesSupport","METHOD_NAME","foo","IS_CONCAT_SPREADABLE","MAX_SAFE_INTEGER$1","MAXIMUM_ALLOWED_INDEX_EXCEEDED","TypeError$4","IS_CONCAT_SPREADABLE_SUPPORT","SPECIES_SUPPORT","isConcatSpreadable","spreadable","FORCED$1","objectToString","arg","k","E","PROPER_FUNCTION_NAME","TO_STRING","RegExpPrototype","n$ToString","getFlags","NOT_GENERIC","INCORRECT_NAME","rf","FunctionPrototype","bind$1","functionApply","Reflect","MATCH$1","isRegexp","isRegExp","TypeError$3","aConstructor","SPECIES$1","speciesConstructor","defaultConstructor","arraySlice","MAX_UINT32","min$2","$push","push$3","stringSlice$2","SPLIT_WORKS_WITH_OVERWRITTEN_EXEC","className","SVGElement","pre","getAttribute","setAttribute","classList","cls","add","getPropValue","propName","propValue","currentStyle","defaultView","getComputedStyle","getPropertyValue","setShowElement","_ref","currentElementPosition","getScrollParent","excludeStaticParent","overflowRegex","body","parentElement","overflow","overflowY","overflowX","scrollParentToElement","targetElement","_options","scrollToElement","scrollTop","offsetTop","getWinSize","innerWidth","innerHeight","D","documentElement","clientWidth","clientHeight","elementInViewport","rect","getBoundingClientRect","bottom","right","scrollTo","tooltipLayer","winHeight","scrollBy","scrollPadding","setAnchorAsButton","anchor","tabIndex","SPLIT","nativeSplit","internalSplit","separator","limit","lim","output","lastLastIndex","separatorCopy","lastLength","splitter","unicodeMatching","q","z","originalExec","$assign","assign","concat$1","objectAssign","alphabet","chr","T","argumentsLength","isFixed","parentNode","nodeName","getOffset","relativeEl","docEl","pageYOffset","scrollLeft","pageXOffset","xr","relativeElPosition","tagName","floor$1","stringSlice$1","SUBSTITUTION_SYMBOLS","SUBSTITUTION_SYMBOLS_NO_NAMED","getSubstitution","matched","captures","namedCaptures","tailPos","symbols","ch","capture","REPLACE","max$2","min$1","push$2","stringIndexOf$1","stringSlice","maybeToString","REPLACE_KEEPS_$0","REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE","REPLACE_SUPPORTS_NAMED_GROUPS","classNameRegex","setStyle","cssText","rule","setHelperLayerPosition","helperLayer","_introItems","_currentStep","currentElement","elementPosition","_targetElement","widthHeightPadding","helperElementPadding","_","UNSAFE_SUBSTITUTE","searchValue","replaceValue","replacer","functionalReplace","accumulatedResult","nextSourcePosition","replacerArgs","UNSCOPABLES","ArrayPrototype","addToUnscopables","$includes","HAS_SPECIES_SUPPORT$2","SPECIES","Array$1","max$1","start","end","fin","Constructor","TypeError$2","notARegexp","correctIsRegexpLogic","error1","error2","stringIndexOf","searchString","arrayMethodIsStrict","un$Join","ES3_STRINGS","STRICT_METHOD$1","functionBindContext","push$1","createMethod","IS_MAP","IS_FILTER","IS_SOME","IS_EVERY","IS_FIND_INDEX","IS_FILTER_REJECT","NO_HOLES","callbackfn","specificCreate","boundFunction","arrayIteration","$filter","filterReject","HAS_SPECIES_SUPPORT$1","checkRight","targetOffset","tooltipLayerStyleLeft","tooltipOffset","windowSize","checkLeft","tooltipLayerStyleRight","HAS_SPECIES_SUPPORT","TypeError$1","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","removeEntry","stringArray","stringToRemove","_determineAutoAlignment","offsetLeft","tooltipWidth","desiredAlignment","halfTooltipWidth","winWidth","screen","possibleAlignments","calculatedAlignment","_determineAutoPosition","desiredTooltipPosition","possiblePositions","positionPrecedence","tooltipHeight","targetElementRect","calculatedPosition","hyphenIndex","substr","placeTooltip","arrowLayer","hintMode","tooltipCssClass","currentStepObj","currentTooltipPosition","marginLeft","marginTop","tooltipClass","autoPosition","tooltipLayerStyleLeftRight","showStepNumbers","removeShowElement","elms","querySelectorAll","elm","_createElement","tagname","attrs","setAttRegex","animate","existingOpacity","opacity","setTimeout","_getProgress","currentStep","parseInt","_disableInteraction","disableInteractionLayer","querySelector","_createBullets","bulletsLayer","showBullets","ulContainer","anchorClick","goToStep","step","innerLi","anchorLink","onclick","innerHTML","_recreateBullets","oldReferenceLayer","existing","replaceChild","_updateBullets","_createProgressBar","progressLayer","showProgress","progressBar","progressBarAdditionalClass","_updateProgressBar","_showElement","_this","_introChangeCallback","oldHelperLayer","highlightClass","nextTooltipButton","prevTooltipButton","skipTooltipButton","oldHelperNumberLayer","oldtooltipLayer","oldTooltipTitleLayer","oldArrowLayer","oldtooltipContainer","_lastShowElementTimer","clearTimeout","intro","focus","referenceLayer","tooltipTextLayer","tooltipHeaderLayer","tooltipTitleLayer","buttonsLayer","box-shadow","overlayOpacity","showButtons","helperNumberLayer","nextStep","_introCompleteCallback","exitIntro","nextLabel","previousStep","prevLabel","skipLabel","_introSkipCallback","removeChild","disableInteraction","buttonClass","hidePrev","hideNext","nextToDone","doneLabel","_introAfterChangeCallback","goToStepNumber","_currentStepNumber","_direction","continueStep","_introBeforeChangeCallback","onKeyDown","code","charCode","keyCode","exitOnEsc","srcElement","returnValue","cloneObject","nodeType","jQuery","debounce","timeout","timer","_len","_key","hintQuerySelectorAll","hintsWrapper","hideHint","stepId","removeHintTooltip","_hintCloseCallback","hideHints","hints","showHints","_this2","showHint","populateHints","removeHints","_this3","removeHint","reAlignHints","_hintsAutoRefreshFunction","addHints","_this4","getHintClick","evt","stopPropagation","cancelBubble","showHintDialog","hintAnimation","hintDot","hintPulse","alignHintPosition","hintPosition","_hintsAddedCallback","hintAutoRefreshInterval","offset","iconWidth","iconHeight","hintElement","_hintClickCallback","removedStep","tooltipWrapper","hintShowButton","closeButton","hintButtonLabel","tooltip","targetElm","_this5","currentItem","tooltipPosition","_this6","_ref2","deleteCount","actualStart","insertCount","actualDeleteCount","from","to","mergeSort","comparefn","middle","insertionSort","merge","llength","rlength","lindex","rindex","arraySort","firefox","engineFfVersion","engineIsIeOrEdge","webkit","engineWebkitVersion","un$Sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","fromCharCode","getSortCompare","fetchIntroSteps","allIntroSteps","introItems","steps","floatingElementQuery","elmsLength","hasAttribute","tempIntroItems","refresh","refreshSteps","onResize","continueExit","_introBeforeExitCallback","overlayLayers","overlayLayer","floatingElement","_introExitCallback","addOverlayLayer","exitOnOverlayClick","cursor","introForElement","_introStartCallback","keyboardNavigation","IntroJs","arrayLength","itemsLength","introJs","instance","Error","instances","clone","setOption","option","setOptions","goToStep$1","addStep","addSteps","goToStepNumber$1","nextStep$1","previousStep$1","currentStep$1","exit","refresh$1","onbeforechange","providedCallback","onchange","onafterchange","oncomplete","onhintsadded","onhintclick","onhintclose","onstart","onexit","onskip","onbeforeexit","hideHint$1","hideHints$1","showHint$1","showHints$1","removeHints$1","removeHint$1","showHintDialog$1","factory","fortuneTrackerApp","Hooks","once","socketlib","registerSystem","sheetStyles","ZweihanderUtils.findItemsWorldWide","Combat","decimals","Actors","unregisterSheet","registerSheet","makeDefault","Items","rollDetails"],"mappings":"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"}